CREATE DATABASE PETMARKET

USE PETMARKET

CREATE SCHEMA PAWPLACE

CREATE TABLE PAWPLACE.TBL_EJE_TRA_EXCEPCION(
	BIN_PK_TBL_GUA_TRA_EXCEPCION BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
	SIN_FK_UTL_PAR_PAIS SMALLINT NULL,
	STR_USUARIO_CREACION VARCHAR(50) NULL,
	FEC_CREACION DATETIME NULL,
	STR_USUARIO_MODIFICACION VARCHAR(50) NULL,
	FEC_MODIFICACION DATETIME NULL,
	INT_ID_SPID INT NULL,
	FEC_SISTEMA DATETIME NULL,
	INT_PRIORIDAD INT NULL,
	INT_SEVERIDAD INT NULL,
	INT_ERROR_ESTADO INT NULL,
	STR_SERVIDOR VARCHAR(300) NULL,
	STR_ESTACION VARCHAR(300) NULL,
	STR_BASE_DATOS VARCHAR(300) NULL,
	STR_APLICATIVO VARCHAR(300) NULL,
	STR_CLASE VARCHAR(300) NULL,
	STR_EVENTO VARCHAR(300) NULL,
	STR_PROCESO VARCHAR(300) NULL,
	STR_PARAMETROS VARCHAR(MAX) NULL,
	INT_ID_ORIGEN INT NULL,
	STR_DESCRIPCION_ORIGEN VARCHAR(300) NULL,
	INT_ID_TIPO INT NULL,
	STR_DESCRIPCION_TIPO VARCHAR(300) NULL,
	STR_DETALLE VARCHAR(500) NULL,
	STR_MENSAJE VARCHAR(MAX) NULL,
	STR_MENSAJE_SISTEMA VARCHAR(MAX) NULL,
	STR_OBSERVACION VARCHAR(MAX) NULL,
	STR_OTROS_DATOS VARCHAR(MAX) NULL,
	STR_SENTENCIA VARCHAR(MAX) NULL,
	INT_NUMERO_USUARIO INT NULL,
	INT_NUMERO_SISTEMA INT NULL,
	INT_NIVEL_ANIDAMIENTO INT NULL,
	INT_NUMERO_LINEA INT NULL,
	STR_IDENTIFICADOR_EXTERNO VARCHAR(50) NULL,
	UNQ_IDENTIFICADOR_UNICO UNIQUEIDENTIFIER NULL,
)

CREATE TABLE PAWPLACE.TBL_PMK_ROL(
	PK_TBL_PMK_ROL BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
	ROL VARCHAR(20) NOT NULL,
	FECHA_CREACION DATETIME NOT NULL DEFAULT GETDATE(),
	USUARIO_CREACION VARCHAR(50) NOT NULL DEFAULT 'MAURICE.LANG',
	FECHA_MODIFICACION DATETIME NULL,
	USUARIO_MODIFICACION VARCHAR(50) NULL
)

CREATE TABLE PAWPLACE.TBL_PMK_CONTROL_USUARIO(
	PK_TBL_PMK_CONTROL_USUARIO BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
	CEDULA VARCHAR(20) NOT NULL,
	NOMBRE VARCHAR(35) NOT NULL,
	APELLIDO1 VARCHAR(35) NOT NULL,
	APELLIDO2 VARCHAR(35) NULL,
	CONTRASENA VARCHAR(20) NOT NULL,
	ID_ROL BIGINT NOT NULL,
	FECHA_CREACION DATETIME NOT NULL DEFAULT GETDATE(),
	USUARIO_CREACION VARCHAR(50) NOT NULL DEFAULT 'MAURICE.LANG',
	FECHA_MODIFICACION DATETIME NULL,
	USUARIO_MODIFICACION VARCHAR(50) NULL,
	CONSTRAINT FK_TBL_PMK_ROL FOREIGN KEY (ID_ROL) REFERENCES PAWPLACE.TBL_PMK_ROL (PK_TBL_PMK_ROL),
	CONSTRAINT UC_CEDULA UNIQUE (CEDULA)
)

CREATE TABLE PAWPLACE.TBL_PMK_CLIENTE(
	PK_TBL_PMK_CLIENTE BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
	CEDULA VARCHAR(20) NOT NULL,
	NOMBRE VARCHAR(35) NOT NULL,
	APELLIDO1 VARCHAR(35) NOT NULL,
	APELLIDO2 VARCHAR(35) NULL,
	CORREO VARCHAR(150) NOT NULL,
	TELEFONO VARCHAR(20) NOT NULL,
	FECHA_CREACION DATETIME NOT NULL DEFAULT GETDATE(),
	USUARIO_CREACION VARCHAR(50) NOT NULL DEFAULT 'MAURICE.LANG',
	FECHA_MODIFICACION DATETIME NULL,
	USUARIO_MODIFICACION VARCHAR(50) NULL,
	CONSTRAINT UC_CEDULA_CLIENTE UNIQUE (CEDULA)
)

CREATE TABLE PAWPLACE.TBL_PMK_CATEGORIA(
	PK_TBL_PMK_CATEGORIA BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
	CATEGORIA VARCHAR(150) NOT NULL,
	FECHA_CREACION DATETIME NOT NULL DEFAULT GETDATE(),
	USUARIO_CREACION VARCHAR(50) NOT NULL DEFAULT 'MAURICE.LANG',
	FECHA_MODIFICACION DATETIME NULL,
	USUARIO_MODIFICACION VARCHAR(50) NULL
)

CREATE TABLE PAWPLACE.TBL_PMK_INVENTARIO(
	PK_TBL_PMK_INVENTARIO BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
	CODIGO VARCHAR(150) NOT NULL,
	NOMBRE VARCHAR(150) NOT NULL,
	TIPO_ANIMAL VARCHAR(20) NOT NULL,
	PRECIO DECIMAL(10,2) NOT NULL,
	CANTIDAD INT NOT NULL,
	ID_CATEGORIA BIGINT NOT NULL,
	FECHA_CREACION DATETIME NOT NULL DEFAULT GETDATE(),
	USUARIO_CREACION VARCHAR(50) NOT NULL DEFAULT 'MAURICE.LANG',
	FECHA_MODIFICACION DATETIME NULL,
	USUARIO_MODIFICACION VARCHAR(50) NULL,
	CONSTRAINT FK_TBL_PMK_CATEGORIA FOREIGN KEY (ID_CATEGORIA) REFERENCES PAWPLACE.TBL_PMK_CATEGORIA (PK_TBL_PMK_CATEGORIA),
	CONSTRAINT UC_CODIGO UNIQUE (CODIGO)
)

CREATE TABLE PAWPLACE.TBL_PMK_VENTA(
	PK_TBL_PMK_VENTA BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
	ID_CLIENTE BIGINT NOT NULL,
	FECHA DATE NOT NULL DEFAULT GETDATE(),
	TOTAL DECIMAL (10,2) NULL DEFAULT 0.0,
	FECHA_CREACION DATETIME NOT NULL DEFAULT GETDATE(),
	USUARIO_CREACION VARCHAR(50) NOT NULL DEFAULT 'MAURICE.LANG',
	FECHA_MODIFICACION DATETIME NULL,
	USUARIO_MODIFICACION VARCHAR(50) NULL,
	CONSTRAINT FK_TBL_PMK_CLIENTE FOREIGN KEY (ID_CLIENTE) REFERENCES PAWPLACE.TBL_PMK_CLIENTE (PK_TBL_PMK_CLIENTE)
)

CREATE TABLE PAWPLACE.TBL_PMK_CARRITO(
	PK_TBL_PMK_CARRITO BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
	ID_VENTA BIGINT NOT NULL,
	ID_PRODUCTO BIGINT NOT NULL,
	CANTIDAD INT NOT NULL,
	SUBTOTAL DECIMAL(10,2) NOT NULL,
	FECHA_CREACION DATETIME NOT NULL DEFAULT GETDATE(),
	USUARIO_CREACION VARCHAR(50) NOT NULL DEFAULT 'MAURICE.LANG',
	FECHA_MODIFICACION DATETIME NULL,
	USUARIO_MODIFICACION VARCHAR(50) NULL,
	CONSTRAINT FK_TBL_PMK_VENTA FOREIGN KEY (ID_VENTA) REFERENCES PAWPLACE.TBL_PMK_VENTA(PK_TBL_PMK_VENTA),
	CONSTRAINT FK_TBL_PMK_INVENTARIO FOREIGN KEY (ID_PRODUCTO) REFERENCES PAWPLACE.TBL_PMK_INVENTARIO (PK_TBL_PMK_INVENTARIO)
)

CREATE TABLE PAWPLACE.TBL_PMK_PARAMETRO(
	PK_TBL_PMK_PARAMETRO BIGINT IDENTITY(1,1) PRIMARY KEY NOT NULL,
	CEDULA_JURIDICA VARCHAR(13) NOT NULL,
	EMPRESA VARCHAR(250) NOT NULL,
	TELEFONO VARCHAR(15) NOT NULL,
	CORREO VARCHAR(250) NOT NULL,
	WEB VARCHAR(250) NOT NULL,
	DIRECCION VARCHAR(MAX) NOT NULL,
	DESCRIPCION VARCHAR(35) NOT NULL,
	TIPO_TIENDA VARCHAR(25) NOT NULL,
	LOGO IMAGE NOT NULL,
	FECHA_CREACION DATETIME NOT NULL DEFAULT GETDATE(),
	USUARIO_CREACION VARCHAR(50) NOT NULL DEFAULT 'MAURICE.LANG',
	FECHA_MODIFICACION DATETIME NULL,
	USUARIO_MODIFICACION VARCHAR(50) NULL
)

IF @@ERROR <> 0
    SET NOEXEC ON;

/*  
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
COMENTARIOS: 
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
-->>>CREACION: 
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
OBJETO:			[PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR] 
DESCRIPCION:	PROCEDIMIENTO ENCARGADO DE REALIZAR LA INSERCION DE ERRORES O EXCEPCIONES EN LA TABLA T_UTLTEXCEPCION 
CREADO POR: 	MAURICE.LANG
VERSION:    	1.0.1 
FECHA:  		2023/04/14
OBSERVACIONES: 
1. SI SE DESEA REGISTRAR EL ERROR EN UN LUGAR CENTRALIZADO, COLOCARLO DESPUES DEL INGRESO LOCAL, SIN MANEJO TRANSACCIONAL, POR SI SE CAE REGISTRE AL MENOS LOCALMENTE 
 
EJM EJECUCION: 
 
 
 
SELECT * FROM TBL_EJE_TRA_EXCEPCION 
 
------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
-->>>MODIFICACIONES: 
(POR CADA MODIFICACION SE DEBE DE AGREGAR UN ITEM, CON SU RESPECTIVA  INFORMACION, FAVOR QUE SEA DE FORMA ASCENDENTE CON RESPECTO A LAS  
MODIFICACIONES, ADEMAS DE IDENTIFICAR EN EL CODIGO DEL PROCEDIMIENTO EL CAMBIO REALIZADO, DE LA SIGUIENTE FORMA 
--NUMERO MODIFICACION: ##, MODIFICADO POR: DESARROLLADOR, OBSERVACIONES: DESCRIPCION A DETALLE DEL CAMBIO) 
-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- 
NUMERO MODIFICACION: 	01 
DESCRIPCION: 			00000-00 FIX,SE COMENTA LA SECCION DE ALMACENAR EN LA TABLA  
						UTL_TRA_BITACORA_EJECUCION_BINARIOS, GENERA ESPACIO Y NO SE UTILIZA 
USO: 					 
MODIFICADO POR: 		XXXXXX XXXXXX 
VERSION: 				1.0.2 
EJEMPLO DE USO: 		 
FECHA: 					YYYY/MM/DD
OBSERVACIONES: 									 
------------------------------------------------------------------------------------------------------- 
NUMERO MODIFICACION: 	NUMERO DE SECUENCIA DE LA MODIFICACION, COMENSAR DE 1,2,3,...N, EN ADELANTE 
DESCRIPCION: 			DESCRIPCION DE LA MODIFICACION REALIZADA 
USO: 					SI ALGO CAMBIO EN LA FORMA DE LA EJECUCION, SE COLOCA, SI NO COLOCAR "IGUAL AL ITEN DE CREACION" 
MODIFICADO POR: 		DESARROLLADOR 
VERSION: 				1.1.0 O 1.1.1, ESTO TOMANDO COMO BASE LA VERSION DE LA CREACION, ULTIMA MODIFICACION, Y EL TIPO DE CAMBIO REALIZADO EN EL PROCEDIMIENTO 
EJEMPLO DE USO: 		SI ALGO CAMBIO EN LA FORMA DE LA EJECUCION, SE COLOCA, SI NO COLOCAR "IGUAL AL ITEN DE CREACION" 
FECHA: 					FECHA DE LA MODIFICACION 
OBSERVACIONES: 			POSIBLES OBSERVACIONES 
-------------------------------------------------------------------------------------------------------  

*/
CREATE PROC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR
	@SIN_MODO_EJECUCION SMALLINT = 0,
	@SIN_FK_UTL_PAR_PAIS INT = 0,
	@STR_USUARIO_CREACION VARCHAR(50) = '',
	@FEC_CREACION DATETIME = '19000101',
	@STR_USUARIO_MODIFICACION VARCHAR(50) = '',
	@FEC_MODIFICACION DATETIME = '19000101',
	@INT_ID_SPID INT = 0,
	@FEC_SISTEMA DATETIME = '19000101',
	@INT_PRIORIDAD INT = 0,
	@INT_SEVERIDAD INT = 0,
	@INT_ERROR_ESTADO INT = 0,
	@STR_SERVIDOR VARCHAR(300) = '',
	@STR_ESTACION VARCHAR(300) = '',
	@STR_BASE_DATOS VARCHAR(300) = '',
	@STR_APLICATIVO VARCHAR(300) = '',
	@STR_CLASE VARCHAR(300) = '',
	@STR_EVENTO VARCHAR(300) = '',
	@STR_PROCESO VARCHAR(300) = '',
	@STR_PARAMETROS VARCHAR(MAX) = '',
	@INT_ID_ORIGEN INT = 0, /*1=WINDOWS FORM, 2=WEB SERVICE, 3=WEB SITE, 4=PROCEDURE, 5=REPORTING SERVICE, 6=ETL*/
	@STR_DESCRIPCION_ORIGEN VARCHAR(300) = '', /*WINDOWS FORM, WEB SERVICE, WEB SITE, PROCEDURE, REPORTING SERVICE, ETL*/
	@INT_ID_TIPO INT = 0,
	@STR_DESCRIPCION_TIPO VARCHAR(300) = '', /*ERROR-EXCEPCION-VALIDACION*/
	@STR_DETALLE VARCHAR(500) = '',
	@STR_MENSAJE VARCHAR(MAX) = '',
	@STR_MENSAJE_SISTEMA VARCHAR(MAX) = '',
	@STR_OBSERVACION VARCHAR(MAX) = '',
	@STR_OTROS_DATOS VARCHAR(MAX) = '',
	@SIN_ID_TIPO_DATOS SMALLINT = 0,
	@VBI_DATOS VARBINARY(MAX) = NULL,
	@STR_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '',
	@STR_SENTENCIA VARCHAR(MAX) = '',
	@INT_NUMERO_USUARIO INT = 0,
	@INT_NUMERO_SISTEMA INT = 0,
	@INT_NIVEL_ANIDAMIENTO INT = 0,
	@INT_NUMERO_LINEA INT = 0,
	@STR_IDENTIFICADOR_EXTERNO VARCHAR(50) = '',
	@STR_IDENTIFICADOR_UNICO VARCHAR(50) = '' OUTPUT
AS
BEGIN
	SET XACT_ABORT, NOCOUNT ON; --ADDED TO PREVENT EXTRA RESULT SETS FROM INTERFERING WITH SELECT STATEMENTS. 
    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; -- ADD NOLOCK ALL TABLES

	BEGIN TRY
		/*BEGIN TRANSACTION*/

		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++  
        -----------------------------                                     
        --DECLARACION Y ASIGNACION DE VARIABLES                                   
        ----------------------------- 
		BEGIN /*INICIO-DECLARACION Y ASIGNACION DE VARIABLES*/
			
			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @SIN_MODO_EJECUCION_NORMAL SMALLINT = 0;
				DECLARE @SIN_MODO_EJECUCION_DEPURACION SMALLINT = 7;

				/*1=WINDOWS FORM,2=WEB SERVICE,3=WEB SITE,4=PROCEDURE,5=REPORTING SERVICE,6=ETL*/

				DECLARE @INT_ID_ORIGEN_WINDOWS_FORM INT = 1;
				DECLARE @STR_DESCRIPCION_ORIGEN_WINDOWS_FORM VARCHAR(300) = 'WINDOWS FORM';

				DECLARE @INT_ID_ORIGEN_WEB_SERVICE INT = 2;
				DECLARE @STR_DESCRIPCION_ORIGEN_WEB_SERVICE VARCHAR(300) = 'WEB SERVICE';

				DECLARE @INT_ID_ORIGEN_WEB_SITE INT = 3;
				DECLARE @STR_DESCRIPCION_ORIGEN_WEB_SITE VARCHAR(300) = 'WEB SITE';

				DECLARE @INT_ID_ORIGEN_PROCEDIMIENTO INT = 4;
				DECLARE @STR_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO';

				DECLARE @INT_ID_ORIGEN_REPORTING_SERVICE INT = 5;
				DECLARE @STR_DESCRIPCION_ORIGEN_REPORTING_SERVICE VARCHAR(300) = 'REPORTING SERVICE';

				DECLARE @INT_ID_ORIGEN_ETL INT = 6;
				DECLARE @STR_DESCRIPCION_ORIGEN_ETL VARCHAR(300) = 'ETL';

				DECLARE @SIN_ID_TIPO_DATOS_XML SMALLINT = 1; /*ID TIPO DATO XML*/

			END; /*FIN-CONSTANTES*/
			
			BEGIN /*INICIO-ADMINISTRACION ERRORES*/
				
				DECLARE @STR_ERROR_PARAMETROS VARCHAR(MAX) = '';
				DECLARE @INT_ERROR_NUMERO_USUARIO INT = 75000;
				DECLARE @STR_ERROR_MENSAJE VARCHAR(MAX) = '';
				DECLARE @STR_ERROR_PROCESO VARCHAR(300) = OBJECT_NAME(@@PROCID);
				DECLARE @STR_ERROR_OBSERVACION VARCHAR(MAX) = '';
				DECLARE @STR_ERROR_SENTENCIA VARCHAR(MAX) = '';

			END /*FINAL-ADMINISTRACION ERRORES*/

			BEGIN /*INICIO-VARIOS*/
				DECLARE @BIN_PK_TBL_EJE_TRA_EXEPCION BIGINT = 0;
				DECLARE @XML_DATOS XML = NULL;
				DECLARE @BIN_REGISTRA_XML_PROCESOS_SISTEMA_GLOBAL BIGINT = 0;
				DECLARE @BIN_REGISTRA_XML_PROCESOS_SISTEMA_GLOBAL_MODULO BIGINT = 0;
				DECLARE @BIN_REGISTRA_XML_PROCESOS_SISTEMA BIGINT = 0;

				DECLARE @STR_LLAVE_01_UTL_PAR_GENERALES VARCHAR(300) = '';
				DECLARE @STR_LLAVE_02_UTL_PAR_GENERALES VARCHAR(300) = '';
				DECLARE @STR_LLAVE_03_UTL_PAR_GENERALES VARCHAR(300) = '';
				DECLARE @INT_CANTIDAD_REGISTROS INT = 0;

				SELECT @SIN_MODO_EJECUCION = ISNULL(@SIN_MODO_EJECUCION, -1);
				SELECT @SIN_FK_UTL_PAR_PAIS = ISNULL(@SIN_FK_UTL_PAR_PAIS, -1);
				SELECT @STR_USUARIO_CREACION = ISNULL(@STR_USUARIO_CREACION, 'N/D');
				SELECT @FEC_CREACION = ISNULL(@FEC_CREACION, '19000101');
				SELECT @STR_USUARIO_MODIFICACION = ISNULL(@STR_USUARIO_MODIFICACION, 'N/D');
				SELECT @FEC_MODIFICACION = ISNULL(@FEC_MODIFICACION, '19000101');
				SELECT @INT_ID_SPID = ISNULL(@INT_ID_SPID,-1);
				SELECT @FEC_SISTEMA = ISNULL(@FEC_SISTEMA, '19000101');
				SELECT @INT_PRIORIDAD = ISNULL(@INT_PRIORIDAD, -1);
				SELECT @INT_SEVERIDAD = ISNULL(@INT_SEVERIDAD, -1);
				SELECT @INT_ERROR_ESTADO = ISNULL(@INT_ERROR_ESTADO, -1);
				SELECT @STR_SERVIDOR = ISNULL(@STR_SERVIDOR, 'N/D');
				SELECT @STR_ESTACION = ISNULL(@STR_ESTACION, 'N/D');
				SELECT @STR_BASE_DATOS = ISNULL(@STR_BASE_DATOS, 'N/D');
				SELECT @STR_APLICATIVO = ISNULL(@STR_APLICATIVO, 'N/D');
				SELECT @STR_CLASE = ISNULL(@STR_CLASE, 'N/D');
				SELECT @STR_EVENTO = ISNULL(@STR_EVENTO, 'N/D');
				SELECT @STR_PROCESO = ISNULL(@STR_PROCESO, 'N/D');
				SELECT @STR_PARAMETROS = ISNULL(@STR_PARAMETROS, 'N/D');
				SELECT @INT_ID_ORIGEN = ISNULL(@INT_ID_ORIGEN, -1);
				SELECT @STR_DESCRIPCION_TIPO = ISNULL(@STR_DESCRIPCION_TIPO, 'N/D');
				SELECT @STR_DETALLE = ISNULL(@STR_DETALLE, 'N/D');
				SELECT @STR_MENSAJE = ISNULL(@STR_MENSAJE, 'N/D');
				SELECT @STR_MENSAJE_SISTEMA = ISNULL(@STR_MENSAJE_SISTEMA, 'N/D');
				SELECT @STR_OBSERVACION = ISNULL(@STR_OBSERVACION, 'N/D');

				SELECT @STR_OTROS_DATOS = ISNULL(@STR_OTROS_DATOS, 'N/D');

				SELECT @SIN_ID_TIPO_DATOS = ISNULL(@SIN_ID_TIPO_DATOS, 'N/D');

				SELECT @STR_DESCRIPCION_TIPO_DATOS = ISNULL(@STR_DESCRIPCION_TIPO_DATOS, 'N/D');

				SELECT @STR_SENTENCIA = ISNULL(@STR_SENTENCIA, 'N/D');

				SELECT @INT_NUMERO_USUARIO = ISNULL(@INT_NUMERO_USUARIO, -1);
				SELECT @INT_NUMERO_SISTEMA = ISNULL(@INT_NUMERO_SISTEMA, -1);
				SELECT @INT_NIVEL_ANIDAMIENTO = ISNULL(@INT_NIVEL_ANIDAMIENTO, -1);
				SELECT @INT_NUMERO_LINEA = ISNULL(@INT_NUMERO_LINEA, -1);

				DECLARE @UNQ_IDENTIFICADOR_UNICO UNIQUEIDENTIFIER = NEWID();

				SELECT @STR_IDENTIFICADOR_UNICO = CONVERT(VARCHAR(50), @UNQ_IDENTIFICADOR_UNICO);

				SELECT @STR_ERROR_PARAMETROS = CONCAT(
					'@SIN_MODO_EJECUCION= ', ISNULL(@SIN_MODO_EJECUCION, -1), '@SIN_FK_UTL_PAR_PAIS= ', ISNULL(@SIN_FK_UTL_PAR_PAIS, -1),
					'@STR_USUARIO_CREACION= ', ISNULL(@STR_USUARIO_CREACION, 'N/D'), '@FEC_CREACION= ', ISNULL(@FEC_CREACION, 19000101),
					'@STR_USUARIO_MODIFICACION= ', ISNULL(@STR_USUARIO_MODIFICACION, 'N/D'), '@FEC_MODIFICACION= ', ISNULL(@FEC_MODIFICACION, 19000101),
					'@INT_ID_SPID= ', ISNULL(@INT_ID_SPID, -1), '@FEC_SISTEMA= ', ISNULL(@FEC_SISTEMA, 19000101),
					'@INT_PRIORIDAD= ', ISNULL(@INT_PRIORIDAD,-1), '@INT_SEVERIDAD= ', ISNULL(@INT_SEVERIDAD,-1),
					'@INT_ERROR_ESTADO= ', ISNULL(@INT_ERROR_ESTADO, -1), '@STR_SERVIDOR= ', ISNULL(@STR_SERVIDOR, 'N/D'),
					'@STR_ESTACION= ', ISNULL(@STR_ESTACION, 'N/D'), '@STR_BASE_DATOS= ', ISNULL(@STR_APLICATIVO, 'N/D'),
					'@STR_CLASE= ',  ISNULL(@STR_CLASE, 'N/D'), '@STR_EVENTO= ', ISNULL(@STR_EVENTO, 'N/D'),
					'@STR_PROCESO= ', ISNULL(@STR_PROCESO, 'N/D'), '@STR_PARAMETROS= ', ISNULL(@STR_PARAMETROS, 'N/D'),
					'@INT_ID_ORIGEN= ', ISNULL(@INT_ID_ORIGEN, -1), '@STR_DESCRIPCION_ORIGEN= ', ISNULL(@STR_DESCRIPCION_ORIGEN, 'N/D'),
					'@INT_ID_TIPO= ', ISNULL(@INT_ID_TIPO,-1), '@STR_DESCRIPCION_TIPO= ', ISNULL(@STR_DESCRIPCION_TIPO, 'N/D'),
					'@STR_DETALLE= ', ISNULL(@STR_DETALLE,'N/D'), '@STR_MENSAJE= ', ISNULL(@STR_MENSAJE, 'N/D'),
					'@STR_MENSAJE_SISTEMA= ', ISNULL(@STR_MENSAJE_SISTEMA, 'N/D'), '@STR_OBSERVACION= ', ISNULL(@STR_OBSERVACION, 'N/D'),
					'@STR_OTROS_DATOS= ', ISNULL(@STR_OTROS_DATOS, 'N/D'), '@SIN_ID_TIPO_DATOS= ', ISNULL(@SIN_ID_TIPO_DATOS, -1),
					'@VBI_DATOS= ', ISNULL(CONVERT(VARCHAR(MAX), @VBI_DATOS), 'N/D'), '@STR_SENTENCIA= ', ISNULL(@STR_SENTENCIA, 'N/D'),
					'@INT_NUMERO_USUARIO= ', ISNULL(@INT_NUMERO_USUARIO, -1), '@INT_NUMERO_SISTEMA= ', ISNULL(@INT_NUMERO_SISTEMA, -1),
					'@INT_NIVEL_ANIDAMIENTO= ', ISNULL(@INT_NIVEL_ANIDAMIENTO, -1), '@INT_NUMERO_LINEA= ', ISNULL(@INT_NUMERO_LINEA, -1),
					'@STR_IDENTIFICADOR_EXTERNO= ', ISNULL(@STR_IDENTIFICADOR_EXTERNO, 'N/D'), '@STR_IDENTIFICADOR_UNICO= ', ISNULL(@STR_IDENTIFICADOR_UNICO, 'N/D')
					);
				SELECT @STR_ERROR_SENTENCIA = CONCAT('EXEC ', @STR_ERROR_PROCESO, ' ', @STR_ERROR_PARAMETROS);

			END; /*FIN-VARIOS*/
		END; /*FINAL-DECLARACION Y ASIGNACIONES DE VARIABLES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++   
        -----------------------------                                     
        --CUERPO PROCEDIMIENTO                                     
        ----------------------------- 
		BEGIN /*INICIO-CUERPO PROCEDIMEINTO*/
			IF (@SIN_MODO_EJECUCION = @SIN_MODO_EJECUCION_DEPURACION)
			BEGIN
				
				SELECT CONCAT('00000-', @STR_ERROR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@SIN_MODO_EJECUCION AS SIN_MODO_EJECUCION,
                       @SIN_FK_UTL_PAR_PAIS AS SIN_FK_UTL_PAR_PAIS,
                       @STR_USUARIO_CREACION AS STR_USUARIO_CREACION,
                       @FEC_CREACION AS FEC_CREACION,
                       @STR_USUARIO_MODIFICACION AS STR_USUARIO_MODIFICACION,
                       @FEC_MODIFICACION AS FEC_MODIFICACION,
                       @INT_ID_SPID AS INT_ID_SPID,
                       @FEC_SISTEMA AS FEC_SISTEMA,
                       @INT_PRIORIDAD AS INT_PRIORIDAD,
                       @INT_SEVERIDAD AS INT_SEVERIDAD,
                       @INT_ERROR_ESTADO AS INT_ERROR_ESTADO,
                       @STR_SERVIDOR AS STR_SERVIDOR,
                       @STR_ESTACION AS STR_ESTACION,
                       @STR_BASE_DATOS AS STR_BASE_DATOS,
                       @STR_APLICATIVO AS STR_APLICATIVO,
                       @STR_CLASE AS STR_CLASE,
                       @STR_EVENTO AS STR_EVENTO,
                       @STR_PROCESO AS STR_PROCESO,
                       @STR_PARAMETROS AS STR_PARAMETROS,
                       @INT_ID_ORIGEN AS INT_ID_ORIGEN,
                       @STR_DESCRIPCION_ORIGEN AS STR_DESCRIPCION_ORIGEN,
                       @INT_ID_TIPO AS INT_ID_TIPO,
                       @STR_DESCRIPCION_TIPO AS STR_DESCRIPCION_TIPO,
                       @STR_DETALLE AS STR_DETALLE,
                       @STR_MENSAJE AS STR_MENSAJE,
                       @STR_MENSAJE_SISTEMA AS STR_MENSAJE_SISTEMA,
                       @STR_OBSERVACION AS STR_OBSERVACION,
                       @STR_OTROS_DATOS AS STR_OTROS_DATOS,
                       @SIN_ID_TIPO_DATOS AS SIN_ID_TIPO_DATOS,
                       @VBI_DATOS AS VBI_DATOS,
                       @STR_DESCRIPCION_TIPO_DATOS AS STR_DESCRIPCION_TIPO_DATOS,
                       @STR_SENTENCIA AS STR_SENTENCIA,
                       @INT_NUMERO_USUARIO AS INT_NUMERO_USUARIO,
                       @INT_NUMERO_SISTEMA AS INT_NUMERO_SISTEMA,
                       @INT_NIVEL_ANIDAMIENTO AS INT_NIVEL_ANIDAMIENTO,
                       @INT_NUMERO_LINEA AS INT_NUMERO_LINEA,
                       @STR_IDENTIFICADOR_EXTERNO AS STR_IDENTIFICADOR_EXTERNO,
                       @UNQ_IDENTIFICADOR_UNICO AS UNQ_IDENTIFICADOR_UNICO;
					
					SELECT CONCAT('00010-',@STR_ERROR_PROCESO) AS BANDERA_EJECUCION,
							GETDATE() AS FECHA,
							@STR_ERROR_SENTENCIA AS SENTENCIA_EJECUCION;
				END;

				IF (@INT_ID_ORIGEN = @INT_ID_ORIGEN_PROCEDIMIENTO)
				BEGIN

					SELECT TOP 1
						@STR_APLICATIVO = CONCAT(
                                       'HOST:',
                                       ISNULL(vs.host_name, 'N/D'),
                                       ' | PROGRAM:',
                                       ISNULL(vs.program_name, 'N,/D'),
                                       ' | LOGIN:',
                                       ISNULL(vs.login_name, 'N,/D')
									   )
					FROM sys.dm_exec_requests vr WITH(NOLOCK)
						INNER JOIN sys.dm_exec_sessions vs WITH(NOLOCK)
							ON vr.session_id = vs.session_id
					WHERE vr.session_id = @INT_ID_SPID;
				END;
				-------------------------------------------------------------------------------------------------------------------------------- 
				--EXTRACION DE PARAMETRIZACION GLOBAL, SOBREESCRIBE CUALQUIE CONFIGURACION DEL DETALLE 
				BEGIN
					SELECT @INT_ERROR_NUMERO_USUARIO = 75001;
					--Verbos a utilizar de acuerdo a la operacion=select:seleccionar, delete: eliminar, update: actualizar, insert: insertar, exec: ejecutar 
					SELECT @STR_ERROR_MENSAJE = 'ERROR, AL EXTRAER DATOS EN LA TABLA <UTL_PAR_GENERALES>';

					SELECT @STR_LLAVE_01_UTL_PAR_GENERALES = 'PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR_BIN_REGISTRA_XML_PROCESOS_SISTEMA_GLOBAL';
					SELECT @STR_LLAVE_02_UTL_PAR_GENERALES = '';
					SELECT @STR_LLAVE_03_UTL_PAR_GENERALES = '';

					SELECT @SIN_FK_UTL_PAR_PAIS = 0;

					SELECT @INT_CANTIDAD_REGISTROS = @@ROWCOUNT;

					IF (@INT_CANTIDAD_REGISTROS = 0)
					BEGIN
						
						SELECT @INT_ERROR_NUMERO_USUARIO = 75002;
						SELECT @STR_ERROR_MENSAJE = CONCAT('[ERROR, NO SE ENCUENTA DATOS EN TABLA <UTL_PAR_GENERALES>, LLAVE_01:',@STR_LLAVE_01_UTL_PAR_GENERALES,']');

						RAISERROR(@STR_ERROR_MENSAJE, 16, 1);
					END;
				END;
				-------------------------------------------------------------------------------------------------------------------------------- 
				--EXTRACION DE PARAMETRIZACION GLOBAL, POR APLICATIVO O BASE DE DATOS, SOBREESCRIBE CUALQUIE CONFIGURACION DEL DETALLE 
				BEGIN

					SELECT @INT_ERROR_NUMERO_USUARIO = 75003;

					SELECT @STR_ERROR_MENSAJE = 'ERROR, AL EXTRAER DATOS EN LA TABLA <UTL_PAR_GENERALES>';

					SELECT @STR_LLAVE_01_UTL_PAR_GENERALES = 'PA_MAN_EJE_TRA_EXCEPCION_GUARDAR_BIN_REGISTRA_XML_PROCESOS_SISTEMA_GLOBAL_MODULO';

					SELECT @STR_LLAVE_02_UTL_PAR_GENERALES = CASE
																WHEN
																(
																	@STR_BASE_DATOS != ''
																	AND
																	@STR_BASE_DATOS != 'N/A'
																	AND
																	@INT_ID_ORIGEN IN (@INT_ID_ORIGEN_PROCEDIMIENTO)
																) THEN 
																	@STR_BASE_DATOS
																WHEN
																(
																	@STR_APLICATIVO != ''
																	AND
																	@STR_APLICATIVO != 'N/A'
																	AND
																	@STR_APLICATIVO IN (@INT_ID_ORIGEN_WINDOWS_FORM, @INT_ID_ORIGEN_WEB_SERVICE,
																						@INT_ID_ORIGEN_WEB_SITE, @INT_ID_ORIGEN_REPORTING_SERVICE,
																						@INT_ID_ORIGEN_ETL)
																) THEN 
																	@STR_APLICATIVO
																ELSE
																	'N/D'
															END;
					SELECT @STR_LLAVE_03_UTL_PAR_GENERALES = '';

					SELECT @INT_CANTIDAD_REGISTROS = @@ROWCOUNT;

					IF (@INT_CANTIDAD_REGISTROS = 0)
					BEGIN

						SELECT @BIN_REGISTRA_XML_PROCESOS_SISTEMA_GLOBAL_MODULO = -1;

					END;
				END;

				IF (@BIN_REGISTRA_XML_PROCESOS_SISTEMA_GLOBAL_MODULO IN (0,1))
				BEGIN
					SELECT @BIN_REGISTRA_XML_PROCESOS_SISTEMA = @BIN_REGISTRA_XML_PROCESOS_SISTEMA_GLOBAL_MODULO;
				END;

				IF (@BIN_REGISTRA_XML_PROCESOS_SISTEMA_GLOBAL IN (1,0))
				BEGIN
					SELECT @BIN_REGISTRA_XML_PROCESOS_SISTEMA = @BIN_REGISTRA_XML_PROCESOS_SISTEMA_GLOBAL;
				END;

				IF (@SIN_MODO_EJECUCION = @SIN_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT CONCAT ('00020-', @STR_ERROR_PROCESO) AS BANDERA_EJECUCION,
							GETDATE() AS FECHA,
							@BIN_REGISTRA_XML_PROCESOS_SISTEMA AS BIT_REGISTRA_XML_PROCESOS_SISTEMA,
							@BIN_REGISTRA_XML_PROCESOS_SISTEMA_GLOBAL_MODULO AS BIN_REGISTRA_XML_PROCESOS_SISTEMA_GLOBAL_MODULO,
							@BIN_REGISTRA_XML_PROCESOS_SISTEMA_GLOBAL AS BIN_REGISTRA_XML_PROCESOS_SISTEMA_GLOBAL;
				END;

				SELECT @FEC_CREACION = GETDATE();

				SELECT @INT_ERROR_NUMERO_USUARIO = 75005;
				SELECT @STR_ERROR_MENSAJE = 'ERROR AL INSERTAR EN TABLA <TBL_EJE_TRA_EXCEPCION>';

				DECLARE @V_EJECUCION NVARCHAR(MAX) = N'';

				INSERT INTO PAWPLACE.TBL_EJE_TRA_EXCEPCION
				(
					SIN_FK_UTL_PAR_PAIS,
					STR_USUARIO_CREACION,
					FEC_CREACION,
					STR_USUARIO_MODIFICACION,
					FEC_MODIFICACION,
					INT_ID_SPID,
					FEC_SISTEMA,
					INT_PRIORIDAD,
					INT_SEVERIDAD,
					INT_ERROR_ESTADO,
					STR_SERVIDOR,
					STR_ESTACION,
					STR_BASE_DATOS,
					STR_APLICATIVO,
					STR_CLASE,
					STR_EVENTO,
					STR_PROCESO,
					INT_ID_ORIGEN,
					STR_PARAMETROS,
					STR_DESCRIPCION_ORIGEN,
					INT_ID_TIPO,
					STR_DESCRIPCION_TIPO,
					STR_DETALLE,
					STR_MENSAJE,
					STR_MENSAJE_SISTEMA,
					STR_OBSERVACION,
					STR_OTROS_DATOS,
					STR_SENTENCIA,
					INT_NUMERO_USUARIO,
					INT_NUMERO_SISTEMA,
					INT_NIVEL_ANIDAMIENTO,
					INT_NUMERO_LINEA,
					STR_IDENTIFICADOR_EXTERNO,
					UNQ_IDENTIFICADOR_UNICO
				)
				SELECT @SIN_FK_UTL_PAR_PAIS as SIN_FK_UTL_PAR_PAIS,
					@STR_USUARIO_CREACION AS STR_USUARIO_CREACION,
					@FEC_CREACION AS FEC_CREACION,
					@STR_USUARIO_MODIFICACION AS STR_USUARIO_MODIFICACION,
					@FEC_MODIFICACION AS FEC_MODIFICACION,
					@INT_ID_SPID AS INT_ID_SPID,
					@FEC_SISTEMA AS FEC_SISTEMA,
					@INT_PRIORIDAD AS INT_PRIORIDAD,
					@INT_SEVERIDAD AS INT_SEVERIDAD,
					@INT_ERROR_ESTADO AS INT_ERROR_ESTADO,
					@STR_SERVIDOR AS STR_SERVIDOR,
					@STR_ESTACION AS STR_ESTACION,
					@STR_BASE_DATOS AS STR_BASE_DATOS,
					@STR_APLICATIVO AS STR_APLICATIVO,
					@STR_CLASE AS STR_CLASE,
					@STR_EVENTO AS STR_EVENTO,
					@STR_PROCESO AS STR_PROCESO,
					@INT_ID_ORIGEN AS INT_ID_ORIGEN,
					@STR_PARAMETROS AS STR_PARAMETROS,
					@STR_DESCRIPCION_ORIGEN AS STR_DESCRIPCION_ORIGEN,
					@INT_ID_TIPO AS INT_ID_TIPO,
					@STR_DESCRIPCION_TIPO AS STR_DESCRIPCION_TIPO,
					@STR_DETALLE AS STR_DETALLE,
					@STR_MENSAJE AS STR_MENSAJE,
					@STR_MENSAJE_SISTEMA AS STR_MENSAJE_SISTEMA,
					@STR_OBSERVACION AS STR_OBSERVACION,
					@STR_OTROS_DATOS AS STR_OTROS_DATOS,
					@STR_SENTENCIA AS STR_SENTENCIA,
					@INT_NUMERO_USUARIO AS INT_NUMERO_USUARIO,
					@INT_NUMERO_SISTEMA AS INT_NUMERO_SISTEMA,
					@INT_NIVEL_ANIDAMIENTO AS INT_NIVEL_ANIDAMIENTO,
					@INT_NUMERO_LINEA AS INT_NUMERO_LINEA,
					@STR_IDENTIFICADOR_EXTERNO AS STR_IDENTIFICADOR_EXTERNO,
					@UNQ_IDENTIFICADOR_UNICO AS UNQ_IDENTIFICADOR_UNICO;
				SELECT @BIN_PK_TBL_EJE_TRA_EXEPCION = SCOPE_IDENTITY();

				IF (@VBI_DATOS != NULL)
				BEGIN
					SELECT @FEC_CREACION = GETDATE();

					SELECT @INT_ERROR_NUMERO_USUARIO = 75006;
					SELECT @STR_ERROR_MENSAJE = 'ERROR AL INSERTAR EN TABLA <TBL_EJE_TRA_EXCEPCION_BINARIOS>';
				END;

				IF (@SIN_MODO_EJECUCION = @SIN_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT CONCAT('00040-', @STR_ERROR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@BIN_REGISTRA_XML_PROCESOS_SISTEMA AS BIT_REGISTRA_XML_PROCESOS_SISTEMA,
						@INT_ID_ORIGEN AS INT_ID_ORIGEN,
						@INT_ID_ORIGEN_PROCEDIMIENTO AS INT_ID_ORIGEN_PROCEDIMIENTO,
						@UNQ_IDENTIFICADOR_UNICO AS UNQ_IDENTIFICADOR_UNICO;

					SELECT @SIN_FK_UTL_PAR_PAIS AS SIN_FK_UTL_PAR_PAIS,
						@STR_USUARIO_CREACION AS STR_USUARIO_CREACION,
						@FEC_CREACION AS FEC_CREACION,
						'' AS STR_USUARIO_MODIFICACION,
						'19000101' AS FEC_MODIFICACION,
						@SIN_ID_TIPO_DATOS AS SIN_ID_TIPO_DATOS,
						@VBI_DATOS AS VBI_DATOS,
						@STR_DESCRIPCION_TIPO_DATOS AS STR_DESCRIPCION_TIPO_DATOS,
						@UNQ_IDENTIFICADOR_UNICO AS UNQ_IDENTIFICADOR_UNICO,
						@BIN_PK_TBL_EJE_TRA_EXEPCION AS BIN_FK_TBL_EJE_TRA_EXCEPCION;
				END;

				IF (@SIN_MODO_EJECUCION = @SIN_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT CONCAT('999999-', @STR_ERROR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@XML_DATOS AS XML_DATOS;
				END;
		END; /*FINAL-CUERPO PROCEDIMIENTO*/

		--COMMIT TRANSACTION 

        RETURN 0;
    --+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
	END TRY
	BEGIN CATCH
		PRINT CONCAT('GLOBAL TRY', ERROR_MESSAGE());
		IF (@SIN_MODO_EJECUCION = @SIN_MODO_EJECUCION_DEPURACION)
		BEGIN
			SELECT CONCAT('ERROR-99999-01-', @STR_ERROR_PROCESO) AS BANDERA,
				GETDATE() AS FECHA,
				XACT_STATE() AS [XACT_STATE],
				@@TRANCOUNT AS TRANCOUNT;
		END;

		SELECT @STR_ERROR_OBSERVACION = '(' + CONVERT(VARCHAR, ISNULL(@@NESTLEVEL, 0)) + ')-PROCESO:' + ISNULL(@STR_ERROR_PROCESO, 'N/D')
										+ ', PROCESO ERROR:' + CONVERT(VARCHAR, ISNULL(ERROR_PROCEDURE(), 0)) + ', NUMERO USUARIO:'
										+ CONVERT(VARCHAR, ISNULL(@INT_ERROR_NUMERO_USUARIO, 0)) + ', NUMERO SISTEMA:'
										+ CONVERT(VARCHAR, ISNULL(ERROR_NUMBER(), 0)) + ', MENSAJE:' + ISNULL(@STR_ERROR_MENSAJE, 'N/D')
										+ ', LINEA ERROR:' + CONVERT(VARCHAR, ISNULL(ERROR_LINE(), 0)) + '|' + ISNULL(ERROR_MESSAGE(), 'N/D');

		RAISERROR(@STR_ERROR_OBSERVACION, 16, 1);

		RETURN @INT_ERROR_NUMERO_USUARIO;
	END CATCH;

	RETURN 0;
END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>  
-- RELEASE:		<0000>
-- FECHA:		<2023/06/19>
-- DESCRIPCION: <OBTIENE LOS REGISTROS DE LA TABLA DE USUARIOS>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <NOMBRE.APELLIDO>       
--FECHA:   <YYYY/MM/DD>             
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_CON_TBL_PMK_CONTROL_USUARIO
	@P_OPCION SMALLINT = 0, /*SIRVE PARA CONFIGURAR COMPORTAMIENTOS O FLUJOS EN EL PROCESO*/
	@P_USUARIO VARCHAR(50) = '', /*USUARIO QUIEN REALIZA LA ACCION*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECESITAR VALIDADR, EJECUCION_DEPURACION=7, EJECUCION_NORMAL=0*/
	@P_PK_TBL_PMK_CONTROL_USUARIO BIGINT = 0, /*ID DEL USUARIO*/
	@P_CEDULA VARCHAR(20) = '', /*NUMERO DE CEDULA DEL USUARIO*/
	@P_CONTRASENA VARCHAR(20) = '', /*CONTRASEÑA DEL USUARIO*/
	@P_NOMBRE VARCHAR(35) = '', /*NOMBRE DEL USUARIO*/
	@P_APELLIDO1 VARCHAR(35) = '' /*PRIMER APELLIDO DEL USUARIO*/
AS
BEGIN
	SET NOCOUNT ON;

	BEGIN TRY
		BEGIN /*INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCIO_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_ID_ORIGEN_PROCEDIMENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO-SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIFICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FINSOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERROES*/
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();
				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '1';
				DECLARE @V_ERR_PARAAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR,2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
				DECLARE	@V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
				DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
				DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
				DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
				DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
				DECLARE @VBI_ERR_DATOS VARBINARY(MAX);
				DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) ='';
				DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
				DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
				DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
				DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUTION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/

			END; /*FIN-ADMINISTRACION ERRORES*/

			--BEGIN /*INICIO VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

			--END; /*FIN VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

		END; /*FIN-DECLARARCION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION, 
					GETDATE() AS FECHA,
					@P_USUARIO AS STR_USUARIO,
					@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
					@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_BIT_EJEC_ACTIVO_EJECUTION AS BIT_EJEC_ACTIVO_EJECUCION,
					@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUTION = 1)
			BEGIN 
				
				/*BEGIN TRANSACTION*/

				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('00030-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA;
				END;

				--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
                --DETALLE DEL PROCEDIMIENTO 

				IF (@P_OPCION = 0)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75001;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 0, INICIO DE SESION';
					
					SELECT TIU.PK_TBL_PMK_CONTROL_USUARIO,
						TIU.CEDULA,
						TIU.CONTRASENA,
						TIU.NOMBRE,
						TIU.APELLIDO1,
						TIU.APELLIDO2,
						TIU.ID_ROL,
						TIE.ROL,
						TIU.USUARIO_CREACION,
                        TIU.FECHA_CREACION,
                        TIU.USUARIO_MODIFICACION,
                        TIU.FECHA_MODIFICACION
					FROM PAWPLACE.TBL_PMK_CONTROL_USUARIO AS TIU INNER JOIN
					PAWPLACE.TBL_PMK_ROL AS TIE ON TIE.PK_TBL_PMK_ROL = TIU.ID_ROL
					WHERE (
						TIU.PK_TBL_PMK_CONTROL_USUARIO = @P_PK_TBL_PMK_CONTROL_USUARIO
						OR 
						@P_PK_TBL_PMK_CONTROL_USUARIO = 0
					)
					AND
					(
						TIU.CEDULA = @P_CEDULA
					)
					AND
					(
						TIU.CONTRASENA = @P_CONTRASENA
					);
				END;

				IF (@P_OPCION = 1)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75002;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 1, SELECT COMPLETO';
					
					SELECT TIU.PK_TBL_PMK_CONTROL_USUARIO,
						TIU.CEDULA,
						TIU.CONTRASENA,
						TIU.NOMBRE,
						TIU.APELLIDO1,
						TIU.APELLIDO2,
						TIE.ROL,
						TIU.USUARIO_CREACION,
                        TIU.FECHA_CREACION,
                        TIU.USUARIO_MODIFICACION,
                        TIU.FECHA_MODIFICACION
					FROM PAWPLACE.TBL_PMK_CONTROL_USUARIO AS TIU
					INNER JOIN
					PAWPLACE.TBL_PMK_ROL AS TIE ON TIE.PK_TBL_PMK_ROL = TIU.ID_ROL
					WHERE (
						TIU.PK_TBL_PMK_CONTROL_USUARIO = @P_PK_TBL_PMK_CONTROL_USUARIO
						OR 
						@P_PK_TBL_PMK_CONTROL_USUARIO = 0
					);
				END;
				IF (@P_OPCION = 2)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75002;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 2, SELECT COMPLETO POR NOMBRE O APELLIDO';
					SELECT TIU.PK_TBL_PMK_CONTROL_USUARIO,
						TIU.CEDULA,
						TIU.CONTRASENA,
						TIU.NOMBRE,
						TIU.APELLIDO1,
						TIU.APELLIDO2,
						TIE.ROL,
						TIU.USUARIO_CREACION,
                        TIU.FECHA_CREACION,
                        TIU.USUARIO_MODIFICACION,
                        TIU.FECHA_MODIFICACION
					FROM PAWPLACE.TBL_PMK_CONTROL_USUARIO AS TIU
					INNER JOIN
					PAWPLACE.TBL_PMK_ROL AS TIE ON TIE.PK_TBL_PMK_ROL = TIU.ID_ROL
					WHERE (
						TIU.PK_TBL_PMK_CONTROL_USUARIO = @P_PK_TBL_PMK_CONTROL_USUARIO
						OR 
						@P_PK_TBL_PMK_CONTROL_USUARIO = 0
					)
					AND
					(
						TIU.NOMBRE = @P_NOMBRE
						OR 
						@P_NOMBRE = ''
					)
					AND
					(
						TIU.APELLIDO1 = @P_APELLIDO1
						OR 
						@P_APELLIDO1 = ''
					)
				END;
				/*COMMIT TRANSACTION*/

			END;
		END; /*FIN-CUERPO PROCEDIMIENTO*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	END TRY
	BEGIN CATCH
		/*ROLLBACK TRANSACTION*/

		SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(),0);
		SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(),0);
		SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(),0);
		SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(),'');
		SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(),0);

		SELECT @V_ERR_PARAAMETROS =
			('@P_OPCION= ' + CAST(@P_OPCION AS VARCHAR(50)) + ' ,' + '@P_USUARIO= ' + '''' + @P_USUARIO + ''''
			+ ' ,' + '@P_MODO_EJECUCION= '+CAST(@P_MODO_EJECUCION AS VARCHAR(50)) + ' ,' + '@P_CEDULA= '
			+ '''' + @P_CEDULA + '''' + ' ,' + '@P_CONTRASENA= '
			+ '''' + @P_CONTRASENA + '''' + ' ,' + '@P_NOMBRE= '
			+ '''' + @P_NOMBRE + '''' + ' ,' + '@P_APELLIDO1= '
			+ '''' + @P_APELLIDO1 + '''' + ' ,' + '@P_PK_TBL_PMK_CONTROL_USUARIO= ' + CAST(@P_PK_TBL_PMK_CONTROL_USUARIO AS VARCHAR(50))
			);

		/*AGREGAR PARAMETROS NUEVOS AQUI*/

		SELECT @V_ERR_OBSERVACION =
			'(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ' ,'
			+ 'MENSAJE: ' + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' 
			+ ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D') + ' ,' + 'PROCESO: '
			+ ISNULL(@V_ERR_PROCESO, 'N/D');

		SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAAMETROS);

		DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);

		EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
														@SIN_FK_UTL_PAR_PAIS = '',
														@STR_USUARIO_CREACION = @P_USUARIO,
														@FEC_CREACION = @V_FEC_ERR_CREACION,
														@STR_USUARIO_MODIFICACION = '',
														@FEC_MODIFICACION = '',
														@INT_ID_SPID = @V_ERR_ID_SPID,
														@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
														@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
														@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
														@INT_ERROR_ESTADO = @V_ERR_ESTADO,
														@STR_SERVIDOR = @V_ERR_SERVIDOR,
														@STR_ESTACION = '',
														@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
														@STR_APLICATIVO = @V_ERR_APLICATIVO,
														@STR_CLASE = '',
														@STR_EVENTO = '',
														@STR_PROCESO = @V_ERR_PROCESO,
														@STR_PARAMETROS = @V_ERR_PARAAMETROS,
														@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
														@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
														@INT_ID_TIPO = @V_ERR_ID_TIPO,
														@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
														@STR_DETALLE = @V_ERR_DETALLE,
														@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
														@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
														@STR_OBSERVACION = @V_ERR_OBSERVACION,
														@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
														@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
														@VBI_DATOS = @VBI_ERR_DATOS,
														@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO_DATOS,
														@STR_SENTENCIA = @V_ERR_SENTENCIA,
														@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
														@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
														@INT_NIVEL_ANIDAMIENTO = @V_ERR_NIVEL_ANIDAMIENTO,
														@INT_NUMERO_LINEA = @V_ERR_NUMERO_LINEA,
														@STR_IDENTIFICADOR_EXTERNO = 0,
														@STR_IDENTIFICADOR_UNICO = @V_IDENTIFICADOR_UNICO;

		RAISERROR(@V_ERR_OBSERVACION, 16, 1);
	END CATCH;
END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>
-- RELEASE:		<0000>
-- FECHA:		<2023/06/19>
-- DESCRIPCION: <PROCEDIMIENTO ALMACENADO DE PROCESO DE MANTENIMIETO DE LOS USUARIOS>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <NOMBRE.APELLIDO>       
--FECHA:   <YYYY/MM/DD>       
--TICKET:   <00000>       
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_MAN_TBL_PMK_CONTROL_USUARIO
(
	@P_USUARIO VARCHAR(50) = '', /*USUARIO DE LA APLICACION QUE EJECUTA*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECEISTAR VALIDAR, EJECUCION_DUPRACION=7, EJECUCION_NORMLA=0*/
	@P_OPCION SMALLINT = 0, /*OPCION SIRVE PARA CONFIGURAR COMPORTAMIENTO O FLUJOS EN EL PROCESO*/
	@P_IDENTIFICACODR_EXTERNO VARCHAR(50) = '', /*IDENTIDICADOR ENVIADO DESDE EL APLICATIVO, ESTE SE ALMACENA EN LAS BITACORAS DE EJECUCION O EN LAS BITACORAS DE EXCEPCIONES*/
	@P_PK_TBL_PMK_CONTROL_USUARIO BIGINT = 0,
	@P_CEDULA VARCHAR(20) = '',
	@P_CONTRASENA VARCHAR(20) = '',
	@P_NOMBRE VARCHAR(35) = '',
	@P_APELLIDO1 VARCHAR(35) = '',
	@P_APELLIDO2 VARCHAR(35) = '',
	@P_ID_ROL BIGINT = 0
)
AS
BEGIN

	SET XACT_ABORT, NOCOUNT ON; --ADDED TO PREVENT EXTRA RESULT SETS FROM INTERFERING WITH SELECT STATEMENTS.
    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; --SERIALIZABLE; -- ADD NOLOCK ALL TABLES 

	BEGIN TRY
		BEGIN TRANSACTION;
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
        -----------------------------                                    
        --DECLARACION Y ASIGNACION DE VARIABLES                                  
        -----------------------------
		BEGIN /**INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCION_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_OPCION_NORMAL SMALLINT = 0;
				DECLARE @V_ID_ORIGEN_WINDOWS_FORM INT = 1;
				DECLARE @V_DESCRIPCION_ORIGEN_WINDOWS_FORM VARCHAR(300) = 'WINDOWS FORM';
				DECLARE @V_ID_ORIGEN_WEB_SERVICE INT = 2;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SERVICE VARCHAR(300) = 'WEB SERVICE';
				DECLARE @V_ID_ORIGEN_WEB_SITE INT = 3;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SITE VARCHAR(300) = 'WEB SITE';
				DECLARE @V_ID_ORIGEN_PROCEDIMIENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_ORIGEN_REPORTING_SERVICE INT = 5;
				DECLARE @V_DESCRIPCION_ORIGEN_REPORTING_SERVICE VARCHAR(300) = 'REPORTING SERVICE';
				DECLARE @V_ID_ORIGEN_ETL INT = 6;
				DECLARE @V_DESCRIPCION_ORIGEN_ETL VARCHAR(300) = 'ETL';
				DECLARE @V_ID_ORIGEN_JOB INT = 7;
				DECLARE @V_DESCRIPCION_ORIGEN_JOB VARCHAR(300) = 'JOB';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
				DECLARE @V_ID_TIPO_EXCEPCION INT = 2;
				DECLARE @V_DESCRIPCION_TIPO_EXCEPCIPN VARCHAR(300) = 'EXCEPCION-PERSONALIZADA';
				DECLARE @V_ID_TIPO_DATOS_XML SMALLINT = 1; /*ID TIPO DATO XML*/
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIDICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FIN-SOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERRORES*/
				DECLARE @V_ERR_FK_UTL_PAR_PAIS SMALLINT = 0;
				DECLARE @V_ERR_USUARIO_CREACION VARCHAR(50) = ISNULL(@P_USUARIO, 'N/D');
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();

				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NOMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_PARAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO; /*1=WINDOWS FORM, 2=WEB SERVICE, 3=WEB SITE, 4=PROCEDIMIENTO, 5=REPORTING SERVICE, 6=ETL*/
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR, 2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
                DECLARE @V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
                DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
                DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
                DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_XML_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
                DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
                DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
                
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '';

				SELECT TOP 1
						@V_ERR_APLICATIVO = (
                                       'HOST:'+
                                       ISNULL(vs.host_name, 'N/D')+
                                       ' | PROGRAM:'+
                                       ISNULL(vs.program_name, 'N,/D')+
                                       ' | LOGIN:'+
                                       ISNULL(vs.login_name, 'N,/D')
									   )
				FROM sys.dm_exec_requests vr
						INNER JOIN sys.dm_exec_sessions vs
							ON vr.session_id = vs.session_id
				WHERE vr.session_id = @V_ERR_ID_SPID;

				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
                DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
                DECLARE @VBI_ERR_DATOS VARBINARY(MAX) = NULL;
                DECLARE @V_EJEC_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
                DECLARE @V_EJEC_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUCION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/
				DECLARE @V_OBSERVACIONES VARCHAR(MAX) = '';

			END; /*FIN-ADMINISTRACION ERRORES*/

			BEGIN /*INICIO-VARIOS*/
				DECLARE @V_CANTIDAD_REGISTROS INT = 0;
				DECLARE @V_BIT_REGISTRA_XML_PROCESOS_SISTEMA BIT = 0;

				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + '@P_USUARIO=' + '''' 
											+ ISNULL(@P_USUARIO, 'N/D') + '''');
				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + ', @IDENTIFICADOR_EXTERNO=' 
											+ '''' + ISNULL(@P_IDENTIFICACODR_EXTERNO, 'N/D') 
											+ '''');

				--DETALLE CUERPO

                -- FIN DETALLE CUERPO

				SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAMETROS);

				/*SI NO VIENE NINGUN VALOR SE GENERA UNO*/
				SELECT @P_IDENTIFICACODR_EXTERNO = CASE
														WHEN LTRIM(RTRIM(@P_IDENTIFICACODR_EXTERNO)) = ''
															THEN 
																CONVERT(VARCHAR(50), NEWID())
														ELSE
															@P_IDENTIFICACODR_EXTERNO
													END;
			END; /*FIN-VARIOS*/

			--BEGIN /*INICIO-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
			DECLARE @SET_CAMPANA NVARCHAR(MAX);
            DECLARE @ParmDefinition NVARCHAR(MAX);

            DECLARE @V_VALOR BIGINT;
			--END; /*FIN-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
		END; /*FIN-DECLARACION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@P_USUARIO AS STR_USUARIO,
						@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
						@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			--------------------------------------------------------------------------------------------------------------------------------
            --BEGIN--INICIO-INICIAL REGISTRO DE BITACORAS DE EJECUCION

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_BIT_EJEC_ACTIVO_EJECUCION AS BIT_EJEC_ACTIVO_EJECUCION,
						@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUCION = 1)
			BEGIN
			/*BEGIN TRANSACTION*/

			--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
            --DETALLE DEL PROCEDIMIENTO 
				IF (@P_OPCION = 0)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75001;
					SELECT @V_ERR_MENSAJE_USUARIO = 'INSERCION O ACTUALIZACION DE UN DATO';

					IF EXISTS
					(
						SELECT TOP 1 *
						FROM PAWPLACE.TBL_PMK_CONTROL_USUARIO AS TIU WITH (NOLOCK)
						WHERE TIU.PK_TBL_PMK_CONTROL_USUARIO = @P_PK_TBL_PMK_CONTROL_USUARIO
					)
					BEGIN
						UPDATE PAWPLACE.TBL_PMK_CONTROL_USUARIO
						SET NOMBRE = @P_NOMBRE,
							APELLIDO1 = @P_APELLIDO1,
							APELLIDO2 = @P_APELLIDO2,
							CEDULA = @P_CEDULA,
							CONTRASENA = @P_CONTRASENA,
							ID_ROL = @P_ID_ROL,
							FECHA_MODIFICACION = GETDATE(),
							USUARIO_MODIFICACION = @P_USUARIO
						WHERE PK_TBL_PMK_CONTROL_USUARIO = @P_PK_TBL_PMK_CONTROL_USUARIO;
					END;
					ELSE
					BEGIN
						INSERT INTO PAWPLACE.TBL_PMK_CONTROL_USUARIO
						(
							CEDULA,
							CONTRASENA,
							NOMBRE,
							APELLIDO1,
							APELLIDO2,
							ID_ROL,
							FECHA_CREACION,
							USUARIO_CREACION
						)
						VALUES
						(
							@P_CEDULA,
							@P_CONTRASENA,
							@P_NOMBRE,
							@P_APELLIDO1,
							@P_APELLIDO2,
							@P_ID_ROL,
							GETDATE(),
							@P_USUARIO
						);
					END;
				END;

				IF (@P_OPCION = 1)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75002;
					SELECT @V_ERR_MENSAJE_USUARIO = 'ELIMINACION DE UN DATO';
					
					DELETE PAWPLACE.TBL_PMK_CONTROL_USUARIO
					WHERE PK_TBL_PMK_CONTROL_USUARIO = @P_PK_TBL_PMK_CONTROL_USUARIO;
				END;
				-- FIN DETALLE CUERPO
			END;

			COMMIT TRANSACTION;

		END; /*FIN-CUERPO PROCEDIMIENTO*/
--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++   
	END TRY
	BEGIN CATCH
		-----------------------------                                    
        --ADMINISTRACION DE ERRORES                                  
        -----------------------------
		BEGIN /*INICIO-ADMINISTRACION DE ERRORES*/

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('ERROR-99999-01-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						XACT_STATE() AS [XACT_STATE],
						@@TRANCOUNT AS TRANSCOUNT;
			END;

			/*VALIDA SI LA TRANSACCION NO SE PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = -1
			BEGIN
				IF (@@TRANCOUNT > 0)
				BEGIN
					ROLLBACK TRANSACTION;
				END;
			END;

			/*VALIDA SI LA TRANSACCION PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = 1
			BEGIN
				IF(@@TRANCOUNT > 0)
				BEGIN
					COMMIT TRANSACTION;
				END;
			END;

			/*ERRORHANDLER*/

			SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
			SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
			SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
			SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
			SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

			/*DEFINICION DE MENSAJE DE ERROR*/

			SELECT @V_ERR_OBSERVACION = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ', MENSAJE:'
										+ ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
										+ ', PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');
			BEGIN TRY
				
				SELECT @V_FEC_ERR_CREACION = GETDATE();

				DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);
				EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
																@SIN_FK_UTL_PAR_PAIS = '',
																@STR_USUARIO_CREACION = @P_USUARIO,
																@FEC_CREACION = @V_FEC_ERR_CREACION,
																@STR_USUARIO_MODIFICACION = '',
																@FEC_MODIFICACION = '19000101',
																@INT_ID_SPID = @V_ERR_ID_SPID,
																@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
																@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
																@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
																@INT_ERROR_ESTADO = @V_ERR_ESTADO,
																@STR_SERVIDOR = @V_ERR_SERVIDOR,
																@STR_ESTACION = '',
																@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
																@STR_APLICATIVO = @V_ERR_APLICATIVO,
																@STR_CLASE = '',
																@STR_EVENTO = '',
																@STR_PROCESO = @V_ERR_PROCESO,
																@STR_PARAMETROS = @V_ERR_PARAMETROS,
																@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
																@INT_ID_TIPO = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
																@STR_DETALLE = @V_ERR_DETALLE,
																@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
																@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
																@STR_OBSERVACION = @V_ERR_OBSERVACION,
																@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
																@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
																@VBI_DATOS = @VBI_ERR_DATOS,
																@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO,
																@STR_SENTENCIA = @V_ERR_SENTENCIA,
																@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
																@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
																@INT_NIVEL_ANIDAMIENTO = @V_ERR_NUMERO_LINEA,
																@STR_IDENTIFICADOR_EXTERNO = 0,
																@STR_IDENTIFICADOR_UNICO = @V_IDENTIDICADOR_UNICO;
			END TRY
			BEGIN CATCH
					
				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('ERROR-99999-02-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
							GETDATE() AS FECHA;
				END;
				SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
                SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
                SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
                SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
                SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

				/*DEFINICION DE MENSAJE DE ERROR*/

				SELECT @V_ERR_NUMERO_USUARIO = 76001;
                --VERBOS A UTILIZAR DE ACUERDO A LA OPERACION=SELECT:SELECCIONAR, DELETE: ELIMINAR, UPDATE: ACTUALIZAR, INSERT: INSERTAR, EXEC: EJECUTAR
                SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR AL EJECUTAR EL PROCEDIMIENTO <PA_MAN_UTL_TRA_EXCEPCION_GUARDAR>';

                SELECT @V_ERR_OBSERVACION
                    = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + +',MENSAJE:'
                      + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
                      + ',PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');

                RAISERROR(@V_ERR_OBSERVACION, 16, 1);
            END CATCH;

			RAISERROR(@V_ERR_OBSERVACION, 16, 1);

			RETURN @V_ERR_NUMERO_USUARIO;
		END; /*FIN-ADMINISTRACION DE ERRORES*/
	END CATCH;
	--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++		
    --COMMIT TRAN 	
	RETURN 0;

END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>  
-- RELEASE:		<0000>
-- FECHA:		<2023/06/19>
-- DESCRIPCION: <OBTIENE LOS REGISTROS DE LOS ROLES>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <MAURICE.LANG>       
--FECHA:   <YYYY/MM/DD>             
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_CON_TBL_PMK_ROL
	@P_OPCION SMALLINT = 0, /*SIRVE PARA CONFIGURAR COMPORTAMIENTOS O FLUJOS EN EL PROCESO*/
	@P_USUARIO VARCHAR(50) = '', /*USUARIO QUIEN REALIZA LA ACCION*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECESITAR VALIDADR, EJECUCION_DEPURACION=7, EJECUCION_NORMAL=0*/
	@P_PK_TBL_PMK_ROL BIGINT = 0, /*ID DEL ROL*/
	@P_ROL VARCHAR(20) = '' /*ROL*/
AS
BEGIN
	SET NOCOUNT ON;

	BEGIN TRY
		BEGIN /*INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCIO_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_ID_ORIGEN_PROCEDIMENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO-SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIFICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FINSOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERROES*/
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();
				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '1';
				DECLARE @V_ERR_PARAAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR,2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
				DECLARE	@V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
				DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
				DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
				DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
				DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
				DECLARE @VBI_ERR_DATOS VARBINARY(MAX);
				DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) ='';
				DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
				DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
				DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
				DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUTION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/

			END; /*FIN-ADMINISTRACION ERRORES*/

			--BEGIN /*INICIO VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

			--END; /*FIN VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

		END; /*FIN-DECLARARCION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION, 
					GETDATE() AS FECHA,
					@P_USUARIO AS STR_USUARIO,
					@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
					@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_BIT_EJEC_ACTIVO_EJECUTION AS BIT_EJEC_ACTIVO_EJECUCION,
					@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUTION = 1)
			BEGIN 
				
				/*BEGIN TRANSACTION*/

				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('00030-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA;
				END;

				--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
                --DETALLE DEL PROCEDIMIENTO 

				IF (@P_OPCION = 0)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75001;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 0, SELECT COMPLETO';
					
					SELECT TIB.PK_TBL_PMK_ROL,
						TIB.ROL,
						TIB.FECHA_CREACION,
						TIB.USUARIO_CREACION,
						TIB.FECHA_MODIFICACION,
						TIB.USUARIO_MODIFICACION
					FROM PAWPLACE.TBL_PMK_ROL AS TIB
					WHERE (
						TIB.PK_TBL_PMK_ROL = @P_PK_TBL_PMK_ROL
						OR 
						@P_PK_TBL_PMK_ROL = 0
					)
					AND
					(
						TIB.ROL = @P_ROL
						OR
						@P_ROL = ''
					);
				END;		
				/*COMMIT TRANSACTION*/

			END;
		END; /*FIN-CUERPO PROCEDIMIENTO*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	END TRY
	BEGIN CATCH
		/*ROLLBACK TRANSACTION*/

		SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(),0);
		SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(),0);
		SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(),0);
		SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(),'');
		SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(),0);

		SELECT @V_ERR_PARAAMETROS =
			('@P_OPCION= ' + CAST(@P_OPCION AS VARCHAR(50)) + ' ,' + '@P_USUARIO= ' + '''' + @P_USUARIO + ''''
			+ ' ,' + '@P_MODO_EJECUCION= '+CAST(@P_MODO_EJECUCION AS VARCHAR(50)) + ' ,' + '@P_ROL= '
			+ '''' + @P_ROL + '''' + ' ,' + '@P_PK_TBL_PMK_ROL= ' + CAST(@P_PK_TBL_PMK_ROL AS VARCHAR(50))
			);

		/*AGREGAR PARAMETROS NUEVOS AQUI*/

		SELECT @V_ERR_OBSERVACION =
			'(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ' ,'
			+ 'MENSAJE: ' + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' 
			+ ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D') + ' ,' + 'PROCESO: '
			+ ISNULL(@V_ERR_PROCESO, 'N/D');

		SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAAMETROS);

		DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);

		EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
														@SIN_FK_UTL_PAR_PAIS = '',
														@STR_USUARIO_CREACION = @P_USUARIO,
														@FEC_CREACION = @V_FEC_ERR_CREACION,
														@STR_USUARIO_MODIFICACION = '',
														@FEC_MODIFICACION = '',
														@INT_ID_SPID = @V_ERR_ID_SPID,
														@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
														@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
														@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
														@INT_ERROR_ESTADO = @V_ERR_ESTADO,
														@STR_SERVIDOR = @V_ERR_SERVIDOR,
														@STR_ESTACION = '',
														@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
														@STR_APLICATIVO = @V_ERR_APLICATIVO,
														@STR_CLASE = '',
														@STR_EVENTO = '',
														@STR_PROCESO = @V_ERR_PROCESO,
														@STR_PARAMETROS = @V_ERR_PARAAMETROS,
														@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
														@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
														@INT_ID_TIPO = @V_ERR_ID_TIPO,
														@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
														@STR_DETALLE = @V_ERR_DETALLE,
														@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
														@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
														@STR_OBSERVACION = @V_ERR_OBSERVACION,
														@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
														@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
														@VBI_DATOS = @VBI_ERR_DATOS,
														@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO_DATOS,
														@STR_SENTENCIA = @V_ERR_SENTENCIA,
														@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
														@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
														@INT_NIVEL_ANIDAMIENTO = @V_ERR_NIVEL_ANIDAMIENTO,
														@INT_NUMERO_LINEA = @V_ERR_NUMERO_LINEA,
														@STR_IDENTIFICADOR_EXTERNO = 0,
														@STR_IDENTIFICADOR_UNICO = @V_IDENTIFICADOR_UNICO;

		RAISERROR(@V_ERR_OBSERVACION, 16, 1);
	END CATCH;
END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>
-- RELEASE:		<0000>
-- FECHA:		<2023/06/19>
-- DESCRIPCION: <PROCEDIMIENTO ALMACENADO DE PROCESO DE MANTENIMIETO DE LLOS ROLES>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <NOMBRE.APELLIDO>       
--FECHA:   <YYYY/MM/DD>       
--TICKET:   <00000>       
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_MAN_TBL_PMK_ROL
(
	@P_USUARIO VARCHAR(50) = '', /*USUARIO DE LA APLICACION QUE EJECUTA*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECEISTAR VALIDAR, EJECUCION_DUPRACION=7, EJECUCION_NORMLA=0*/
	@P_OPCION SMALLINT = 0, /*OPCION SIRVE PARA CONFIGURAR COMPORTAMIENTO O FLUJOS EN EL PROCESO*/
	@P_IDENTIFICACODR_EXTERNO VARCHAR(50) = '', /*IDENTIDICADOR ENVIADO DESDE EL APLICATIVO, ESTE SE ALMACENA EN LAS BITACORAS DE EJECUCION O EN LAS BITACORAS DE EXCEPCIONES*/
	@P_PK_TBL_PMK_ROL BIGINT = 0,
	@P_ROL VARCHAR(20) = ''
)
AS
BEGIN

	SET XACT_ABORT, NOCOUNT ON; --ADDED TO PREVENT EXTRA RESULT SETS FROM INTERFERING WITH SELECT STATEMENTS.
    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; --SERIALIZABLE; -- ADD NOLOCK ALL TABLES 

	BEGIN TRY
		BEGIN TRANSACTION;
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
        -----------------------------                                    
        --DECLARACION Y ASIGNACION DE VARIABLES                                  
        -----------------------------
		BEGIN /**INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCION_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_OPCION_NORMAL SMALLINT = 0;
				DECLARE @V_ID_ORIGEN_WINDOWS_FORM INT = 1;
				DECLARE @V_DESCRIPCION_ORIGEN_WINDOWS_FORM VARCHAR(300) = 'WINDOWS FORM';
				DECLARE @V_ID_ORIGEN_WEB_SERVICE INT = 2;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SERVICE VARCHAR(300) = 'WEB SERVICE';
				DECLARE @V_ID_ORIGEN_WEB_SITE INT = 3;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SITE VARCHAR(300) = 'WEB SITE';
				DECLARE @V_ID_ORIGEN_PROCEDIMIENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_ORIGEN_REPORTING_SERVICE INT = 5;
				DECLARE @V_DESCRIPCION_ORIGEN_REPORTING_SERVICE VARCHAR(300) = 'REPORTING SERVICE';
				DECLARE @V_ID_ORIGEN_ETL INT = 6;
				DECLARE @V_DESCRIPCION_ORIGEN_ETL VARCHAR(300) = 'ETL';
				DECLARE @V_ID_ORIGEN_JOB INT = 7;
				DECLARE @V_DESCRIPCION_ORIGEN_JOB VARCHAR(300) = 'JOB';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
				DECLARE @V_ID_TIPO_EXCEPCION INT = 2;
				DECLARE @V_DESCRIPCION_TIPO_EXCEPCIPN VARCHAR(300) = 'EXCEPCION-PERSONALIZADA';
				DECLARE @V_ID_TIPO_DATOS_XML SMALLINT = 1; /*ID TIPO DATO XML*/
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIDICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FIN-SOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERRORES*/
				DECLARE @V_ERR_FK_UTL_PAR_PAIS SMALLINT = 0;
				DECLARE @V_ERR_USUARIO_CREACION VARCHAR(50) = ISNULL(@P_USUARIO, 'N/D');
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();

				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NOMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_PARAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO; /*1=WINDOWS FORM, 2=WEB SERVICE, 3=WEB SITE, 4=PROCEDIMIENTO, 5=REPORTING SERVICE, 6=ETL*/
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR, 2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
                DECLARE @V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
                DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
                DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
                DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_XML_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
                DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
                DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
                
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '';

				SELECT TOP 1
						@V_ERR_APLICATIVO = (
                                       'HOST:'+
                                       ISNULL(vs.host_name, 'N/D')+
                                       ' | PROGRAM:'+
                                       ISNULL(vs.program_name, 'N,/D')+
                                       ' | LOGIN:'+
                                       ISNULL(vs.login_name, 'N,/D')
									   )
				FROM sys.dm_exec_requests vr
						INNER JOIN sys.dm_exec_sessions vs
							ON vr.session_id = vs.session_id
				WHERE vr.session_id = @V_ERR_ID_SPID;

				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
                DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
                DECLARE @VBI_ERR_DATOS VARBINARY(MAX) = NULL;
                DECLARE @V_EJEC_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
                DECLARE @V_EJEC_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUCION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/
				DECLARE @V_OBSERVACIONES VARCHAR(MAX) = '';

			END; /*FIN-ADMINISTRACION ERRORES*/

			BEGIN /*INICIO-VARIOS*/
				DECLARE @V_CANTIDAD_REGISTROS INT = 0;
				DECLARE @V_BIT_REGISTRA_XML_PROCESOS_SISTEMA BIT = 0;

				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + '@P_USUARIO=' + '''' 
											+ ISNULL(@P_USUARIO, 'N/D') + '''');
				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + ', @IDENTIFICADOR_EXTERNO=' 
											+ '''' + ISNULL(@P_IDENTIFICACODR_EXTERNO, 'N/D') 
											+ '''');

				--DETALLE CUERPO

                -- FIN DETALLE CUERPO

				SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAMETROS);

				/*SI NO VIENE NINGUN VALOR SE GENERA UNO*/
				SELECT @P_IDENTIFICACODR_EXTERNO = CASE
														WHEN LTRIM(RTRIM(@P_IDENTIFICACODR_EXTERNO)) = ''
															THEN 
																CONVERT(VARCHAR(50), NEWID())
														ELSE
															@P_IDENTIFICACODR_EXTERNO
													END;
			END; /*FIN-VARIOS*/

			--BEGIN /*INICIO-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
			DECLARE @SET_CAMPANA NVARCHAR(MAX);
            DECLARE @ParmDefinition NVARCHAR(MAX);

            DECLARE @V_VALOR BIGINT;
			--END; /*FIN-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
		END; /*FIN-DECLARACION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@P_USUARIO AS STR_USUARIO,
						@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
						@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			--------------------------------------------------------------------------------------------------------------------------------
            --BEGIN--INICIO-INICIAL REGISTRO DE BITACORAS DE EJECUCION

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_BIT_EJEC_ACTIVO_EJECUCION AS BIT_EJEC_ACTIVO_EJECUCION,
						@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUCION = 1)
			BEGIN
			/*BEGIN TRANSACTION*/

			--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
            --DETALLE DEL PROCEDIMIENTO 
				IF (@P_OPCION = 0)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75001;
					SELECT @V_ERR_MENSAJE_USUARIO = 'INSERCION O ACTUALIZACION DE UN DATO';

					IF EXISTS
					(
						SELECT TOP 1 *
						FROM PAWPLACE.TBL_PMK_ROL AS TGE WITH (NOLOCK)
						WHERE TGE.PK_TBL_PMK_ROL = @P_PK_TBL_PMK_ROL
					)
					BEGIN
						UPDATE PAWPLACE.TBL_PMK_ROL
						SET ROL = @P_ROL,
							FECHA_MODIFICACION = GETDATE(),
							USUARIO_MODIFICACION = @P_USUARIO
						WHERE PK_TBL_PMK_ROL = @P_PK_TBL_PMK_ROL;
					END;
					ELSE
					BEGIN
						INSERT INTO PAWPLACE.TBL_PMK_ROL
						(
							ROL,
							FECHA_CREACION,
							USUARIO_CREACION
						)
						VALUES
						(
							@P_ROL,
							GETDATE(),
							@P_USUARIO
						);
					END;
				END;

				IF (@P_OPCION = 1)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75002;
					SELECT @V_ERR_MENSAJE_USUARIO = 'ELIMINACION DE UN DATO';
					
					DELETE PAWPLACE.TBL_PMK_ROL
					WHERE PK_TBL_PMK_ROL = @P_PK_TBL_PMK_ROL;
				END;
				-- FIN DETALLE CUERPO
			END;

			COMMIT TRANSACTION;

		END; /*FIN-CUERPO PROCEDIMIENTO*/
--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++   
	END TRY
	BEGIN CATCH
		-----------------------------                                    
        --ADMINISTRACION DE ERRORES                                  
        -----------------------------
		BEGIN /*INICIO-ADMINISTRACION DE ERRORES*/

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('ERROR-99999-01-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						XACT_STATE() AS [XACT_STATE],
						@@TRANCOUNT AS TRANSCOUNT;
			END;

			/*VALIDA SI LA TRANSACCION NO SE PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = -1
			BEGIN
				IF (@@TRANCOUNT > 0)
				BEGIN
					ROLLBACK TRANSACTION;
				END;
			END;

			/*VALIDA SI LA TRANSACCION PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = 1
			BEGIN
				IF(@@TRANCOUNT > 0)
				BEGIN
					COMMIT TRANSACTION;
				END;
			END;

			/*ERRORHANDLER*/

			SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
			SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
			SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
			SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
			SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

			/*DEFINICION DE MENSAJE DE ERROR*/

			SELECT @V_ERR_OBSERVACION = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ', MENSAJE:'
										+ ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
										+ ', PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');
			BEGIN TRY
				
				SELECT @V_FEC_ERR_CREACION = GETDATE();

				DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);
				EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
																@SIN_FK_UTL_PAR_PAIS = '',
																@STR_USUARIO_CREACION = @P_USUARIO,
																@FEC_CREACION = @V_FEC_ERR_CREACION,
																@STR_USUARIO_MODIFICACION = '',
																@FEC_MODIFICACION = '19000101',
																@INT_ID_SPID = @V_ERR_ID_SPID,
																@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
																@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
																@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
																@INT_ERROR_ESTADO = @V_ERR_ESTADO,
																@STR_SERVIDOR = @V_ERR_SERVIDOR,
																@STR_ESTACION = '',
																@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
																@STR_APLICATIVO = @V_ERR_APLICATIVO,
																@STR_CLASE = '',
																@STR_EVENTO = '',
																@STR_PROCESO = @V_ERR_PROCESO,
																@STR_PARAMETROS = @V_ERR_PARAMETROS,
																@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
																@INT_ID_TIPO = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
																@STR_DETALLE = @V_ERR_DETALLE,
																@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
																@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
																@STR_OBSERVACION = @V_ERR_OBSERVACION,
																@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
																@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
																@VBI_DATOS = @VBI_ERR_DATOS,
																@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO,
																@STR_SENTENCIA = @V_ERR_SENTENCIA,
																@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
																@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
																@INT_NIVEL_ANIDAMIENTO = @V_ERR_NUMERO_LINEA,
																@STR_IDENTIFICADOR_EXTERNO = 0,
																@STR_IDENTIFICADOR_UNICO = @V_IDENTIDICADOR_UNICO;
			END TRY
			BEGIN CATCH
					
				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('ERROR-99999-02-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
							GETDATE() AS FECHA;
				END;
				SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
                SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
                SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
                SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
                SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

				/*DEFINICION DE MENSAJE DE ERROR*/

				SELECT @V_ERR_NUMERO_USUARIO = 76001;
                --VERBOS A UTILIZAR DE ACUERDO A LA OPERACION=SELECT:SELECCIONAR, DELETE: ELIMINAR, UPDATE: ACTUALIZAR, INSERT: INSERTAR, EXEC: EJECUTAR
                SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR AL EJECUTAR EL PROCEDIMIENTO <PA_MAN_UTL_TRA_EXCEPCION_GUARDAR>';

                SELECT @V_ERR_OBSERVACION
                    = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + +',MENSAJE:'
                      + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
                      + ',PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');

                RAISERROR(@V_ERR_OBSERVACION, 16, 1);
            END CATCH;

			RAISERROR(@V_ERR_OBSERVACION, 16, 1);

			RETURN @V_ERR_NUMERO_USUARIO;
		END; /*FIN-ADMINISTRACION DE ERRORES*/
	END CATCH;
	--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++		
    --COMMIT TRAN 	
	RETURN 0;

END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>  
-- RELEASE:		<0000>
-- FECHA:		<2023/05/10>
-- DESCRIPCION: <OBTIENE LOS REGISTROS DE LA TABLA DE CLIENTES>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <MAURICE.LANG>       
--FECHA:   <YYYY/MM/DD>             
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_CON_TBL_PMK_CLIENTE
	@P_OPCION SMALLINT = 0, /*SIRVE PARA CONFIGURAR COMPORTAMIENTOS O FLUJOS EN EL PROCESO*/
	@P_USUARIO VARCHAR(50) = '', /*USUARIO QUIEN REALIZA LA ACCION*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECESITAR VALIDADR, EJECUCION_DEPURACION=7, EJECUCION_NORMAL=0*/
	@P_PK_TBL_PMK_CLIENTE BIGINT = 0, /*ID DEL CLIENTE*/
	@P_CEDULA VARCHAR(20) = '', /*CEDULA DEL CLIENTE*/
	@P_NOMBRE VARCHAR(35) = '', /*NOMBRE DEL CLIENTE*/
	@P_APELLIDO1 VARCHAR(35) = '' /*PRIMER APELLIDO DEL CLIENTE*/
AS
BEGIN
	SET NOCOUNT ON;

	BEGIN TRY
		BEGIN /*INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCIO_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_ID_ORIGEN_PROCEDIMENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO-SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIFICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FINSOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERROES*/
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();
				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '1';
				DECLARE @V_ERR_PARAAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR,2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
				DECLARE	@V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
				DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
				DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
				DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
				DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
				DECLARE @VBI_ERR_DATOS VARBINARY(MAX);
				DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) ='';
				DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
				DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
				DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
				DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUTION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/

			END; /*FIN-ADMINISTRACION ERRORES*/

			--BEGIN /*INICIO VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

			--END; /*FIN VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

		END; /*FIN-DECLARARCION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION, 
					GETDATE() AS FECHA,
					@P_USUARIO AS STR_USUARIO,
					@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
					@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_BIT_EJEC_ACTIVO_EJECUTION AS BIT_EJEC_ACTIVO_EJECUCION,
					@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUTION = 1)
			BEGIN 
				
				/*BEGIN TRANSACTION*/

				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('00030-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA;
				END;

				--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
                --DETALLE DEL PROCEDIMIENTO 

				IF (@P_OPCION = 0)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75001;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 0, SELECT COMPLETO';
					
					SELECT TIB.PK_TBL_PMK_CLIENTE,
						TIB.CEDULA,
						TIB.NOMBRE,
						TIB.APELLIDO1,
						TIB.APELLIDO2,
						TIB.CORREO,
						TIB.TELEFONO,
						TIB.FECHA_CREACION,
						TIB.USUARIO_CREACION,
						TIB.FECHA_MODIFICACION,
						TIB.USUARIO_MODIFICACION
					FROM PAWPLACE.TBL_PMK_CLIENTE AS TIB
					WHERE (
						TIB.PK_TBL_PMK_CLIENTE = @P_PK_TBL_PMK_CLIENTE
						OR 
						@P_PK_TBL_PMK_CLIENTE = 0
					)
					AND
					(
						TIB.CEDULA = @P_CEDULA
						OR
						@P_CEDULA = ''
					)
					AND
					(
						TIB.NOMBRE = @P_NOMBRE
						OR
						@P_NOMBRE = ''
					)
					AND
					(
						TIB.APELLIDO1 = @P_APELLIDO1
						OR
						@P_APELLIDO1 = ''
					);
				END;

				IF (@P_OPCION = 1)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75002;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 1, SELECT SOLO NOMBRE Y CEDULA';
					
					SELECT TIB.PK_TBL_PMK_CLIENTE,
						TIB.CEDULA,
						TIB.NOMBRE,
						TIB.APELLIDO1,
						TIB.FECHA_CREACION,
						TIB.USUARIO_CREACION,
						TIB.FECHA_MODIFICACION,
						TIB.USUARIO_MODIFICACION
					FROM PAWPLACE.TBL_PMK_CLIENTE AS TIB
					WHERE (
						TIB.PK_TBL_PMK_CLIENTE = @P_PK_TBL_PMK_CLIENTE
						OR 
						@P_PK_TBL_PMK_CLIENTE = 0
					)
					AND
					(
						TIB.CEDULA = @P_CEDULA
						OR
						@P_CEDULA = ''
					)
					AND
					(
						TIB.NOMBRE = @P_NOMBRE
						OR
						@P_NOMBRE = ''
					)
					AND
					(
						TIB.APELLIDO1 = @P_APELLIDO1
						OR
						@P_APELLIDO1 = ''
					);
				END;
				/*COMMIT TRANSACTION*/

			END;
		END; /*FIN-CUERPO PROCEDIMIENTO*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	END TRY
	BEGIN CATCH
		/*ROLLBACK TRANSACTION*/

		SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(),0);
		SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(),0);
		SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(),0);
		SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(),'');
		SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(),0);

		SELECT @V_ERR_PARAAMETROS =
			('@P_OPCION= ' + CAST(@P_OPCION AS VARCHAR(50)) + ' ,' + '@P_USUARIO= ' + '''' + @P_USUARIO + ''''
			+ ' ,' + '@P_MODO_EJECUCION= '+CAST(@P_MODO_EJECUCION AS VARCHAR(50)) + ' ,' + '@P_CEDULA= '
			+ '''' + @P_CEDULA + '''' + ' ,' + '@P_NOMBRE= '
			+ '''' + @P_NOMBRE + '''' + ' ,' + '@P_APELLIDO1= '
			+ '''' + @P_APELLIDO1 + '''' + ' ,' + '@P_PK_TBL_PMK_CLIENTE= ' + CAST(@P_PK_TBL_PMK_CLIENTE AS VARCHAR(50))
			);

		/*AGREGAR PARAMETROS NUEVOS AQUI*/

		SELECT @V_ERR_OBSERVACION =
			'(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ' ,'
			+ 'MENSAJE: ' + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' 
			+ ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D') + ' ,' + 'PROCESO: '
			+ ISNULL(@V_ERR_PROCESO, 'N/D');

		SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAAMETROS);

		DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);

		EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
														@SIN_FK_UTL_PAR_PAIS = '',
														@STR_USUARIO_CREACION = @P_USUARIO,
														@FEC_CREACION = @V_FEC_ERR_CREACION,
														@STR_USUARIO_MODIFICACION = '',
														@FEC_MODIFICACION = '',
														@INT_ID_SPID = @V_ERR_ID_SPID,
														@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
														@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
														@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
														@INT_ERROR_ESTADO = @V_ERR_ESTADO,
														@STR_SERVIDOR = @V_ERR_SERVIDOR,
														@STR_ESTACION = '',
														@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
														@STR_APLICATIVO = @V_ERR_APLICATIVO,
														@STR_CLASE = '',
														@STR_EVENTO = '',
														@STR_PROCESO = @V_ERR_PROCESO,
														@STR_PARAMETROS = @V_ERR_PARAAMETROS,
														@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
														@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
														@INT_ID_TIPO = @V_ERR_ID_TIPO,
														@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
														@STR_DETALLE = @V_ERR_DETALLE,
														@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
														@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
														@STR_OBSERVACION = @V_ERR_OBSERVACION,
														@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
														@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
														@VBI_DATOS = @VBI_ERR_DATOS,
														@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO_DATOS,
														@STR_SENTENCIA = @V_ERR_SENTENCIA,
														@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
														@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
														@INT_NIVEL_ANIDAMIENTO = @V_ERR_NIVEL_ANIDAMIENTO,
														@INT_NUMERO_LINEA = @V_ERR_NUMERO_LINEA,
														@STR_IDENTIFICADOR_EXTERNO = 0,
														@STR_IDENTIFICADOR_UNICO = @V_IDENTIFICADOR_UNICO;

		RAISERROR(@V_ERR_OBSERVACION, 16, 1);
	END CATCH;
END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>
-- RELEASE:		<0000>
-- FECHA:		<2023/06/19>
-- DESCRIPCION: <PROCEDIMIENTO ALMACENADO DE PROCESO DE MANTENIMIETO DE LOS CLIENTES>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <NOMBRE.APELLIDO>       
--FECHA:   <YYYY/MM/DD>       
--TICKET:   <00000>       
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_MAN_TBL_PMK_CLIENTE
(
	@P_USUARIO VARCHAR(50) = '', /*USUARIO DE LA APLICACION QUE EJECUTA*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECEISTAR VALIDAR, EJECUCION_DUPRACION=7, EJECUCION_NORMLA=0*/
	@P_OPCION SMALLINT = 0, /*OPCION SIRVE PARA CONFIGURAR COMPORTAMIENTO O FLUJOS EN EL PROCESO*/
	@P_IDENTIFICACODR_EXTERNO VARCHAR(50) = '', /*IDENTIDICADOR ENVIADO DESDE EL APLICATIVO, ESTE SE ALMACENA EN LAS BITACORAS DE EJECUCION O EN LAS BITACORAS DE EXCEPCIONES*/
	@P_PK_TBL_PMK_CLIENTE BIGINT = 0,
	@P_CEDULA VARCHAR(20)= '',
	@P_NOMBRE VARCHAR(35) = '',
	@P_APELLIDO1 VARCHAR(35) = '',
	@P_APELLIDO2 VARCHAR(35) = '',
	@P_CORREO VARCHAR(150) = '',
	@P_TELEFONO VARCHAR(20) = ''
)
AS
BEGIN

	SET XACT_ABORT, NOCOUNT ON; --ADDED TO PREVENT EXTRA RESULT SETS FROM INTERFERING WITH SELECT STATEMENTS.
    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; --SERIALIZABLE; -- ADD NOLOCK ALL TABLES 

	BEGIN TRY
		BEGIN TRANSACTION;
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
        -----------------------------                                    
        --DECLARACION Y ASIGNACION DE VARIABLES                                  
        -----------------------------
		BEGIN /**INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCION_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_OPCION_NORMAL SMALLINT = 0;
				DECLARE @V_ID_ORIGEN_WINDOWS_FORM INT = 1;
				DECLARE @V_DESCRIPCION_ORIGEN_WINDOWS_FORM VARCHAR(300) = 'WINDOWS FORM';
				DECLARE @V_ID_ORIGEN_WEB_SERVICE INT = 2;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SERVICE VARCHAR(300) = 'WEB SERVICE';
				DECLARE @V_ID_ORIGEN_WEB_SITE INT = 3;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SITE VARCHAR(300) = 'WEB SITE';
				DECLARE @V_ID_ORIGEN_PROCEDIMIENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_ORIGEN_REPORTING_SERVICE INT = 5;
				DECLARE @V_DESCRIPCION_ORIGEN_REPORTING_SERVICE VARCHAR(300) = 'REPORTING SERVICE';
				DECLARE @V_ID_ORIGEN_ETL INT = 6;
				DECLARE @V_DESCRIPCION_ORIGEN_ETL VARCHAR(300) = 'ETL';
				DECLARE @V_ID_ORIGEN_JOB INT = 7;
				DECLARE @V_DESCRIPCION_ORIGEN_JOB VARCHAR(300) = 'JOB';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
				DECLARE @V_ID_TIPO_EXCEPCION INT = 2;
				DECLARE @V_DESCRIPCION_TIPO_EXCEPCIPN VARCHAR(300) = 'EXCEPCION-PERSONALIZADA';
				DECLARE @V_ID_TIPO_DATOS_XML SMALLINT = 1; /*ID TIPO DATO XML*/
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIDICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FIN-SOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERRORES*/
				DECLARE @V_ERR_FK_UTL_PAR_PAIS SMALLINT = 0;
				DECLARE @V_ERR_USUARIO_CREACION VARCHAR(50) = ISNULL(@P_USUARIO, 'N/D');
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();

				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NOMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_PARAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO; /*1=WINDOWS FORM, 2=WEB SERVICE, 3=WEB SITE, 4=PROCEDIMIENTO, 5=REPORTING SERVICE, 6=ETL*/
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR, 2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
                DECLARE @V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
                DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
                DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
                DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_XML_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
                DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
                DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
                
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '';

				SELECT TOP 1
						@V_ERR_APLICATIVO = (
                                       'HOST:'+
                                       ISNULL(vs.host_name, 'N/D')+
                                       ' | PROGRAM:'+
                                       ISNULL(vs.program_name, 'N,/D')+
                                       ' | LOGIN:'+
                                       ISNULL(vs.login_name, 'N,/D')
									   )
				FROM sys.dm_exec_requests vr
						INNER JOIN sys.dm_exec_sessions vs
							ON vr.session_id = vs.session_id
				WHERE vr.session_id = @V_ERR_ID_SPID;

				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
                DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
                DECLARE @VBI_ERR_DATOS VARBINARY(MAX) = NULL;
                DECLARE @V_EJEC_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
                DECLARE @V_EJEC_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUCION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/
				DECLARE @V_OBSERVACIONES VARCHAR(MAX) = '';

			END; /*FIN-ADMINISTRACION ERRORES*/

			BEGIN /*INICIO-VARIOS*/
				DECLARE @V_CANTIDAD_REGISTROS INT = 0;
				DECLARE @V_BIT_REGISTRA_XML_PROCESOS_SISTEMA BIT = 0;

				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + '@P_USUARIO=' + '''' 
											+ ISNULL(@P_USUARIO, 'N/D') + '''');
				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + ', @IDENTIFICADOR_EXTERNO=' 
											+ '''' + ISNULL(@P_IDENTIFICACODR_EXTERNO, 'N/D') 
											+ '''');

				--DETALLE CUERPO

                -- FIN DETALLE CUERPO

				SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAMETROS);

				/*SI NO VIENE NINGUN VALOR SE GENERA UNO*/
				SELECT @P_IDENTIFICACODR_EXTERNO = CASE
														WHEN LTRIM(RTRIM(@P_IDENTIFICACODR_EXTERNO)) = ''
															THEN 
																CONVERT(VARCHAR(50), NEWID())
														ELSE
															@P_IDENTIFICACODR_EXTERNO
													END;
			END; /*FIN-VARIOS*/

			--BEGIN /*INICIO-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
			DECLARE @SET_CAMPANA NVARCHAR(MAX);
            DECLARE @ParmDefinition NVARCHAR(MAX);

            DECLARE @V_VALOR BIGINT;
			--END; /*FIN-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
		END; /*FIN-DECLARACION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@P_USUARIO AS STR_USUARIO,
						@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
						@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			--------------------------------------------------------------------------------------------------------------------------------
            --BEGIN--INICIO-INICIAL REGISTRO DE BITACORAS DE EJECUCION

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_BIT_EJEC_ACTIVO_EJECUCION AS BIT_EJEC_ACTIVO_EJECUCION,
						@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUCION = 1)
			BEGIN
			/*BEGIN TRANSACTION*/

			--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
            --DETALLE DEL PROCEDIMIENTO 
				IF (@P_OPCION = 0)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75001;
					SELECT @V_ERR_MENSAJE_USUARIO = 'INSERCION O ACTUALIZACION DE UN DATO';

					IF EXISTS
					(
						SELECT TOP 1 *
						FROM PAWPLACE.TBL_PMK_CLIENTE AS TGE WITH (NOLOCK)
						WHERE TGE.PK_TBL_PMK_CLIENTE = @P_PK_TBL_PMK_CLIENTE
					)
					BEGIN
						UPDATE PAWPLACE.TBL_PMK_CLIENTE
						SET CEDULA = @P_CEDULA,
							NOMBRE = @P_NOMBRE,
							APELLIDO1 = @P_APELLIDO1,
							APELLIDO2 = @P_APELLIDO2,
							CORREO = @P_CORREO,
							TELEFONO = @P_TELEFONO,
							FECHA_MODIFICACION = GETDATE(),
							USUARIO_MODIFICACION = @P_USUARIO
						WHERE PK_TBL_PMK_CLIENTE = @P_PK_TBL_PMK_CLIENTE;
					END;
					ELSE
					BEGIN
						INSERT INTO PAWPLACE.TBL_PMK_CLIENTE
						(
							CEDULA,
							NOMBRE,
							APELLIDO1,
							APELLIDO2,
							CORREO,
							TELEFONO,
							FECHA_CREACION,
							USUARIO_CREACION
						)
						VALUES
						(
							@P_CEDULA,
							@P_NOMBRE,
							@P_APELLIDO1,
							@P_APELLIDO2,
							@P_CORREO,
							@P_TELEFONO,
							GETDATE(),
							@P_USUARIO
						);
					END;
				END;

				IF (@P_OPCION = 1)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75002;
					SELECT @V_ERR_MENSAJE_USUARIO = 'ELIMINACION DE UN DATO';
					
					DELETE PAWPLACE.TBL_PMK_CLIENTE
					WHERE PK_TBL_PMK_CLIENTE = @P_PK_TBL_PMK_CLIENTE;
				END;
				-- FIN DETALLE CUERPO
			END;

			COMMIT TRANSACTION;

		END; /*FIN-CUERPO PROCEDIMIENTO*/
--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++   
	END TRY
	BEGIN CATCH
		-----------------------------                                    
        --ADMINISTRACION DE ERRORES                                  
        -----------------------------
		BEGIN /*INICIO-ADMINISTRACION DE ERRORES*/

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('ERROR-99999-01-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						XACT_STATE() AS [XACT_STATE],
						@@TRANCOUNT AS TRANSCOUNT;
			END;

			/*VALIDA SI LA TRANSACCION NO SE PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = -1
			BEGIN
				IF (@@TRANCOUNT > 0)
				BEGIN
					ROLLBACK TRANSACTION;
				END;
			END;

			/*VALIDA SI LA TRANSACCION PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = 1
			BEGIN
				IF(@@TRANCOUNT > 0)
				BEGIN
					COMMIT TRANSACTION;
				END;
			END;

			/*ERRORHANDLER*/

			SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
			SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
			SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
			SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
			SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

			/*DEFINICION DE MENSAJE DE ERROR*/

			SELECT @V_ERR_OBSERVACION = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ', MENSAJE:'
										+ ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
										+ ', PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');
			BEGIN TRY
				
				SELECT @V_FEC_ERR_CREACION = GETDATE();

				DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);
				EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
																@SIN_FK_UTL_PAR_PAIS = '',
																@STR_USUARIO_CREACION = @P_USUARIO,
																@FEC_CREACION = @V_FEC_ERR_CREACION,
																@STR_USUARIO_MODIFICACION = '',
																@FEC_MODIFICACION = '19000101',
																@INT_ID_SPID = @V_ERR_ID_SPID,
																@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
																@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
																@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
																@INT_ERROR_ESTADO = @V_ERR_ESTADO,
																@STR_SERVIDOR = @V_ERR_SERVIDOR,
																@STR_ESTACION = '',
																@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
																@STR_APLICATIVO = @V_ERR_APLICATIVO,
																@STR_CLASE = '',
																@STR_EVENTO = '',
																@STR_PROCESO = @V_ERR_PROCESO,
																@STR_PARAMETROS = @V_ERR_PARAMETROS,
																@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
																@INT_ID_TIPO = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
																@STR_DETALLE = @V_ERR_DETALLE,
																@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
																@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
																@STR_OBSERVACION = @V_ERR_OBSERVACION,
																@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
																@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
																@VBI_DATOS = @VBI_ERR_DATOS,
																@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO,
																@STR_SENTENCIA = @V_ERR_SENTENCIA,
																@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
																@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
																@INT_NIVEL_ANIDAMIENTO = @V_ERR_NUMERO_LINEA,
																@STR_IDENTIFICADOR_EXTERNO = 0,
																@STR_IDENTIFICADOR_UNICO = @V_IDENTIDICADOR_UNICO;
			END TRY
			BEGIN CATCH
					
				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('ERROR-99999-02-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
							GETDATE() AS FECHA;
				END;
				SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
                SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
                SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
                SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
                SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

				/*DEFINICION DE MENSAJE DE ERROR*/

				SELECT @V_ERR_NUMERO_USUARIO = 76001;
                --VERBOS A UTILIZAR DE ACUERDO A LA OPERACION=SELECT:SELECCIONAR, DELETE: ELIMINAR, UPDATE: ACTUALIZAR, INSERT: INSERTAR, EXEC: EJECUTAR
                SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR AL EJECUTAR EL PROCEDIMIENTO <PA_MAN_UTL_TRA_EXCEPCION_GUARDAR>';

                SELECT @V_ERR_OBSERVACION
                    = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + +',MENSAJE:'
                      + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
                      + ',PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');

                RAISERROR(@V_ERR_OBSERVACION, 16, 1);
            END CATCH;

			RAISERROR(@V_ERR_OBSERVACION, 16, 1);

			RETURN @V_ERR_NUMERO_USUARIO;
		END; /*FIN-ADMINISTRACION DE ERRORES*/
	END CATCH;
	--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++		
    --COMMIT TRAN 	
	RETURN 0;

END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>  
-- RELEASE:		<0000>
-- FECHA:		<2023/06/19>
-- DESCRIPCION: <OBTIENE LOS REGISTROS DE LA TABLA DE CATEGORIAS>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <MAURICE.LANG>       
--FECHA:   <YYYY/MM/DD>             
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_CON_TBL_PMK_CATEGORIA
	@P_OPCION SMALLINT = 0, /*SIRVE PARA CONFIGURAR COMPORTAMIENTOS O FLUJOS EN EL PROCESO*/
	@P_USUARIO VARCHAR(50) = '', /*USUARIO QUIEN REALIZA LA ACCION*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECESITAR VALIDADR, EJECUCION_DEPURACION=7, EJECUCION_NORMAL=0*/
	@P_PK_TBL_PMK_CATEGORIA BIGINT = 0, /*ID DE LA CATEGORIA*/
	@P_CATEGORIA VARCHAR(150) = '' /*CATEGORIA*/
AS
BEGIN
	SET NOCOUNT ON;

	BEGIN TRY
		BEGIN /*INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCIO_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_ID_ORIGEN_PROCEDIMENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO-SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIFICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FINSOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERROES*/
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();
				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '1';
				DECLARE @V_ERR_PARAAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR,2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
				DECLARE	@V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
				DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
				DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
				DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
				DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
				DECLARE @VBI_ERR_DATOS VARBINARY(MAX);
				DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) ='';
				DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
				DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
				DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
				DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUTION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/

			END; /*FIN-ADMINISTRACION ERRORES*/

			--BEGIN /*INICIO VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

			--END; /*FIN VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

		END; /*FIN-DECLARARCION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION, 
					GETDATE() AS FECHA,
					@P_USUARIO AS STR_USUARIO,
					@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
					@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_BIT_EJEC_ACTIVO_EJECUTION AS BIT_EJEC_ACTIVO_EJECUCION,
					@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUTION = 1)
			BEGIN 
				
				/*BEGIN TRANSACTION*/

				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('00030-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA;
				END;

				--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
                --DETALLE DEL PROCEDIMIENTO 

				IF (@P_OPCION = 0)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75001;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 0, SELECT COMPLETO';
					
					SELECT TIB.PK_TBL_PMK_CATEGORIA,
						TIB.CATEGORIA,
						TIB.FECHA_CREACION,
						TIB.USUARIO_CREACION,
						TIB.FECHA_MODIFICACION,
						TIB.USUARIO_MODIFICACION
					FROM PAWPLACE.TBL_PMK_CATEGORIA AS TIB
					WHERE (
						TIB.PK_TBL_PMK_CATEGORIA = @P_PK_TBL_PMK_CATEGORIA
						OR 
						@P_PK_TBL_PMK_CATEGORIA = 0
					)
					AND
					(
						TIB.CATEGORIA = @P_CATEGORIA
						OR
						@P_CATEGORIA = ''
					);
				END;
				/*COMMIT TRANSACTION*/

			END;
		END; /*FIN-CUERPO PROCEDIMIENTO*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	END TRY
	BEGIN CATCH
		/*ROLLBACK TRANSACTION*/

		SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(),0);
		SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(),0);
		SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(),0);
		SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(),'');
		SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(),0);

		SELECT @V_ERR_PARAAMETROS =
			('@P_OPCION= ' + CAST(@P_OPCION AS VARCHAR(50)) + ' ,' + '@P_USUARIO= ' + '''' + @P_USUARIO + ''''
			+ ' ,' + '@P_MODO_EJECUCION= '+CAST(@P_MODO_EJECUCION AS VARCHAR(50)) + ' ,' + '@P_CATEGORIA= '
			+ '''' + @P_CATEGORIA + '''' + '@P_PK_TBL_PMK_CATEGORIA= ' + CAST(@P_PK_TBL_PMK_CATEGORIA AS VARCHAR(50))
			);

		/*AGREGAR PARAMETROS NUEVOS AQUI*/

		SELECT @V_ERR_OBSERVACION =
			'(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ' ,'
			+ 'MENSAJE: ' + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' 
			+ ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D') + ' ,' + 'PROCESO: '
			+ ISNULL(@V_ERR_PROCESO, 'N/D');

		SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAAMETROS);

		DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);

		EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
														@SIN_FK_UTL_PAR_PAIS = '',
														@STR_USUARIO_CREACION = @P_USUARIO,
														@FEC_CREACION = @V_FEC_ERR_CREACION,
														@STR_USUARIO_MODIFICACION = '',
														@FEC_MODIFICACION = '',
														@INT_ID_SPID = @V_ERR_ID_SPID,
														@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
														@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
														@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
														@INT_ERROR_ESTADO = @V_ERR_ESTADO,
														@STR_SERVIDOR = @V_ERR_SERVIDOR,
														@STR_ESTACION = '',
														@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
														@STR_APLICATIVO = @V_ERR_APLICATIVO,
														@STR_CLASE = '',
														@STR_EVENTO = '',
														@STR_PROCESO = @V_ERR_PROCESO,
														@STR_PARAMETROS = @V_ERR_PARAAMETROS,
														@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
														@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
														@INT_ID_TIPO = @V_ERR_ID_TIPO,
														@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
														@STR_DETALLE = @V_ERR_DETALLE,
														@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
														@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
														@STR_OBSERVACION = @V_ERR_OBSERVACION,
														@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
														@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
														@VBI_DATOS = @VBI_ERR_DATOS,
														@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO_DATOS,
														@STR_SENTENCIA = @V_ERR_SENTENCIA,
														@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
														@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
														@INT_NIVEL_ANIDAMIENTO = @V_ERR_NIVEL_ANIDAMIENTO,
														@INT_NUMERO_LINEA = @V_ERR_NUMERO_LINEA,
														@STR_IDENTIFICADOR_EXTERNO = 0,
														@STR_IDENTIFICADOR_UNICO = @V_IDENTIFICADOR_UNICO;

		RAISERROR(@V_ERR_OBSERVACION, 16, 1);
	END CATCH;
END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>
-- RELEASE:		<0000>
-- FECHA:		<2023/06/19>
-- DESCRIPCION: <PROCEDIMIENTO ALMACENADO DE PROCESO DE MANTENIMIETO DE LAS CATEGORIAS>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <NOMBRE.APELLIDO>       
--FECHA:   <YYYY/MM/DD>       
--TICKET:   <00000>       
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_MAN_TBL_PMK_CATEGORIA
(
	@P_USUARIO VARCHAR(50) = '', /*USUARIO DE LA APLICACION QUE EJECUTA*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECEISTAR VALIDAR, EJECUCION_DUPRACION=7, EJECUCION_NORMLA=0*/
	@P_OPCION SMALLINT = 0, /*OPCION SIRVE PARA CONFIGURAR COMPORTAMIENTO O FLUJOS EN EL PROCESO*/
	@P_IDENTIFICACODR_EXTERNO VARCHAR(50) = '', /*IDENTIDICADOR ENVIADO DESDE EL APLICATIVO, ESTE SE ALMACENA EN LAS BITACORAS DE EJECUCION O EN LAS BITACORAS DE EXCEPCIONES*/
	@P_PK_TBL_PMK_CATEGORIA BIGINT = 0,
	@P_CATEGORIA VARCHAR(150)= ''
)
AS
BEGIN

	SET XACT_ABORT, NOCOUNT ON; --ADDED TO PREVENT EXTRA RESULT SETS FROM INTERFERING WITH SELECT STATEMENTS.
    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; --SERIALIZABLE; -- ADD NOLOCK ALL TABLES 

	BEGIN TRY
		BEGIN TRANSACTION;
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
        -----------------------------                                    
        --DECLARACION Y ASIGNACION DE VARIABLES                                  
        -----------------------------
		BEGIN /**INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCION_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_OPCION_NORMAL SMALLINT = 0;
				DECLARE @V_ID_ORIGEN_WINDOWS_FORM INT = 1;
				DECLARE @V_DESCRIPCION_ORIGEN_WINDOWS_FORM VARCHAR(300) = 'WINDOWS FORM';
				DECLARE @V_ID_ORIGEN_WEB_SERVICE INT = 2;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SERVICE VARCHAR(300) = 'WEB SERVICE';
				DECLARE @V_ID_ORIGEN_WEB_SITE INT = 3;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SITE VARCHAR(300) = 'WEB SITE';
				DECLARE @V_ID_ORIGEN_PROCEDIMIENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_ORIGEN_REPORTING_SERVICE INT = 5;
				DECLARE @V_DESCRIPCION_ORIGEN_REPORTING_SERVICE VARCHAR(300) = 'REPORTING SERVICE';
				DECLARE @V_ID_ORIGEN_ETL INT = 6;
				DECLARE @V_DESCRIPCION_ORIGEN_ETL VARCHAR(300) = 'ETL';
				DECLARE @V_ID_ORIGEN_JOB INT = 7;
				DECLARE @V_DESCRIPCION_ORIGEN_JOB VARCHAR(300) = 'JOB';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
				DECLARE @V_ID_TIPO_EXCEPCION INT = 2;
				DECLARE @V_DESCRIPCION_TIPO_EXCEPCIPN VARCHAR(300) = 'EXCEPCION-PERSONALIZADA';
				DECLARE @V_ID_TIPO_DATOS_XML SMALLINT = 1; /*ID TIPO DATO XML*/
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIDICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FIN-SOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERRORES*/
				DECLARE @V_ERR_FK_UTL_PAR_PAIS SMALLINT = 0;
				DECLARE @V_ERR_USUARIO_CREACION VARCHAR(50) = ISNULL(@P_USUARIO, 'N/D');
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();

				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NOMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_PARAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO; /*1=WINDOWS FORM, 2=WEB SERVICE, 3=WEB SITE, 4=PROCEDIMIENTO, 5=REPORTING SERVICE, 6=ETL*/
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR, 2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
                DECLARE @V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
                DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
                DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
                DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_XML_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
                DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
                DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
                
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '';

				SELECT TOP 1
						@V_ERR_APLICATIVO = (
                                       'HOST:'+
                                       ISNULL(vs.host_name, 'N/D')+
                                       ' | PROGRAM:'+
                                       ISNULL(vs.program_name, 'N,/D')+
                                       ' | LOGIN:'+
                                       ISNULL(vs.login_name, 'N,/D')
									   )
				FROM sys.dm_exec_requests vr
						INNER JOIN sys.dm_exec_sessions vs
							ON vr.session_id = vs.session_id
				WHERE vr.session_id = @V_ERR_ID_SPID;

				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
                DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
                DECLARE @VBI_ERR_DATOS VARBINARY(MAX) = NULL;
                DECLARE @V_EJEC_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
                DECLARE @V_EJEC_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUCION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/
				DECLARE @V_OBSERVACIONES VARCHAR(MAX) = '';

			END; /*FIN-ADMINISTRACION ERRORES*/

			BEGIN /*INICIO-VARIOS*/
				DECLARE @V_CANTIDAD_REGISTROS INT = 0;
				DECLARE @V_BIT_REGISTRA_XML_PROCESOS_SISTEMA BIT = 0;

				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + '@P_USUARIO=' + '''' 
											+ ISNULL(@P_USUARIO, 'N/D') + '''');
				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + ', @IDENTIFICADOR_EXTERNO=' 
											+ '''' + ISNULL(@P_IDENTIFICACODR_EXTERNO, 'N/D') 
											+ '''');

				--DETALLE CUERPO

                -- FIN DETALLE CUERPO

				SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAMETROS);

				/*SI NO VIENE NINGUN VALOR SE GENERA UNO*/
				SELECT @P_IDENTIFICACODR_EXTERNO = CASE
														WHEN LTRIM(RTRIM(@P_IDENTIFICACODR_EXTERNO)) = ''
															THEN 
																CONVERT(VARCHAR(50), NEWID())
														ELSE
															@P_IDENTIFICACODR_EXTERNO
													END;
			END; /*FIN-VARIOS*/

			--BEGIN /*INICIO-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
			DECLARE @SET_CAMPANA NVARCHAR(MAX);
            DECLARE @ParmDefinition NVARCHAR(MAX);

            DECLARE @V_VALOR BIGINT;
			--END; /*FIN-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
		END; /*FIN-DECLARACION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@P_USUARIO AS STR_USUARIO,
						@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
						@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			--------------------------------------------------------------------------------------------------------------------------------
            --BEGIN--INICIO-INICIAL REGISTRO DE BITACORAS DE EJECUCION

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_BIT_EJEC_ACTIVO_EJECUCION AS BIT_EJEC_ACTIVO_EJECUCION,
						@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUCION = 1)
			BEGIN
			/*BEGIN TRANSACTION*/

			--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
            --DETALLE DEL PROCEDIMIENTO 
				IF (@P_OPCION = 0)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75001;
					SELECT @V_ERR_MENSAJE_USUARIO = 'INSERCION O ACTUALIZACION DE UN DATO';

					IF EXISTS
					(
						SELECT TOP 1 *
						FROM PAWPLACE.TBL_PMK_CATEGORIA AS TGE WITH (NOLOCK)
						WHERE TGE.PK_TBL_PMK_CATEGORIA = @P_PK_TBL_PMK_CATEGORIA
					)
					BEGIN
						UPDATE PAWPLACE.TBL_PMK_CATEGORIA
						SET CATEGORIA = @P_CATEGORIA,
							FECHA_MODIFICACION = GETDATE(),
							USUARIO_MODIFICACION = @P_USUARIO
						WHERE PK_TBL_PMK_CATEGORIA = @P_PK_TBL_PMK_CATEGORIA;
					END;
					ELSE
					BEGIN
						INSERT INTO PAWPLACE.TBL_PMK_CATEGORIA
						(
							CATEGORIA,
							FECHA_CREACION,
							USUARIO_CREACION
						)
						VALUES
						(
							@P_CATEGORIA,
							GETDATE(),
							@P_USUARIO
						);
					END;
				END;

				IF (@P_OPCION = 1)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75002;
					SELECT @V_ERR_MENSAJE_USUARIO = 'ELIMINACION DE UN DATO';
					
					DELETE PAWPLACE.TBL_PMK_CATEGORIA
					WHERE PK_TBL_PMK_CATEGORIA = @P_PK_TBL_PMK_CATEGORIA;
				END;
				-- FIN DETALLE CUERPO
			END;

			COMMIT TRANSACTION;

		END; /*FIN-CUERPO PROCEDIMIENTO*/
--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++   
	END TRY
	BEGIN CATCH
		-----------------------------                                    
        --ADMINISTRACION DE ERRORES                                  
        -----------------------------
		BEGIN /*INICIO-ADMINISTRACION DE ERRORES*/

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('ERROR-99999-01-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						XACT_STATE() AS [XACT_STATE],
						@@TRANCOUNT AS TRANSCOUNT;
			END;

			/*VALIDA SI LA TRANSACCION NO SE PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = -1
			BEGIN
				IF (@@TRANCOUNT > 0)
				BEGIN
					ROLLBACK TRANSACTION;
				END;
			END;

			/*VALIDA SI LA TRANSACCION PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = 1
			BEGIN
				IF(@@TRANCOUNT > 0)
				BEGIN
					COMMIT TRANSACTION;
				END;
			END;

			/*ERRORHANDLER*/

			SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
			SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
			SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
			SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
			SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

			/*DEFINICION DE MENSAJE DE ERROR*/

			SELECT @V_ERR_OBSERVACION = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ', MENSAJE:'
										+ ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
										+ ', PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');
			BEGIN TRY
				
				SELECT @V_FEC_ERR_CREACION = GETDATE();

				DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);
				EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
																@SIN_FK_UTL_PAR_PAIS = '',
																@STR_USUARIO_CREACION = @P_USUARIO,
																@FEC_CREACION = @V_FEC_ERR_CREACION,
																@STR_USUARIO_MODIFICACION = '',
																@FEC_MODIFICACION = '19000101',
																@INT_ID_SPID = @V_ERR_ID_SPID,
																@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
																@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
																@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
																@INT_ERROR_ESTADO = @V_ERR_ESTADO,
																@STR_SERVIDOR = @V_ERR_SERVIDOR,
																@STR_ESTACION = '',
																@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
																@STR_APLICATIVO = @V_ERR_APLICATIVO,
																@STR_CLASE = '',
																@STR_EVENTO = '',
																@STR_PROCESO = @V_ERR_PROCESO,
																@STR_PARAMETROS = @V_ERR_PARAMETROS,
																@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
																@INT_ID_TIPO = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
																@STR_DETALLE = @V_ERR_DETALLE,
																@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
																@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
																@STR_OBSERVACION = @V_ERR_OBSERVACION,
																@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
																@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
																@VBI_DATOS = @VBI_ERR_DATOS,
																@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO,
																@STR_SENTENCIA = @V_ERR_SENTENCIA,
																@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
																@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
																@INT_NIVEL_ANIDAMIENTO = @V_ERR_NUMERO_LINEA,
																@STR_IDENTIFICADOR_EXTERNO = 0,
																@STR_IDENTIFICADOR_UNICO = @V_IDENTIDICADOR_UNICO;
			END TRY
			BEGIN CATCH
					
				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('ERROR-99999-02-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
							GETDATE() AS FECHA;
				END;
				SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
                SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
                SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
                SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
                SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

				/*DEFINICION DE MENSAJE DE ERROR*/

				SELECT @V_ERR_NUMERO_USUARIO = 76001;
                --VERBOS A UTILIZAR DE ACUERDO A LA OPERACION=SELECT:SELECCIONAR, DELETE: ELIMINAR, UPDATE: ACTUALIZAR, INSERT: INSERTAR, EXEC: EJECUTAR
                SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR AL EJECUTAR EL PROCEDIMIENTO <PA_MAN_UTL_TRA_EXCEPCION_GUARDAR>';

                SELECT @V_ERR_OBSERVACION
                    = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + +',MENSAJE:'
                      + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
                      + ',PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');

                RAISERROR(@V_ERR_OBSERVACION, 16, 1);
            END CATCH;

			RAISERROR(@V_ERR_OBSERVACION, 16, 1);

			RETURN @V_ERR_NUMERO_USUARIO;
		END; /*FIN-ADMINISTRACION DE ERRORES*/
	END CATCH;
	--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++		
    --COMMIT TRAN 	
	RETURN 0;

END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>  
-- RELEASE:		<0000>
-- FECHA:		<2023/06/19>
-- DESCRIPCION: <OBTIENE LOS REGISTROS DE LA TABLA DE INVENTARIO>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <MAURICE.LANG>       
--FECHA:   <YYYY/MM/DD>             
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_CON_TBL_PMK_INVENTARIO
	@P_OPCION SMALLINT = 0, /*SIRVE PARA CONFIGURAR COMPORTAMIENTOS O FLUJOS EN EL PROCESO*/
	@P_USUARIO VARCHAR(50) = '', /*USUARIO QUIEN REALIZA LA ACCION*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECESITAR VALIDADR, EJECUCION_DEPURACION=7, EJECUCION_NORMAL=0*/
	@P_PK_TBL_PMK_INVENTARIO BIGINT = 0, /*ID DEL PRODUCTO*/
	@P_CODIGO VARCHAR(150) = '', /*CODIGO DEL PRODUCTO*/
	@P_NOMBRE VARCHAR(150) = '', /*NOMBRE DEL PRODUCTO*/
	@P_TIPO_ANIMAL VARCHAR(20) = '', /*TIPO DE ANIMAL*/
	@P_PRECIO DECIMAL(10,2) = 0.0, /*PRECIO DEL PRODUCTO*/
	@P_CANTIDAD INT = 0, /*CANTIDAD DE PRODUCTO*/
	@P_ID_CATEGORIA INT = 0 /*ID DE LA CATEGORIA*/
AS
BEGIN
	SET NOCOUNT ON;

	BEGIN TRY
		BEGIN /*INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCIO_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_ID_ORIGEN_PROCEDIMENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO-SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIFICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FINSOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERROES*/
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();
				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '1';
				DECLARE @V_ERR_PARAAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR,2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
				DECLARE	@V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
				DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
				DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
				DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
				DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
				DECLARE @VBI_ERR_DATOS VARBINARY(MAX);
				DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) ='';
				DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
				DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
				DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
				DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUTION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/

			END; /*FIN-ADMINISTRACION ERRORES*/

			--BEGIN /*INICIO VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

			--END; /*FIN VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

		END; /*FIN-DECLARARCION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION, 
					GETDATE() AS FECHA,
					@P_USUARIO AS STR_USUARIO,
					@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
					@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_BIT_EJEC_ACTIVO_EJECUTION AS BIT_EJEC_ACTIVO_EJECUCION,
					@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUTION = 1)
			BEGIN 
				
				/*BEGIN TRANSACTION*/

				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('00030-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA;
				END;

				--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
                --DETALLE DEL PROCEDIMIENTO 

				IF (@P_OPCION = 0)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75001;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 0, SELECT COMPLETO';
					
					SELECT TIB.PK_TBL_PMK_INVENTARIO,
						TIB.CODIGO,
						TIB.NOMBRE,
						TIB.TIPO_ANIMAL,
						TIB.PRECIO,
						TIB.CANTIDAD,
						TIE.CATEGORIA,
						TIB.FECHA_CREACION,
						TIB.USUARIO_CREACION,
						TIB.FECHA_MODIFICACION,
						TIB.USUARIO_MODIFICACION
					FROM PAWPLACE.TBL_PMK_INVENTARIO AS TIB INNER JOIN
					PAWPLACE.TBL_PMK_CATEGORIA AS TIE ON TIE.PK_TBL_PMK_CATEGORIA = TIB.ID_CATEGORIA
					WHERE (
						TIB.PK_TBL_PMK_INVENTARIO = @P_PK_TBL_PMK_INVENTARIO
						OR 
						@P_PK_TBL_PMK_INVENTARIO = 0
					)
					AND
					(
						TIB.CODIGO = @P_CODIGO
						OR
						@P_CODIGO = ''
					)
					AND
					(
						TIB.NOMBRE LIKE '%'+@P_NOMBRE+'%'
						OR
						@P_NOMBRE = ''
					)
					AND
					(
						TIB.TIPO_ANIMAL = @P_TIPO_ANIMAL
						OR
						@P_TIPO_ANIMAL = ''
					)
					AND
					(
						TIB.PRECIO = @P_PRECIO
						OR
						@P_PRECIO = 0.0
					)
					AND
					(
						TIB.CANTIDAD = @P_CANTIDAD
						OR
						@P_CANTIDAD = 0
					)
					AND
					(
						TIB.ID_CATEGORIA = @P_ID_CATEGORIA
						OR
						@P_ID_CATEGORIA = 0
					);
				END;
				/*COMMIT TRANSACTION*/

			END;
		END; /*FIN-CUERPO PROCEDIMIENTO*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	END TRY
	BEGIN CATCH
		/*ROLLBACK TRANSACTION*/

		SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(),0);
		SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(),0);
		SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(),0);
		SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(),'');
		SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(),0);

		SELECT @V_ERR_PARAAMETROS =
			('@P_OPCION= ' + CAST(@P_OPCION AS VARCHAR(50)) + ' ,' + '@P_USUARIO= ' + '''' + @P_USUARIO + ''''
			+ ' ,' + '@P_MODO_EJECUCION= '+CAST(@P_MODO_EJECUCION AS VARCHAR(50)) + ' ,' + '@P_CODIGO= '
			+ '''' + @P_CODIGO + '''' + ' ,' + '@P_NOMBRE= '
			+ '''' + @P_NOMBRE + '''' + ' ,' + '@P_TIPO_ANIMAL= '
			+ '''' + @P_TIPO_ANIMAL + '''' + ' ,' + '@P_ID_CATEGORIA= ' + CAST(@P_ID_CATEGORIA AS VARCHAR(50)) + ' ,' + '@P_CANTIDAD= ' + CAST(@P_CANTIDAD AS VARCHAR(50)) + ' ,' + '@P_PRECIO= ' + CAST(@P_PRECIO AS VARCHAR(50)) + ' ,' + '@P_PK_TBL_PMK_INVENTARIO= ' + CAST(@P_PK_TBL_PMK_INVENTARIO AS VARCHAR(50))
			);

		/*AGREGAR PARAMETROS NUEVOS AQUI*/

		SELECT @V_ERR_OBSERVACION =
			'(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ' ,'
			+ 'MENSAJE: ' + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' 
			+ ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D') + ' ,' + 'PROCESO: '
			+ ISNULL(@V_ERR_PROCESO, 'N/D');

		SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAAMETROS);

		DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);

		EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
														@SIN_FK_UTL_PAR_PAIS = '',
														@STR_USUARIO_CREACION = @P_USUARIO,
														@FEC_CREACION = @V_FEC_ERR_CREACION,
														@STR_USUARIO_MODIFICACION = '',
														@FEC_MODIFICACION = '',
														@INT_ID_SPID = @V_ERR_ID_SPID,
														@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
														@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
														@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
														@INT_ERROR_ESTADO = @V_ERR_ESTADO,
														@STR_SERVIDOR = @V_ERR_SERVIDOR,
														@STR_ESTACION = '',
														@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
														@STR_APLICATIVO = @V_ERR_APLICATIVO,
														@STR_CLASE = '',
														@STR_EVENTO = '',
														@STR_PROCESO = @V_ERR_PROCESO,
														@STR_PARAMETROS = @V_ERR_PARAAMETROS,
														@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
														@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
														@INT_ID_TIPO = @V_ERR_ID_TIPO,
														@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
														@STR_DETALLE = @V_ERR_DETALLE,
														@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
														@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
														@STR_OBSERVACION = @V_ERR_OBSERVACION,
														@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
														@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
														@VBI_DATOS = @VBI_ERR_DATOS,
														@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO_DATOS,
														@STR_SENTENCIA = @V_ERR_SENTENCIA,
														@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
														@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
														@INT_NIVEL_ANIDAMIENTO = @V_ERR_NIVEL_ANIDAMIENTO,
														@INT_NUMERO_LINEA = @V_ERR_NUMERO_LINEA,
														@STR_IDENTIFICADOR_EXTERNO = 0,
														@STR_IDENTIFICADOR_UNICO = @V_IDENTIFICADOR_UNICO;

		RAISERROR(@V_ERR_OBSERVACION, 16, 1);
	END CATCH;
END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>
-- RELEASE:		<0000>
-- FECHA:		<2023/06/19>
-- DESCRIPCION: <PROCEDIMIENTO ALMACENADO DE PROCESO DE MANTENIMIETO DEL INVENTARIO>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <NOMBRE.APELLIDO>       
--FECHA:   <YYYY/MM/DD>       
--TICKET:   <00000>       
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_MAN_TBL_PMK_INVENTARIO
(
	@P_USUARIO VARCHAR(50) = '', /*USUARIO DE LA APLICACION QUE EJECUTA*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECEISTAR VALIDAR, EJECUCION_DUPRACION=7, EJECUCION_NORMLA=0*/
	@P_OPCION SMALLINT = 0, /*OPCION SIRVE PARA CONFIGURAR COMPORTAMIENTO O FLUJOS EN EL PROCESO*/
	@P_IDENTIFICACODR_EXTERNO VARCHAR(50) = '', /*IDENTIDICADOR ENVIADO DESDE EL APLICATIVO, ESTE SE ALMACENA EN LAS BITACORAS DE EJECUCION O EN LAS BITACORAS DE EXCEPCIONES*/
	@P_PK_TBL_PMK_INVENTARIO BIGINT = 0,
	@P_CODIGO VARCHAR(150) = '',
	@P_NOMBRE VARCHAR(150) = '',
	@P_TIPO_ANIMAL VARCHAR(20) = '',
	@P_PRECIO DECIMAL(10,2) = 0.0,
	@P_CANTIDAD INT = 0,
	@P_ID_CATEGORIA INT = 0
)
AS
BEGIN

	SET XACT_ABORT, NOCOUNT ON; --ADDED TO PREVENT EXTRA RESULT SETS FROM INTERFERING WITH SELECT STATEMENTS.
    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; --SERIALIZABLE; -- ADD NOLOCK ALL TABLES 

	BEGIN TRY
		BEGIN TRANSACTION;
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
        -----------------------------                                    
        --DECLARACION Y ASIGNACION DE VARIABLES                                  
        -----------------------------
		BEGIN /**INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCION_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_OPCION_NORMAL SMALLINT = 0;
				DECLARE @V_ID_ORIGEN_WINDOWS_FORM INT = 1;
				DECLARE @V_DESCRIPCION_ORIGEN_WINDOWS_FORM VARCHAR(300) = 'WINDOWS FORM';
				DECLARE @V_ID_ORIGEN_WEB_SERVICE INT = 2;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SERVICE VARCHAR(300) = 'WEB SERVICE';
				DECLARE @V_ID_ORIGEN_WEB_SITE INT = 3;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SITE VARCHAR(300) = 'WEB SITE';
				DECLARE @V_ID_ORIGEN_PROCEDIMIENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_ORIGEN_REPORTING_SERVICE INT = 5;
				DECLARE @V_DESCRIPCION_ORIGEN_REPORTING_SERVICE VARCHAR(300) = 'REPORTING SERVICE';
				DECLARE @V_ID_ORIGEN_ETL INT = 6;
				DECLARE @V_DESCRIPCION_ORIGEN_ETL VARCHAR(300) = 'ETL';
				DECLARE @V_ID_ORIGEN_JOB INT = 7;
				DECLARE @V_DESCRIPCION_ORIGEN_JOB VARCHAR(300) = 'JOB';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
				DECLARE @V_ID_TIPO_EXCEPCION INT = 2;
				DECLARE @V_DESCRIPCION_TIPO_EXCEPCIPN VARCHAR(300) = 'EXCEPCION-PERSONALIZADA';
				DECLARE @V_ID_TIPO_DATOS_XML SMALLINT = 1; /*ID TIPO DATO XML*/
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIDICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FIN-SOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERRORES*/
				DECLARE @V_ERR_FK_UTL_PAR_PAIS SMALLINT = 0;
				DECLARE @V_ERR_USUARIO_CREACION VARCHAR(50) = ISNULL(@P_USUARIO, 'N/D');
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();

				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NOMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_PARAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO; /*1=WINDOWS FORM, 2=WEB SERVICE, 3=WEB SITE, 4=PROCEDIMIENTO, 5=REPORTING SERVICE, 6=ETL*/
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR, 2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
                DECLARE @V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
                DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
                DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
                DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_XML_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
                DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
                DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
                
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '';

				SELECT TOP 1
						@V_ERR_APLICATIVO = (
                                       'HOST:'+
                                       ISNULL(vs.host_name, 'N/D')+
                                       ' | PROGRAM:'+
                                       ISNULL(vs.program_name, 'N,/D')+
                                       ' | LOGIN:'+
                                       ISNULL(vs.login_name, 'N,/D')
									   )
				FROM sys.dm_exec_requests vr
						INNER JOIN sys.dm_exec_sessions vs
							ON vr.session_id = vs.session_id
				WHERE vr.session_id = @V_ERR_ID_SPID;

				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
                DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
                DECLARE @VBI_ERR_DATOS VARBINARY(MAX) = NULL;
                DECLARE @V_EJEC_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
                DECLARE @V_EJEC_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUCION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/
				DECLARE @V_OBSERVACIONES VARCHAR(MAX) = '';

			END; /*FIN-ADMINISTRACION ERRORES*/

			BEGIN /*INICIO-VARIOS*/
				DECLARE @V_CANTIDAD_REGISTROS INT = 0;
				DECLARE @V_BIT_REGISTRA_XML_PROCESOS_SISTEMA BIT = 0;

				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + '@P_USUARIO=' + '''' 
											+ ISNULL(@P_USUARIO, 'N/D') + '''');
				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + ', @IDENTIFICADOR_EXTERNO=' 
											+ '''' + ISNULL(@P_IDENTIFICACODR_EXTERNO, 'N/D') 
											+ '''');

				--DETALLE CUERPO

                -- FIN DETALLE CUERPO

				SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAMETROS);

				/*SI NO VIENE NINGUN VALOR SE GENERA UNO*/
				SELECT @P_IDENTIFICACODR_EXTERNO = CASE
														WHEN LTRIM(RTRIM(@P_IDENTIFICACODR_EXTERNO)) = ''
															THEN 
																CONVERT(VARCHAR(50), NEWID())
														ELSE
															@P_IDENTIFICACODR_EXTERNO
													END;
			END; /*FIN-VARIOS*/

			--BEGIN /*INICIO-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
			DECLARE @SET_CAMPANA NVARCHAR(MAX);
            DECLARE @ParmDefinition NVARCHAR(MAX);

            DECLARE @V_VALOR BIGINT;
			--END; /*FIN-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
		END; /*FIN-DECLARACION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@P_USUARIO AS STR_USUARIO,
						@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
						@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			--------------------------------------------------------------------------------------------------------------------------------
            --BEGIN--INICIO-INICIAL REGISTRO DE BITACORAS DE EJECUCION

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_BIT_EJEC_ACTIVO_EJECUCION AS BIT_EJEC_ACTIVO_EJECUCION,
						@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUCION = 1)
			BEGIN
			/*BEGIN TRANSACTION*/

			--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
            --DETALLE DEL PROCEDIMIENTO 
				IF (@P_OPCION = 0)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75001;
					SELECT @V_ERR_MENSAJE_USUARIO = 'INSERCION O ACTUALIZACION DE UN DATO';

					IF EXISTS
					(
						SELECT TOP 1 *
						FROM PAWPLACE.TBL_PMK_INVENTARIO AS TGE WITH (NOLOCK)
						WHERE TGE.PK_TBL_PMK_INVENTARIO = @P_PK_TBL_PMK_INVENTARIO
					)
					BEGIN
						UPDATE PAWPLACE.TBL_PMK_INVENTARIO
						SET CODIGO = @P_CODIGO,
							NOMBRE = @P_NOMBRE,
							TIPO_ANIMAL = @P_TIPO_ANIMAL,
							PRECIO = @P_PRECIO,
							CANTIDAD = @P_CANTIDAD,
							ID_CATEGORIA = @P_ID_CATEGORIA,
							FECHA_MODIFICACION = GETDATE(),
							USUARIO_MODIFICACION = @P_USUARIO
						WHERE @P_PK_TBL_PMK_INVENTARIO = @P_PK_TBL_PMK_INVENTARIO;
					END;
					ELSE
					BEGIN
						INSERT INTO PAWPLACE.TBL_PMK_INVENTARIO
						(
							CODIGO,
							NOMBRE,
							TIPO_ANIMAL,
							PRECIO,
							CANTIDAD,
							ID_CATEGORIA,
							FECHA_CREACION,
							USUARIO_CREACION
						)
						VALUES
						(
							@P_CODIGO,
							@P_NOMBRE,
							@P_TIPO_ANIMAL,
							@P_PRECIO,
							@P_CANTIDAD,
							@P_ID_CATEGORIA,
							GETDATE(),
							@P_USUARIO
						);
					END;
				END;

				IF (@P_OPCION = 1)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75002;
					SELECT @V_ERR_MENSAJE_USUARIO = 'ELIMINACION DE UN DATO';
					
					DELETE PAWPLACE.TBL_PMK_INVENTARIO
					WHERE PK_TBL_PMK_INVENTARIO = @P_PK_TBL_PMK_INVENTARIO;
				END;
				-- FIN DETALLE CUERPO
			END;

			COMMIT TRANSACTION;

		END; /*FIN-CUERPO PROCEDIMIENTO*/
--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++   
	END TRY
	BEGIN CATCH
		-----------------------------                                    
        --ADMINISTRACION DE ERRORES                                  
        -----------------------------
		BEGIN /*INICIO-ADMINISTRACION DE ERRORES*/

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('ERROR-99999-01-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						XACT_STATE() AS [XACT_STATE],
						@@TRANCOUNT AS TRANSCOUNT;
			END;

			/*VALIDA SI LA TRANSACCION NO SE PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = -1
			BEGIN
				IF (@@TRANCOUNT > 0)
				BEGIN
					ROLLBACK TRANSACTION;
				END;
			END;

			/*VALIDA SI LA TRANSACCION PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = 1
			BEGIN
				IF(@@TRANCOUNT > 0)
				BEGIN
					COMMIT TRANSACTION;
				END;
			END;

			/*ERRORHANDLER*/

			SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
			SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
			SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
			SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
			SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

			/*DEFINICION DE MENSAJE DE ERROR*/

			SELECT @V_ERR_OBSERVACION = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ', MENSAJE:'
										+ ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
										+ ', PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');
			BEGIN TRY
				
				SELECT @V_FEC_ERR_CREACION = GETDATE();

				DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);
				EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
																@SIN_FK_UTL_PAR_PAIS = '',
																@STR_USUARIO_CREACION = @P_USUARIO,
																@FEC_CREACION = @V_FEC_ERR_CREACION,
																@STR_USUARIO_MODIFICACION = '',
																@FEC_MODIFICACION = '19000101',
																@INT_ID_SPID = @V_ERR_ID_SPID,
																@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
																@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
																@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
																@INT_ERROR_ESTADO = @V_ERR_ESTADO,
																@STR_SERVIDOR = @V_ERR_SERVIDOR,
																@STR_ESTACION = '',
																@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
																@STR_APLICATIVO = @V_ERR_APLICATIVO,
																@STR_CLASE = '',
																@STR_EVENTO = '',
																@STR_PROCESO = @V_ERR_PROCESO,
																@STR_PARAMETROS = @V_ERR_PARAMETROS,
																@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
																@INT_ID_TIPO = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
																@STR_DETALLE = @V_ERR_DETALLE,
																@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
																@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
																@STR_OBSERVACION = @V_ERR_OBSERVACION,
																@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
																@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
																@VBI_DATOS = @VBI_ERR_DATOS,
																@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO,
																@STR_SENTENCIA = @V_ERR_SENTENCIA,
																@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
																@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
																@INT_NIVEL_ANIDAMIENTO = @V_ERR_NUMERO_LINEA,
																@STR_IDENTIFICADOR_EXTERNO = 0,
																@STR_IDENTIFICADOR_UNICO = @V_IDENTIDICADOR_UNICO;
			END TRY
			BEGIN CATCH
					
				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('ERROR-99999-02-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
							GETDATE() AS FECHA;
				END;
				SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
                SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
                SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
                SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
                SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

				/*DEFINICION DE MENSAJE DE ERROR*/

				SELECT @V_ERR_NUMERO_USUARIO = 76001;
                --VERBOS A UTILIZAR DE ACUERDO A LA OPERACION=SELECT:SELECCIONAR, DELETE: ELIMINAR, UPDATE: ACTUALIZAR, INSERT: INSERTAR, EXEC: EJECUTAR
                SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR AL EJECUTAR EL PROCEDIMIENTO <PA_MAN_UTL_TRA_EXCEPCION_GUARDAR>';

                SELECT @V_ERR_OBSERVACION
                    = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + +',MENSAJE:'
                      + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
                      + ',PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');

                RAISERROR(@V_ERR_OBSERVACION, 16, 1);
            END CATCH;

			RAISERROR(@V_ERR_OBSERVACION, 16, 1);

			RETURN @V_ERR_NUMERO_USUARIO;
		END; /*FIN-ADMINISTRACION DE ERRORES*/
	END CATCH;
	--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++		
    --COMMIT TRAN 	
	RETURN 0;

END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>  
-- RELEASE:		<0000>
-- FECHA:		<2023/06/19>
-- DESCRIPCION: <OBTIENE LOS REGISTROS DE LA TABLA DE VENTA>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <MAURICE.LANG>       
--FECHA:   <YYYY/MM/DD>             
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_CON_TBL_PMK_VENTA
	@P_OPCION SMALLINT = 0, /*SIRVE PARA CONFIGURAR COMPORTAMIENTOS O FLUJOS EN EL PROCESO*/
	@P_USUARIO VARCHAR(50) = '', /*USUARIO QUIEN REALIZA LA ACCION*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECESITAR VALIDADR, EJECUCION_DEPURACION=7, EJECUCION_NORMAL=0*/
	@P_PK_TBL_PMK_VENTA BIGINT = 0, /*ID DE LA VENTA*/
	@P_ID_CLIENTE INT = 0, /*ID DEL CLIENTE*/
	@P_FECHA DATE = '', /*FECHA DE LA VENTA*/
	@P_TOTAL DECIMAL(10,2) = 0.0 /*TOTAL VENTA*/
AS
BEGIN
	SET NOCOUNT ON;

	BEGIN TRY
		BEGIN /*INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCIO_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_ID_ORIGEN_PROCEDIMENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO-SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIFICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FINSOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERROES*/
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();
				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '1';
				DECLARE @V_ERR_PARAAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR,2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
				DECLARE	@V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
				DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
				DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
				DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
				DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
				DECLARE @VBI_ERR_DATOS VARBINARY(MAX);
				DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) ='';
				DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
				DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
				DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
				DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUTION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/

			END; /*FIN-ADMINISTRACION ERRORES*/

			--BEGIN /*INICIO VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

			--END; /*FIN VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

		END; /*FIN-DECLARARCION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION, 
					GETDATE() AS FECHA,
					@P_USUARIO AS STR_USUARIO,
					@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
					@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_BIT_EJEC_ACTIVO_EJECUTION AS BIT_EJEC_ACTIVO_EJECUCION,
					@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUTION = 1)
			BEGIN 
				
				/*BEGIN TRANSACTION*/

				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('00030-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA;
				END;

				--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
                --DETALLE DEL PROCEDIMIENTO 

				IF (@P_OPCION = 0)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75001;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 0, SELECT COMPLETO';
					
					SELECT TIB.PK_TBL_PMK_VENTA,
						TIE.NOMBRE,
						TIE.APELLIDO1,
						TIE.APELLIDO2,
						TIE.CEDULA,
						TIE.CORREO,
						TIB.FECHA,
						TIB.TOTAL,
						TIB.FECHA_CREACION,
						TIB.USUARIO_CREACION,
						TIB.FECHA_MODIFICACION,
						TIB.USUARIO_MODIFICACION
					FROM PAWPLACE.TBL_PMK_VENTA AS TIB INNER JOIN
					PAWPLACE.TBL_PMK_CLIENTE AS TIE ON TIE.PK_TBL_PMK_CLIENTE = TIB.ID_CLIENTE
					WHERE (
						TIB.PK_TBL_PMK_VENTA = @P_PK_TBL_PMK_VENTA
						OR 
						@P_PK_TBL_PMK_VENTA = 0
					)
					AND
					(
						TIB.FECHA = @P_FECHA
						OR
						@P_FECHA = ''
					)
					AND
					(
						TIB.ID_CLIENTE = @P_ID_CLIENTE
						OR
						@P_ID_CLIENTE = 0
					);
				END;
				IF (@P_OPCION = 1)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75003;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 1, SELECT DE ULTIMO DATO DE LA TABLA';

					SELECT TOP 1 TIB.PK_TBL_PMK_VENTA,
						TIE.NOMBRE,
						TIE.APELLIDO1,
						TIE.APELLIDO2,
						TIE.CEDULA,
						TIE.CORREO,
						TIB.FECHA,
						TIB.TOTAL,
						TIB.FECHA_CREACION,
						TIB.USUARIO_CREACION,
						TIB.FECHA_MODIFICACION,
						TIB.USUARIO_MODIFICACION
					FROM PAWPLACE.TBL_PMK_VENTA AS TIB INNER JOIN
					PAWPLACE.TBL_PMK_CLIENTE AS TIE ON TIE.PK_TBL_PMK_CLIENTE = TIB.ID_CLIENTE
					ORDER BY TIB.PK_TBL_PMK_VENTA DESC;
				END;
				/*COMMIT TRANSACTION*/

			END;
		END; /*FIN-CUERPO PROCEDIMIENTO*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	END TRY
	BEGIN CATCH
		/*ROLLBACK TRANSACTION*/

		SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(),0);
		SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(),0);
		SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(),0);
		SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(),'');
		SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(),0);

		SELECT @V_ERR_PARAAMETROS =
			('@P_OPCION= ' + CAST(@P_OPCION AS VARCHAR(50)) + ' ,' + '@P_USUARIO= ' + '''' + @P_USUARIO + ''''
			+ ' ,' + '@P_MODO_EJECUCION= '+CAST(@P_MODO_EJECUCION AS VARCHAR(50)) + ' ,' + '@P_FECHA= ' + CAST(@P_FECHA AS VARCHAR(50)) + ' ,' + '@P_CLIENTE= ' + CAST(@P_ID_CLIENTE AS VARCHAR(50)) + ' ,' + '@P_TOTAL= ' + CAST(@P_TOTAL AS VARCHAR(50)) + ' ,' + '@P_PK_TBL_PMK_VENTA= ' + CAST(@P_PK_TBL_PMK_VENTA AS VARCHAR(50))
			);

		/*AGREGAR PARAMETROS NUEVOS AQUI*/

		SELECT @V_ERR_OBSERVACION =
			'(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ' ,'
			+ 'MENSAJE: ' + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' 
			+ ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D') + ' ,' + 'PROCESO: '
			+ ISNULL(@V_ERR_PROCESO, 'N/D');

		SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAAMETROS);

		DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);

		EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
														@SIN_FK_UTL_PAR_PAIS = '',
														@STR_USUARIO_CREACION = @P_USUARIO,
														@FEC_CREACION = @V_FEC_ERR_CREACION,
														@STR_USUARIO_MODIFICACION = '',
														@FEC_MODIFICACION = '',
														@INT_ID_SPID = @V_ERR_ID_SPID,
														@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
														@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
														@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
														@INT_ERROR_ESTADO = @V_ERR_ESTADO,
														@STR_SERVIDOR = @V_ERR_SERVIDOR,
														@STR_ESTACION = '',
														@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
														@STR_APLICATIVO = @V_ERR_APLICATIVO,
														@STR_CLASE = '',
														@STR_EVENTO = '',
														@STR_PROCESO = @V_ERR_PROCESO,
														@STR_PARAMETROS = @V_ERR_PARAAMETROS,
														@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
														@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
														@INT_ID_TIPO = @V_ERR_ID_TIPO,
														@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
														@STR_DETALLE = @V_ERR_DETALLE,
														@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
														@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
														@STR_OBSERVACION = @V_ERR_OBSERVACION,
														@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
														@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
														@VBI_DATOS = @VBI_ERR_DATOS,
														@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO_DATOS,
														@STR_SENTENCIA = @V_ERR_SENTENCIA,
														@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
														@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
														@INT_NIVEL_ANIDAMIENTO = @V_ERR_NIVEL_ANIDAMIENTO,
														@INT_NUMERO_LINEA = @V_ERR_NUMERO_LINEA,
														@STR_IDENTIFICADOR_EXTERNO = 0,
														@STR_IDENTIFICADOR_UNICO = @V_IDENTIFICADOR_UNICO;

		RAISERROR(@V_ERR_OBSERVACION, 16, 1);
	END CATCH;
END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>
-- RELEASE:		<0000>
-- FECHA:		<2023/06/19>
-- DESCRIPCION: <PROCEDIMIENTO ALMACENADO DE PROCESO DE MANTENIMIETO DEL INVENTARIO>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <NOMBRE.APELLIDO>       
--FECHA:   <YYYY/MM/DD>       
--TICKET:   <00000>       
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_MAN_TBL_PMK_VENTA
(
	@P_USUARIO VARCHAR(50) = '', /*USUARIO DE LA APLICACION QUE EJECUTA*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECEISTAR VALIDAR, EJECUCION_DUPRACION=7, EJECUCION_NORMLA=0*/
	@P_OPCION SMALLINT = 0, /*OPCION SIRVE PARA CONFIGURAR COMPORTAMIENTO O FLUJOS EN EL PROCESO*/
	@P_IDENTIFICACODR_EXTERNO VARCHAR(50) = '', /*IDENTIDICADOR ENVIADO DESDE EL APLICATIVO, ESTE SE ALMACENA EN LAS BITACORAS DE EJECUCION O EN LAS BITACORAS DE EXCEPCIONES*/
	@P_PK_TBL_PMK_VENTA BIGINT = 0,
	@P_ID_CLIENTE INT = 0,
	@P_FECHA DATE = '',
	@P_TOTAL DECIMAL(10,2) = 0.0
)
AS
BEGIN

	SET XACT_ABORT, NOCOUNT ON; --ADDED TO PREVENT EXTRA RESULT SETS FROM INTERFERING WITH SELECT STATEMENTS.
    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; --SERIALIZABLE; -- ADD NOLOCK ALL TABLES 

	BEGIN TRY
		BEGIN TRANSACTION;
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
        -----------------------------                                    
        --DECLARACION Y ASIGNACION DE VARIABLES                                  
        -----------------------------
		BEGIN /**INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCION_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_OPCION_NORMAL SMALLINT = 0;
				DECLARE @V_ID_ORIGEN_WINDOWS_FORM INT = 1;
				DECLARE @V_DESCRIPCION_ORIGEN_WINDOWS_FORM VARCHAR(300) = 'WINDOWS FORM';
				DECLARE @V_ID_ORIGEN_WEB_SERVICE INT = 2;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SERVICE VARCHAR(300) = 'WEB SERVICE';
				DECLARE @V_ID_ORIGEN_WEB_SITE INT = 3;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SITE VARCHAR(300) = 'WEB SITE';
				DECLARE @V_ID_ORIGEN_PROCEDIMIENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_ORIGEN_REPORTING_SERVICE INT = 5;
				DECLARE @V_DESCRIPCION_ORIGEN_REPORTING_SERVICE VARCHAR(300) = 'REPORTING SERVICE';
				DECLARE @V_ID_ORIGEN_ETL INT = 6;
				DECLARE @V_DESCRIPCION_ORIGEN_ETL VARCHAR(300) = 'ETL';
				DECLARE @V_ID_ORIGEN_JOB INT = 7;
				DECLARE @V_DESCRIPCION_ORIGEN_JOB VARCHAR(300) = 'JOB';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
				DECLARE @V_ID_TIPO_EXCEPCION INT = 2;
				DECLARE @V_DESCRIPCION_TIPO_EXCEPCIPN VARCHAR(300) = 'EXCEPCION-PERSONALIZADA';
				DECLARE @V_ID_TIPO_DATOS_XML SMALLINT = 1; /*ID TIPO DATO XML*/
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIDICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FIN-SOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERRORES*/
				DECLARE @V_ERR_FK_UTL_PAR_PAIS SMALLINT = 0;
				DECLARE @V_ERR_USUARIO_CREACION VARCHAR(50) = ISNULL(@P_USUARIO, 'N/D');
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();

				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NOMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_PARAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO; /*1=WINDOWS FORM, 2=WEB SERVICE, 3=WEB SITE, 4=PROCEDIMIENTO, 5=REPORTING SERVICE, 6=ETL*/
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR, 2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
                DECLARE @V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
                DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
                DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
                DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_XML_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
                DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
                DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
                
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '';

				SELECT TOP 1
						@V_ERR_APLICATIVO = (
                                       'HOST:'+
                                       ISNULL(vs.host_name, 'N/D')+
                                       ' | PROGRAM:'+
                                       ISNULL(vs.program_name, 'N,/D')+
                                       ' | LOGIN:'+
                                       ISNULL(vs.login_name, 'N,/D')
									   )
				FROM sys.dm_exec_requests vr
						INNER JOIN sys.dm_exec_sessions vs
							ON vr.session_id = vs.session_id
				WHERE vr.session_id = @V_ERR_ID_SPID;

				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
                DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
                DECLARE @VBI_ERR_DATOS VARBINARY(MAX) = NULL;
                DECLARE @V_EJEC_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
                DECLARE @V_EJEC_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUCION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/
				DECLARE @V_OBSERVACIONES VARCHAR(MAX) = '';

			END; /*FIN-ADMINISTRACION ERRORES*/

			BEGIN /*INICIO-VARIOS*/
				DECLARE @V_CANTIDAD_REGISTROS INT = 0;
				DECLARE @V_BIT_REGISTRA_XML_PROCESOS_SISTEMA BIT = 0;

				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + '@P_USUARIO=' + '''' 
											+ ISNULL(@P_USUARIO, 'N/D') + '''');
				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + ', @IDENTIFICADOR_EXTERNO=' 
											+ '''' + ISNULL(@P_IDENTIFICACODR_EXTERNO, 'N/D') 
											+ '''');

				--DETALLE CUERPO

                -- FIN DETALLE CUERPO

				SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAMETROS);

				/*SI NO VIENE NINGUN VALOR SE GENERA UNO*/
				SELECT @P_IDENTIFICACODR_EXTERNO = CASE
														WHEN LTRIM(RTRIM(@P_IDENTIFICACODR_EXTERNO)) = ''
															THEN 
																CONVERT(VARCHAR(50), NEWID())
														ELSE
															@P_IDENTIFICACODR_EXTERNO
													END;
			END; /*FIN-VARIOS*/

			--BEGIN /*INICIO-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
			DECLARE @SET_CAMPANA NVARCHAR(MAX);
            DECLARE @ParmDefinition NVARCHAR(MAX);

            DECLARE @V_VALOR BIGINT;
			--END; /*FIN-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
		END; /*FIN-DECLARACION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@P_USUARIO AS STR_USUARIO,
						@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
						@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			--------------------------------------------------------------------------------------------------------------------------------
            --BEGIN--INICIO-INICIAL REGISTRO DE BITACORAS DE EJECUCION

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_BIT_EJEC_ACTIVO_EJECUCION AS BIT_EJEC_ACTIVO_EJECUCION,
						@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUCION = 1)
			BEGIN
			/*BEGIN TRANSACTION*/

			--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
            --DETALLE DEL PROCEDIMIENTO 
				IF (@P_OPCION = 0)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75001;
					SELECT @V_ERR_MENSAJE_USUARIO = 'INSERCION O ACTUALIZACION DE UN DATO';

					IF EXISTS
					(
						SELECT TOP 1 *
						FROM PAWPLACE.TBL_PMK_VENTA AS TGE WITH (NOLOCK)
						WHERE TGE.PK_TBL_PMK_VENTA = @P_PK_TBL_PMK_VENTA
					)
					BEGIN
						UPDATE PAWPLACE.TBL_PMK_VENTA
						SET ID_CLIENTE = @P_ID_CLIENTE,
							FECHA = @P_FECHA,
							TOTAL = @P_TOTAL,
							FECHA_MODIFICACION = GETDATE(),
							USUARIO_MODIFICACION = @P_USUARIO
						WHERE @P_PK_TBL_PMK_VENTA = @P_PK_TBL_PMK_VENTA;
					END;
					ELSE
					BEGIN
						INSERT INTO PAWPLACE.TBL_PMK_VENTA
						(
							ID_CLIENTE,
							FECHA,
							TOTAL,
							FECHA_CREACION,
							USUARIO_CREACION
						)
						VALUES
						(
							@P_ID_CLIENTE,
							@P_FECHA,
							@P_TOTAL,
							GETDATE(),
							@P_USUARIO
						);
					END;
				END;

				IF (@P_OPCION = 1)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75002;
					SELECT @V_ERR_MENSAJE_USUARIO = 'ELIMINACION DE UN DATO';
					
					DELETE PAWPLACE.TBL_PMK_VENTA
					WHERE PK_TBL_PMK_VENTA = @P_PK_TBL_PMK_VENTA;
				END;
				-- FIN DETALLE CUERPO
			END;

			COMMIT TRANSACTION;

		END; /*FIN-CUERPO PROCEDIMIENTO*/
--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++   
	END TRY
	BEGIN CATCH
		-----------------------------                                    
        --ADMINISTRACION DE ERRORES                                  
        -----------------------------
		BEGIN /*INICIO-ADMINISTRACION DE ERRORES*/

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('ERROR-99999-01-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						XACT_STATE() AS [XACT_STATE],
						@@TRANCOUNT AS TRANSCOUNT;
			END;

			/*VALIDA SI LA TRANSACCION NO SE PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = -1
			BEGIN
				IF (@@TRANCOUNT > 0)
				BEGIN
					ROLLBACK TRANSACTION;
				END;
			END;

			/*VALIDA SI LA TRANSACCION PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = 1
			BEGIN
				IF(@@TRANCOUNT > 0)
				BEGIN
					COMMIT TRANSACTION;
				END;
			END;

			/*ERRORHANDLER*/

			SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
			SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
			SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
			SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
			SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

			/*DEFINICION DE MENSAJE DE ERROR*/

			SELECT @V_ERR_OBSERVACION = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ', MENSAJE:'
										+ ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
										+ ', PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');
			BEGIN TRY
				
				SELECT @V_FEC_ERR_CREACION = GETDATE();

				DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);
				EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
																@SIN_FK_UTL_PAR_PAIS = '',
																@STR_USUARIO_CREACION = @P_USUARIO,
																@FEC_CREACION = @V_FEC_ERR_CREACION,
																@STR_USUARIO_MODIFICACION = '',
																@FEC_MODIFICACION = '19000101',
																@INT_ID_SPID = @V_ERR_ID_SPID,
																@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
																@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
																@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
																@INT_ERROR_ESTADO = @V_ERR_ESTADO,
																@STR_SERVIDOR = @V_ERR_SERVIDOR,
																@STR_ESTACION = '',
																@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
																@STR_APLICATIVO = @V_ERR_APLICATIVO,
																@STR_CLASE = '',
																@STR_EVENTO = '',
																@STR_PROCESO = @V_ERR_PROCESO,
																@STR_PARAMETROS = @V_ERR_PARAMETROS,
																@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
																@INT_ID_TIPO = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
																@STR_DETALLE = @V_ERR_DETALLE,
																@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
																@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
																@STR_OBSERVACION = @V_ERR_OBSERVACION,
																@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
																@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
																@VBI_DATOS = @VBI_ERR_DATOS,
																@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO,
																@STR_SENTENCIA = @V_ERR_SENTENCIA,
																@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
																@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
																@INT_NIVEL_ANIDAMIENTO = @V_ERR_NUMERO_LINEA,
																@STR_IDENTIFICADOR_EXTERNO = 0,
																@STR_IDENTIFICADOR_UNICO = @V_IDENTIDICADOR_UNICO;
			END TRY
			BEGIN CATCH
					
				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('ERROR-99999-02-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
							GETDATE() AS FECHA;
				END;
				SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
                SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
                SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
                SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
                SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

				/*DEFINICION DE MENSAJE DE ERROR*/

				SELECT @V_ERR_NUMERO_USUARIO = 76001;
                --VERBOS A UTILIZAR DE ACUERDO A LA OPERACION=SELECT:SELECCIONAR, DELETE: ELIMINAR, UPDATE: ACTUALIZAR, INSERT: INSERTAR, EXEC: EJECUTAR
                SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR AL EJECUTAR EL PROCEDIMIENTO <PA_MAN_UTL_TRA_EXCEPCION_GUARDAR>';

                SELECT @V_ERR_OBSERVACION
                    = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + +',MENSAJE:'
                      + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
                      + ',PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');

                RAISERROR(@V_ERR_OBSERVACION, 16, 1);
            END CATCH;

			RAISERROR(@V_ERR_OBSERVACION, 16, 1);

			RETURN @V_ERR_NUMERO_USUARIO;
		END; /*FIN-ADMINISTRACION DE ERRORES*/
	END CATCH;
	--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++		
    --COMMIT TRAN 	
	RETURN 0;

END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>  
-- RELEASE:		<0000>
-- FECHA:		<2023/06/19>
-- DESCRIPCION: <OBTIENE LOS REGISTROS DE LA TABLA DE CARRITO>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <MAURICE.LANG>       
--FECHA:   <YYYY/MM/DD>             
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_CON_TBL_PMK_CARRITO
	@P_OPCION SMALLINT = 0, /*SIRVE PARA CONFIGURAR COMPORTAMIENTOS O FLUJOS EN EL PROCESO*/
	@P_USUARIO VARCHAR(50) = '', /*USUARIO QUIEN REALIZA LA ACCION*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECESITAR VALIDADR, EJECUCION_DEPURACION=7, EJECUCION_NORMAL=0*/
	@P_PK_TBL_PMK_CARRITO BIGINT = 0, /*ID DEL CARRITO*/
	@P_ID_VENTA INT = 0, /*ID DE VENTA*/
	@P_ID_PRODUCTO INT = 0, /*ID DEL PRODUCTO*/
	@P_CANTIDAD INT = 0, /*CANTIDAD DE PRODUCTOS*/
	@P_SUBTOTAL DECIMAL(10,2) = 0.0 /*SUBTOTAL*/
AS
BEGIN
	SET NOCOUNT ON;

	BEGIN TRY
		BEGIN /*INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCIO_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_ID_ORIGEN_PROCEDIMENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO-SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIFICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FINSOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERROES*/
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();
				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '1';
				DECLARE @V_ERR_PARAAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR,2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
				DECLARE	@V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
				DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
				DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
				DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
				DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
				DECLARE @VBI_ERR_DATOS VARBINARY(MAX);
				DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) ='';
				DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
				DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
				DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
				DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUTION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/

			END; /*FIN-ADMINISTRACION ERRORES*/

			--BEGIN /*INICIO VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

			--END; /*FIN VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

		END; /*FIN-DECLARARCION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION, 
					GETDATE() AS FECHA,
					@P_USUARIO AS STR_USUARIO,
					@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
					@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_BIT_EJEC_ACTIVO_EJECUTION AS BIT_EJEC_ACTIVO_EJECUCION,
					@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUTION = 1)
			BEGIN 
				
				/*BEGIN TRANSACTION*/

				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('00030-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA;
				END;

				--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
                --DETALLE DEL PROCEDIMIENTO 

				IF (@P_OPCION = 0)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75001;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 0, SELECT COMPLETO';
					
					SELECT TIB.PK_TBL_PMK_CARRITO,
						TIB.ID_VENTA,
						TIU.CODIGO,
						TIU.NOMBRE,
						TIU.PRECIO,
						TIB.CANTIDAD,
						TIB.SUBTOTAL,
						TIB.FECHA_CREACION,
						TIB.USUARIO_CREACION,
						TIB.FECHA_MODIFICACION,
						TIB.USUARIO_MODIFICACION
					FROM PAWPLACE.TBL_PMK_CARRITO AS TIB INNER JOIN
					PAWPLACE.TBL_PMK_INVENTARIO AS TIU ON TIU.PK_TBL_PMK_INVENTARIO = TIB.ID_PRODUCTO
					WHERE (
						TIB.PK_TBL_PMK_CARRITO = @P_PK_TBL_PMK_CARRITO
						OR 
						@P_PK_TBL_PMK_CARRITO = 0
					)
					AND
					(
						TIB.ID_VENTA = @P_ID_VENTA
						OR
						@P_ID_VENTA = 0
					)
					AND
					(
						TIB.ID_PRODUCTO = @P_ID_PRODUCTO
						OR
						@P_ID_PRODUCTO = 0
					);
				END;
				IF (@P_OPCION = 1)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75001;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 0, SELECT PARA FACTURA';
					
					SELECT TIB.PK_TBL_PMK_CARRITO,
						TIB.ID_VENTA,
						TIE.FECHA,
						TIC.CEDULA,
						TIC.NOMBRE,
						TIC.APELLIDO1,
						TIC.CORREO,
						TIU.CODIGO,
						TIU.NOMBRE AS PRODUCTO,
						TIU.PRECIO,
						TIB.CANTIDAD,
						TIB.SUBTOTAL,
						TIE.TOTAL,
						PAR.CEDULA_JURIDICA,
						PAR.EMPRESA,
						PAR.CORREO,
						PAR.TELEFONO,
						PAR.WEB,
						PAR.DESCRIPCION,
						PAR.DIRECCION,
						PAR.TIPO_TIENDA,
						PAR.LOGO
					FROM PAWPLACE.TBL_PMK_CARRITO AS TIB INNER JOIN
					PAWPLACE.TBL_PMK_INVENTARIO AS TIU ON TIU.PK_TBL_PMK_INVENTARIO = TIB.ID_PRODUCTO
					INNER JOIN PAWPLACE.TBL_PMK_VENTA AS TIE ON TIE.PK_TBL_PMK_VENTA = TIB.ID_VENTA
					INNER JOIN PAWPLACE.TBL_PMK_CLIENTE AS TIC ON TIC.PK_TBL_PMK_CLIENTE = TIE.ID_CLIENTE
					INNER JOIN PAWPLACE.TBL_PMK_PARAMETRO AS PAR ON PAR.PK_TBL_PMK_PARAMETRO = 1
					WHERE (
						TIB.PK_TBL_PMK_CARRITO = @P_PK_TBL_PMK_CARRITO
						OR 
						@P_PK_TBL_PMK_CARRITO = 0
					)
					AND
					(
						TIB.ID_VENTA = @P_ID_VENTA
						OR
						@P_ID_VENTA = 0
					)
					AND
					(
						TIB.ID_PRODUCTO = @P_ID_PRODUCTO
						OR
						@P_ID_PRODUCTO = 0
					);
				END;
				IF (@P_OPCION = 2)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75001;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 2, SELECT PRODUCTOS';
					
					SELECT TIB.PK_TBL_PMK_CARRITO,
						TIB.ID_VENTA,
						TIU.CODIGO,
						TIU.NOMBRE,
						TIU.PRECIO,
						TIB.CANTIDAD,
						TIB.SUBTOTAL
					FROM PAWPLACE.TBL_PMK_CARRITO AS TIB INNER JOIN
					PAWPLACE.TBL_PMK_INVENTARIO AS TIU ON TIU.PK_TBL_PMK_INVENTARIO = TIB.ID_PRODUCTO
					WHERE (
						TIB.PK_TBL_PMK_CARRITO = @P_PK_TBL_PMK_CARRITO
						OR 
						@P_PK_TBL_PMK_CARRITO = 0
					)
					AND
					(
						TIB.ID_VENTA = @P_ID_VENTA
						OR
						@P_ID_VENTA = 0
					)
					AND
					(
						TIB.ID_PRODUCTO = @P_ID_PRODUCTO
						OR
						@P_ID_PRODUCTO = 0
					);
				END;
				/*COMMIT TRANSACTION*/

			END;
		END; /*FIN-CUERPO PROCEDIMIENTO*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	END TRY
	BEGIN CATCH
		/*ROLLBACK TRANSACTION*/

		SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(),0);
		SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(),0);
		SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(),0);
		SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(),'');
		SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(),0);

		SELECT @V_ERR_PARAAMETROS =
			('@P_OPCION= ' + CAST(@P_OPCION AS VARCHAR(50)) + ' ,' + '@P_USUARIO= ' + '''' + @P_USUARIO + ''''
			+ ' ,' + '@P_MODO_EJECUCION= '+CAST(@P_MODO_EJECUCION AS VARCHAR(50)) + ' ,' + '@P_ID_VENTA= ' + CAST(@P_ID_VENTA AS VARCHAR(50)) + ' ,' + '@P_ID_PRODUCTO= ' + CAST(@P_ID_PRODUCTO AS VARCHAR(50)) + ' ,' + '@P_CANTIDAD= ' + CAST(@P_CANTIDAD AS VARCHAR(50)) + ' ,' + '@P_SUBTOTAL= ' + CAST(@P_SUBTOTAL AS VARCHAR(50)) + ' ,' + '@P_PK_TBL_PMK_CARRITO= ' + CAST(@P_PK_TBL_PMK_CARRITO AS VARCHAR(50))
			);

		/*AGREGAR PARAMETROS NUEVOS AQUI*/

		SELECT @V_ERR_OBSERVACION =
			'(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ' ,'
			+ 'MENSAJE: ' + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' 
			+ ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D') + ' ,' + 'PROCESO: '
			+ ISNULL(@V_ERR_PROCESO, 'N/D');

		SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAAMETROS);

		DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);

		EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
														@SIN_FK_UTL_PAR_PAIS = '',
														@STR_USUARIO_CREACION = @P_USUARIO,
														@FEC_CREACION = @V_FEC_ERR_CREACION,
														@STR_USUARIO_MODIFICACION = '',
														@FEC_MODIFICACION = '',
														@INT_ID_SPID = @V_ERR_ID_SPID,
														@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
														@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
														@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
														@INT_ERROR_ESTADO = @V_ERR_ESTADO,
														@STR_SERVIDOR = @V_ERR_SERVIDOR,
														@STR_ESTACION = '',
														@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
														@STR_APLICATIVO = @V_ERR_APLICATIVO,
														@STR_CLASE = '',
														@STR_EVENTO = '',
														@STR_PROCESO = @V_ERR_PROCESO,
														@STR_PARAMETROS = @V_ERR_PARAAMETROS,
														@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
														@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
														@INT_ID_TIPO = @V_ERR_ID_TIPO,
														@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
														@STR_DETALLE = @V_ERR_DETALLE,
														@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
														@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
														@STR_OBSERVACION = @V_ERR_OBSERVACION,
														@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
														@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
														@VBI_DATOS = @VBI_ERR_DATOS,
														@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO_DATOS,
														@STR_SENTENCIA = @V_ERR_SENTENCIA,
														@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
														@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
														@INT_NIVEL_ANIDAMIENTO = @V_ERR_NIVEL_ANIDAMIENTO,
														@INT_NUMERO_LINEA = @V_ERR_NUMERO_LINEA,
														@STR_IDENTIFICADOR_EXTERNO = 0,
														@STR_IDENTIFICADOR_UNICO = @V_IDENTIFICADOR_UNICO;

		RAISERROR(@V_ERR_OBSERVACION, 16, 1);
	END CATCH;
END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>
-- RELEASE:		<0000>
-- FECHA:		<2023/06/19>
-- DESCRIPCION: <PROCEDIMIENTO ALMACENADO DE PROCESO DE MANTENIMIETO DEL CARRITO>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <NOMBRE.APELLIDO>       
--FECHA:   <YYYY/MM/DD>       
--TICKET:   <00000>       
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_MAN_TBL_PMK_CARRITO
(
	@P_USUARIO VARCHAR(50) = '', /*USUARIO DE LA APLICACION QUE EJECUTA*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECEISTAR VALIDAR, EJECUCION_DUPRACION=7, EJECUCION_NORMLA=0*/
	@P_OPCION SMALLINT = 0, /*OPCION SIRVE PARA CONFIGURAR COMPORTAMIENTO O FLUJOS EN EL PROCESO*/
	@P_IDENTIFICACODR_EXTERNO VARCHAR(50) = '', /*IDENTIDICADOR ENVIADO DESDE EL APLICATIVO, ESTE SE ALMACENA EN LAS BITACORAS DE EJECUCION O EN LAS BITACORAS DE EXCEPCIONES*/
	@P_PK_TBL_PMK_CARRITO BIGINT = 0,
	@P_ID_VENTA INT = 0,
	@P_ID_PRODUCTO INT = 0,
	@P_CANTIDAD INT = 0,
	@P_SUBTOTAL DECIMAL(10,2) = 0.0
)
AS
BEGIN

	SET XACT_ABORT, NOCOUNT ON; --ADDED TO PREVENT EXTRA RESULT SETS FROM INTERFERING WITH SELECT STATEMENTS.
    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; --SERIALIZABLE; -- ADD NOLOCK ALL TABLES 

	BEGIN TRY
		BEGIN TRANSACTION;
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
        -----------------------------                                    
        --DECLARACION Y ASIGNACION DE VARIABLES                                  
        -----------------------------
		BEGIN /**INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCION_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_OPCION_NORMAL SMALLINT = 0;
				DECLARE @V_ID_ORIGEN_WINDOWS_FORM INT = 1;
				DECLARE @V_DESCRIPCION_ORIGEN_WINDOWS_FORM VARCHAR(300) = 'WINDOWS FORM';
				DECLARE @V_ID_ORIGEN_WEB_SERVICE INT = 2;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SERVICE VARCHAR(300) = 'WEB SERVICE';
				DECLARE @V_ID_ORIGEN_WEB_SITE INT = 3;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SITE VARCHAR(300) = 'WEB SITE';
				DECLARE @V_ID_ORIGEN_PROCEDIMIENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_ORIGEN_REPORTING_SERVICE INT = 5;
				DECLARE @V_DESCRIPCION_ORIGEN_REPORTING_SERVICE VARCHAR(300) = 'REPORTING SERVICE';
				DECLARE @V_ID_ORIGEN_ETL INT = 6;
				DECLARE @V_DESCRIPCION_ORIGEN_ETL VARCHAR(300) = 'ETL';
				DECLARE @V_ID_ORIGEN_JOB INT = 7;
				DECLARE @V_DESCRIPCION_ORIGEN_JOB VARCHAR(300) = 'JOB';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
				DECLARE @V_ID_TIPO_EXCEPCION INT = 2;
				DECLARE @V_DESCRIPCION_TIPO_EXCEPCIPN VARCHAR(300) = 'EXCEPCION-PERSONALIZADA';
				DECLARE @V_ID_TIPO_DATOS_XML SMALLINT = 1; /*ID TIPO DATO XML*/
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIDICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FIN-SOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERRORES*/
				DECLARE @V_ERR_FK_UTL_PAR_PAIS SMALLINT = 0;
				DECLARE @V_ERR_USUARIO_CREACION VARCHAR(50) = ISNULL(@P_USUARIO, 'N/D');
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();

				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NOMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_PARAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO; /*1=WINDOWS FORM, 2=WEB SERVICE, 3=WEB SITE, 4=PROCEDIMIENTO, 5=REPORTING SERVICE, 6=ETL*/
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR, 2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
                DECLARE @V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
                DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
                DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
                DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_XML_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
                DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
                DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
                
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '';

				SELECT TOP 1
						@V_ERR_APLICATIVO = (
                                       'HOST:'+
                                       ISNULL(vs.host_name, 'N/D')+
                                       ' | PROGRAM:'+
                                       ISNULL(vs.program_name, 'N,/D')+
                                       ' | LOGIN:'+
                                       ISNULL(vs.login_name, 'N,/D')
									   )
				FROM sys.dm_exec_requests vr
						INNER JOIN sys.dm_exec_sessions vs
							ON vr.session_id = vs.session_id
				WHERE vr.session_id = @V_ERR_ID_SPID;

				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
                DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
                DECLARE @VBI_ERR_DATOS VARBINARY(MAX) = NULL;
                DECLARE @V_EJEC_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
                DECLARE @V_EJEC_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUCION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/
				DECLARE @V_OBSERVACIONES VARCHAR(MAX) = '';

			END; /*FIN-ADMINISTRACION ERRORES*/

			BEGIN /*INICIO-VARIOS*/
				DECLARE @V_CANTIDAD_REGISTROS INT = 0;
				DECLARE @V_BIT_REGISTRA_XML_PROCESOS_SISTEMA BIT = 0;

				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + '@P_USUARIO=' + '''' 
											+ ISNULL(@P_USUARIO, 'N/D') + '''');
				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + ', @IDENTIFICADOR_EXTERNO=' 
											+ '''' + ISNULL(@P_IDENTIFICACODR_EXTERNO, 'N/D') 
											+ '''');

				--DETALLE CUERPO

                -- FIN DETALLE CUERPO

				SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAMETROS);

				/*SI NO VIENE NINGUN VALOR SE GENERA UNO*/
				SELECT @P_IDENTIFICACODR_EXTERNO = CASE
														WHEN LTRIM(RTRIM(@P_IDENTIFICACODR_EXTERNO)) = ''
															THEN 
																CONVERT(VARCHAR(50), NEWID())
														ELSE
															@P_IDENTIFICACODR_EXTERNO
													END;
			END; /*FIN-VARIOS*/

			--BEGIN /*INICIO-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
			DECLARE @SET_CAMPANA NVARCHAR(MAX);
            DECLARE @ParmDefinition NVARCHAR(MAX);

            DECLARE @V_VALOR BIGINT;
			--END; /*FIN-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
		END; /*FIN-DECLARACION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@P_USUARIO AS STR_USUARIO,
						@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
						@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			--------------------------------------------------------------------------------------------------------------------------------
            --BEGIN--INICIO-INICIAL REGISTRO DE BITACORAS DE EJECUCION

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_BIT_EJEC_ACTIVO_EJECUCION AS BIT_EJEC_ACTIVO_EJECUCION,
						@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUCION = 1)
			BEGIN
			/*BEGIN TRANSACTION*/

			--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
            --DETALLE DEL PROCEDIMIENTO 
				IF (@P_OPCION = 0)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75001;
					SELECT @V_ERR_MENSAJE_USUARIO = 'INSERCION O ACTUALIZACION DE UN DATO';

					IF EXISTS
					(
						SELECT TOP 1 *
						FROM PAWPLACE.TBL_PMK_CARRITO AS TGE WITH (NOLOCK)
						WHERE TGE.PK_TBL_PMK_CARRITO = @P_PK_TBL_PMK_CARRITO
					)
					BEGIN
						UPDATE PAWPLACE.TBL_PMK_CARRITO
						SET ID_VENTA = @P_ID_VENTA,
							ID_PRODUCTO = @P_ID_PRODUCTO,
							CANTIDAD = @P_CANTIDAD,
							SUBTOTAL = @P_SUBTOTAL,
							FECHA_MODIFICACION = GETDATE(),
							USUARIO_MODIFICACION = @P_USUARIO
						WHERE @P_PK_TBL_PMK_CARRITO = @P_PK_TBL_PMK_CARRITO;
					END;
					ELSE
					BEGIN
						INSERT INTO PAWPLACE.TBL_PMK_CARRITO
						(
							ID_VENTA,
							ID_PRODUCTO,
							CANTIDAD,
							SUBTOTAL,
							FECHA_CREACION,
							USUARIO_CREACION
						)
						VALUES
						(
							@P_ID_VENTA,
							@P_ID_PRODUCTO,
							@P_CANTIDAD,
							@P_SUBTOTAL,
							GETDATE(),
							@P_USUARIO
						);
					END;
				END;

				IF (@P_OPCION = 1)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75002;
					SELECT @V_ERR_MENSAJE_USUARIO = 'ELIMINACION DE UN DATO';
					
					DELETE PAWPLACE.TBL_PMK_CARRITO
					WHERE PK_TBL_PMK_CARRITO = @P_PK_TBL_PMK_CARRITO;
				END;
				-- FIN DETALLE CUERPO
			END;

			COMMIT TRANSACTION;

		END; /*FIN-CUERPO PROCEDIMIENTO*/
--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++   
	END TRY
	BEGIN CATCH
		-----------------------------                                    
        --ADMINISTRACION DE ERRORES                                  
        -----------------------------
		BEGIN /*INICIO-ADMINISTRACION DE ERRORES*/

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('ERROR-99999-01-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						XACT_STATE() AS [XACT_STATE],
						@@TRANCOUNT AS TRANSCOUNT;
			END;

			/*VALIDA SI LA TRANSACCION NO SE PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = -1
			BEGIN
				IF (@@TRANCOUNT > 0)
				BEGIN
					ROLLBACK TRANSACTION;
				END;
			END;

			/*VALIDA SI LA TRANSACCION PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = 1
			BEGIN
				IF(@@TRANCOUNT > 0)
				BEGIN
					COMMIT TRANSACTION;
				END;
			END;

			/*ERRORHANDLER*/

			SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
			SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
			SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
			SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
			SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

			/*DEFINICION DE MENSAJE DE ERROR*/

			SELECT @V_ERR_OBSERVACION = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ', MENSAJE:'
										+ ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
										+ ', PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');
			BEGIN TRY
				
				SELECT @V_FEC_ERR_CREACION = GETDATE();

				DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);
				EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
																@SIN_FK_UTL_PAR_PAIS = '',
																@STR_USUARIO_CREACION = @P_USUARIO,
																@FEC_CREACION = @V_FEC_ERR_CREACION,
																@STR_USUARIO_MODIFICACION = '',
																@FEC_MODIFICACION = '19000101',
																@INT_ID_SPID = @V_ERR_ID_SPID,
																@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
																@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
																@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
																@INT_ERROR_ESTADO = @V_ERR_ESTADO,
																@STR_SERVIDOR = @V_ERR_SERVIDOR,
																@STR_ESTACION = '',
																@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
																@STR_APLICATIVO = @V_ERR_APLICATIVO,
																@STR_CLASE = '',
																@STR_EVENTO = '',
																@STR_PROCESO = @V_ERR_PROCESO,
																@STR_PARAMETROS = @V_ERR_PARAMETROS,
																@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
																@INT_ID_TIPO = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
																@STR_DETALLE = @V_ERR_DETALLE,
																@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
																@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
																@STR_OBSERVACION = @V_ERR_OBSERVACION,
																@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
																@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
																@VBI_DATOS = @VBI_ERR_DATOS,
																@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO,
																@STR_SENTENCIA = @V_ERR_SENTENCIA,
																@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
																@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
																@INT_NIVEL_ANIDAMIENTO = @V_ERR_NUMERO_LINEA,
																@STR_IDENTIFICADOR_EXTERNO = 0,
																@STR_IDENTIFICADOR_UNICO = @V_IDENTIDICADOR_UNICO;
			END TRY
			BEGIN CATCH
					
				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('ERROR-99999-02-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
							GETDATE() AS FECHA;
				END;
				SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
                SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
                SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
                SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
                SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

				/*DEFINICION DE MENSAJE DE ERROR*/

				SELECT @V_ERR_NUMERO_USUARIO = 76001;
                --VERBOS A UTILIZAR DE ACUERDO A LA OPERACION=SELECT:SELECCIONAR, DELETE: ELIMINAR, UPDATE: ACTUALIZAR, INSERT: INSERTAR, EXEC: EJECUTAR
                SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR AL EJECUTAR EL PROCEDIMIENTO <PA_MAN_UTL_TRA_EXCEPCION_GUARDAR>';

                SELECT @V_ERR_OBSERVACION
                    = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + +',MENSAJE:'
                      + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
                      + ',PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');

                RAISERROR(@V_ERR_OBSERVACION, 16, 1);
            END CATCH;

			RAISERROR(@V_ERR_OBSERVACION, 16, 1);

			RETURN @V_ERR_NUMERO_USUARIO;
		END; /*FIN-ADMINISTRACION DE ERRORES*/
	END CATCH;
	--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++		
    --COMMIT TRAN 	
	RETURN 0;

END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>  
-- RELEASE:		<0000>
-- FECHA:		<2023/07/09>
-- DESCRIPCION: <OBTIENE LOS REGISTROS DE LA TABLA DE PARAMETRO>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <MAURICE.LANG>       
--FECHA:   <YYYY/MM/DD>             
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_CON_TBL_PMK_PARAMETRO
	@P_OPCION SMALLINT = 0, /*SIRVE PARA CONFIGURAR COMPORTAMIENTOS O FLUJOS EN EL PROCESO*/
	@P_USUARIO VARCHAR(50) = '', /*USUARIO QUIEN REALIZA LA ACCION*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECESITAR VALIDADR, EJECUCION_DEPURACION=7, EJECUCION_NORMAL=0*/
	@P_PK_TBL_PMK_PARAMETRO BIGINT = 0 /*ID DEL PARAMETRO*/
AS
BEGIN
	SET NOCOUNT ON;

	BEGIN TRY
		BEGIN /*INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCIO_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_ID_ORIGEN_PROCEDIMENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO-SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIFICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FINSOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERROES*/
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();
				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '1';
				DECLARE @V_ERR_PARAAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR,2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
				DECLARE	@V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
				DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
				DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
				DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
				DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
				DECLARE @VBI_ERR_DATOS VARBINARY(MAX);
				DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) ='';
				DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
				DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
				DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
				DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUTION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/

			END; /*FIN-ADMINISTRACION ERRORES*/

			--BEGIN /*INICIO VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

			--END; /*FIN VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/

		END; /*FIN-DECLARARCION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION, 
					GETDATE() AS FECHA,
					@P_USUARIO AS STR_USUARIO,
					@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
					@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
					GETDATE() AS FECHA,
					@V_BIT_EJEC_ACTIVO_EJECUTION AS BIT_EJEC_ACTIVO_EJECUCION,
					@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUTION = 1)
			BEGIN 
				
				/*BEGIN TRANSACTION*/

				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('00030-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA;
				END;

				--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
                --DETALLE DEL PROCEDIMIENTO 

				IF (@P_OPCION = 0)
				BEGIN
						SELECT @V_ERR_NUMERO_USUARIO = 75001;
						SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR EN LA OPCION 0, SELECT COMPLETO';
					
					SELECT TIB.PK_TBL_PMK_PARAMETRO,
						TIB.CEDULA_JURIDICA,
						TIB.EMPRESA,
						TIB.TELEFONO,
						TIB.CORREO,
						TIB.WEB,
						TIB.DIRECCION,
						TIB.DESCRIPCION,
						TIB.TIPO_TIENDA,
						TIB.LOGO,
						TIB.FECHA_CREACION,
						TIB.USUARIO_CREACION,
						TIB.FECHA_MODIFICACION,
						TIB.USUARIO_MODIFICACION
					FROM PAWPLACE.TBL_PMK_PARAMETRO AS TIB 
					WHERE (
						TIB.PK_TBL_PMK_PARAMETRO = @P_PK_TBL_PMK_PARAMETRO
						OR 
						@P_PK_TBL_PMK_PARAMETRO = 0
					);
				END;
				/*COMMIT TRANSACTION*/

			END;
		END; /*FIN-CUERPO PROCEDIMIENTO*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
	END TRY
	BEGIN CATCH
		/*ROLLBACK TRANSACTION*/

		SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(),0);
		SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(),0);
		SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(),0);
		SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(),'');
		SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(),0);

		SELECT @V_ERR_PARAAMETROS =
			('@P_OPCION= ' + CAST(@P_OPCION AS VARCHAR(50)) + ' ,' + '@P_USUARIO= ' + '''' + @P_USUARIO + ''''
			+ ' ,' + '@P_MODO_EJECUCION= '+CAST(@P_MODO_EJECUCION AS VARCHAR(50)) + ' ,' + '@P_PK_TBL_PMK_PARAMETRO= ' + CAST(@P_PK_TBL_PMK_PARAMETRO AS VARCHAR(50))
			);

		/*AGREGAR PARAMETROS NUEVOS AQUI*/

		SELECT @V_ERR_OBSERVACION =
			'(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ' ,'
			+ 'MENSAJE: ' + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' 
			+ ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D') + ' ,' + 'PROCESO: '
			+ ISNULL(@V_ERR_PROCESO, 'N/D');

		SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAAMETROS);

		DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);

		EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
														@SIN_FK_UTL_PAR_PAIS = '',
														@STR_USUARIO_CREACION = @P_USUARIO,
														@FEC_CREACION = @V_FEC_ERR_CREACION,
														@STR_USUARIO_MODIFICACION = '',
														@FEC_MODIFICACION = '',
														@INT_ID_SPID = @V_ERR_ID_SPID,
														@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
														@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
														@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
														@INT_ERROR_ESTADO = @V_ERR_ESTADO,
														@STR_SERVIDOR = @V_ERR_SERVIDOR,
														@STR_ESTACION = '',
														@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
														@STR_APLICATIVO = @V_ERR_APLICATIVO,
														@STR_CLASE = '',
														@STR_EVENTO = '',
														@STR_PROCESO = @V_ERR_PROCESO,
														@STR_PARAMETROS = @V_ERR_PARAAMETROS,
														@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
														@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
														@INT_ID_TIPO = @V_ERR_ID_TIPO,
														@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
														@STR_DETALLE = @V_ERR_DETALLE,
														@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
														@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
														@STR_OBSERVACION = @V_ERR_OBSERVACION,
														@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
														@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
														@VBI_DATOS = @VBI_ERR_DATOS,
														@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO_DATOS,
														@STR_SENTENCIA = @V_ERR_SENTENCIA,
														@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
														@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
														@INT_NIVEL_ANIDAMIENTO = @V_ERR_NIVEL_ANIDAMIENTO,
														@INT_NUMERO_LINEA = @V_ERR_NUMERO_LINEA,
														@STR_IDENTIFICADOR_EXTERNO = 0,
														@STR_IDENTIFICADOR_UNICO = @V_IDENTIFICADOR_UNICO;

		RAISERROR(@V_ERR_OBSERVACION, 16, 1);
	END CATCH;
END;

-- CREACIÓN--------------------------------------------------------------------------
-- AUTOR:       <MAURICE.LANG>
-- RELEASE:		<0000>
-- FECHA:		<2023/07/09>
-- DESCRIPCION: <PROCEDIMIENTO ALMACENADO DE PROCESO DE MANTENIMIETO DEL PARAMETRO>
-- ========================================================================================
--<<<<<<<<MODIFICACIONES>>>>>>>       
----UTILIZAR LOS SIGUIENTES COMENTARIOS PARA DETALLAR LOS CAMBIOS EN EL CODIGO           
--===================================================================================================================================================       
--AUTOR:   <NOMBRE.APELLIDO>       
--FECHA:   <YYYY/MM/DD>       
--TICKET:   <00000>       
--RELEASE:  <000>       
--DESCRIPTCION: <DETALLE DE LA MODIFICACION QUE SE ESTA REALIZANDO>       
--===================================================================================================================================================     
CREATE PROCEDURE PAWPLACE.PA_MAN_TBL_PMK_PARAMETRO
(
	@P_USUARIO VARCHAR(50) = '', /*USUARIO DE LA APLICACION QUE EJECUTA*/
	@P_MODO_EJECUCION SMALLINT = 0, /*MODO DE EJECUCION, SIRVE PARA MOSTRAR BANDERAS O DATOS EN CASO DE NECEISTAR VALIDAR, EJECUCION_DUPRACION=7, EJECUCION_NORMLA=0*/
	@P_OPCION SMALLINT = 0, /*OPCION SIRVE PARA CONFIGURAR COMPORTAMIENTO O FLUJOS EN EL PROCESO*/
	@P_IDENTIFICACODR_EXTERNO VARCHAR(50) = '', /*IDENTIDICADOR ENVIADO DESDE EL APLICATIVO, ESTE SE ALMACENA EN LAS BITACORAS DE EJECUCION O EN LAS BITACORAS DE EXCEPCIONES*/
	@P_PK_TBL_PMK_PARAMETRO BIGINT = 0,
	@P_CEDULA_JURIDICA VARCHAR(13) = '',
	@P_EMPRESA VARCHAR(250) = '',
	@P_TELEFONO VARCHAR(15) = '',
	@P_CORREO VARCHAR(250) = '',
	@P_WEB VARCHAR(250) = '',
	@P_DIRECCION VARCHAR(MAX) = '',
	@P_DESCRIPCION VARCHAR(35) = '',
	@P_TIPO_TIENDA VARCHAR(25) = '',
	@P_LOGO IMAGE = ''
)
AS
BEGIN

	SET XACT_ABORT, NOCOUNT ON; --ADDED TO PREVENT EXTRA RESULT SETS FROM INTERFERING WITH SELECT STATEMENTS.
    --SET TRANSACTION ISOLATION LEVEL READ UNCOMMITTED; --SERIALIZABLE; -- ADD NOLOCK ALL TABLES 

	BEGIN TRY
		BEGIN TRANSACTION;
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++ 
        -----------------------------                                    
        --DECLARACION Y ASIGNACION DE VARIABLES                                  
        -----------------------------
		BEGIN /**INICIO-DECLARACION VARIABLES Y CONSTANTES*/

			BEGIN /*INICIO-CONSTANTES*/
				DECLARE @V_MODO_EJECUCION_NORMAL SMALLINT = 0;
				DECLARE @V_MODO_EJECUCION_DEPURACION SMALLINT = 7;
				DECLARE @V_OPCION_NORMAL SMALLINT = 0;
				DECLARE @V_ID_ORIGEN_WINDOWS_FORM INT = 1;
				DECLARE @V_DESCRIPCION_ORIGEN_WINDOWS_FORM VARCHAR(300) = 'WINDOWS FORM';
				DECLARE @V_ID_ORIGEN_WEB_SERVICE INT = 2;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SERVICE VARCHAR(300) = 'WEB SERVICE';
				DECLARE @V_ID_ORIGEN_WEB_SITE INT = 3;
				DECLARE @V_DESCRIPCION_ORIGEN_WEB_SITE VARCHAR(300) = 'WEB SITE';
				DECLARE @V_ID_ORIGEN_PROCEDIMIENTO INT = 4;
				DECLARE @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO VARCHAR(300) = 'PROCEDIMIENTO ALMACENADO';
				DECLARE @V_ID_ORIGEN_REPORTING_SERVICE INT = 5;
				DECLARE @V_DESCRIPCION_ORIGEN_REPORTING_SERVICE VARCHAR(300) = 'REPORTING SERVICE';
				DECLARE @V_ID_ORIGEN_ETL INT = 6;
				DECLARE @V_DESCRIPCION_ORIGEN_ETL VARCHAR(300) = 'ETL';
				DECLARE @V_ID_ORIGEN_JOB INT = 7;
				DECLARE @V_DESCRIPCION_ORIGEN_JOB VARCHAR(300) = 'JOB';
				DECLARE @V_ID_TIPO_ERROR INT = 1;
				DECLARE @V_DESCRIPCION_TIPO_ERROR VARCHAR(300) = 'ERROR';
				DECLARE @V_ID_TIPO_EXCEPCION INT = 2;
				DECLARE @V_DESCRIPCION_TIPO_EXCEPCIPN VARCHAR(300) = 'EXCEPCION-PERSONALIZADA';
				DECLARE @V_ID_TIPO_DATOS_XML SMALLINT = 1; /*ID TIPO DATO XML*/
			END; /*FIN-CONSTANTES*/

			BEGIN /*INICIO SOBREESCRITURA DE VARIABLES*/
				DECLARE @V_IDENTIDICADOR_UNICO VARCHAR(50) = CONVERT(VARCHAR(50), NEWID());
			END; /*FIN-SOBREESCRITURA DE VARIABLES*/

			BEGIN /*INICIO-ADMINISTRACION ERRORES*/
				DECLARE @V_ERR_FK_UTL_PAR_PAIS SMALLINT = 0;
				DECLARE @V_ERR_USUARIO_CREACION VARCHAR(50) = ISNULL(@P_USUARIO, 'N/D');
				DECLARE @V_FEC_ERR_SISTEMA DATETIME = GETDATE();
				
				DECLARE @V_FEC_ERR_CREACION DATETIME = GETDATE();

				DECLARE @V_ERR_ID_SPID INT = @@SPID;
				DECLARE @V_ERR_PRIORIDAD INT = 0;
				DECLARE @V_ERR_SEVERIDAD INT = 0;
				DECLARE @V_ERR_ESTADO INT = 0;
				DECLARE @V_ERR_BASE_DATOS VARCHAR(300) = ISNULL(DB_NAME(), 'N/D');
				DECLARE @V_ERR_SERVIDOR VARCHAR(300) = ISNULL(@@SERVERNAME, 'N/D');
				DECLARE @V_ERR_PROCESO VARCHAR(300) = ISNULL(OBJECT_NAME(@@PROCID), 'N/D'); /*OBTIENE EL NOMBRE DEL PROCESO EN EJECUCION*/
				DECLARE @V_ERR_PARAMETROS VARCHAR(MAX) = '';
				DECLARE @V_ERR_ID_ORIGEN INT = @V_ID_ORIGEN_PROCEDIMIENTO;
				DECLARE @V_ERR_DESCRIPCION_ORIGEN VARCHAR(300) = @V_DESCRIPCION_ORIGEN_PROCEDIMIENTO; /*1=WINDOWS FORM, 2=WEB SERVICE, 3=WEB SITE, 4=PROCEDIMIENTO, 5=REPORTING SERVICE, 6=ETL*/
				DECLARE @V_ERR_ID_TIPO INT = @V_ID_TIPO_ERROR;
				DECLARE @V_ERR_DESCRIPCION_TIPO VARCHAR(300) = @V_DESCRIPCION_TIPO_ERROR; /*1=ERROR, 2=EXCEPCION-VALIDACION*/
				DECLARE @V_ERR_DETALLE VARCHAR(500) = '';
                DECLARE @V_ERR_MENSAJE_USUARIO VARCHAR(MAX) = '';
                DECLARE @V_ERR_MENSAJE_SISTEMA VARCHAR(MAX) = '';
                DECLARE @V_ERR_OBSERVACION VARCHAR(MAX) = '';
                DECLARE @V_ERR_OTROS_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_XML_DATOS VARCHAR(MAX) = '';
                DECLARE @V_ERR_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
				DECLARE @V_ERR_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_ERR_NUMERO_USUARIO INT = 75000;
                DECLARE @V_ERR_NUMERO_SISTEMA INT = 0;
                DECLARE @V_ERR_NIVEL_ANIDAMIENTO INT = ISNULL(@@NESTLEVEL, 0);
                
				DECLARE @V_ERR_APLICATIVO VARCHAR(50) = '';

				SELECT TOP 1
						@V_ERR_APLICATIVO = (
                                       'HOST:'+
                                       ISNULL(vs.host_name, 'N/D')+
                                       ' | PROGRAM:'+
                                       ISNULL(vs.program_name, 'N,/D')+
                                       ' | LOGIN:'+
                                       ISNULL(vs.login_name, 'N,/D')
									   )
				FROM sys.dm_exec_requests vr
						INNER JOIN sys.dm_exec_sessions vs
							ON vr.session_id = vs.session_id
				WHERE vr.session_id = @V_ERR_ID_SPID;

				DECLARE @V_ERR_NUMERO_LINEA INT = 0;
                DECLARE @V_ERR_SENTENCIA VARCHAR(MAX) = '';
                DECLARE @VBI_ERR_DATOS VARBINARY(MAX) = NULL;
                DECLARE @V_EJEC_DESCRIPCION_TIPO_DATOS VARCHAR(300) = '';
                DECLARE @V_EJEC_ID_TIPO_DATOS SMALLINT = 0;
                DECLARE @V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION BIGINT = 0;
				DECLARE @V_BIT_EJEC_ACTIVO_EJECUCION INT = 1; /*UTILIZA COMO INDICADOR DE QUE EL PROCEDIMIENTO EJECUTA EL CUERPO DEL MISMO O NO*/
				DECLARE @V_OBSERVACIONES VARCHAR(MAX) = '';

			END; /*FIN-ADMINISTRACION ERRORES*/

			BEGIN /*INICIO-VARIOS*/
				DECLARE @V_CANTIDAD_REGISTROS INT = 0;
				DECLARE @V_BIT_REGISTRA_XML_PROCESOS_SISTEMA BIT = 0;

				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + '@P_USUARIO=' + '''' 
											+ ISNULL(@P_USUARIO, 'N/D') + '''');
				SELECT @V_ERR_PARAMETROS = (@V_ERR_PARAMETROS + ', @IDENTIFICADOR_EXTERNO=' 
											+ '''' + ISNULL(@P_IDENTIFICACODR_EXTERNO, 'N/D') 
											+ '''');

				--DETALLE CUERPO

                -- FIN DETALLE CUERPO

				SELECT @V_ERR_SENTENCIA = ('EXEC ' + @V_ERR_PROCESO + ' ' + @V_ERR_PARAMETROS);

				/*SI NO VIENE NINGUN VALOR SE GENERA UNO*/
				SELECT @P_IDENTIFICACODR_EXTERNO = CASE
														WHEN LTRIM(RTRIM(@P_IDENTIFICACODR_EXTERNO)) = ''
															THEN 
																CONVERT(VARCHAR(50), NEWID())
														ELSE
															@P_IDENTIFICACODR_EXTERNO
													END;
			END; /*FIN-VARIOS*/

			--BEGIN /*INICIO-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
			DECLARE @SET_CAMPANA NVARCHAR(MAX);
            DECLARE @ParmDefinition NVARCHAR(MAX);

            DECLARE @V_VALOR BIGINT;
			--END; /*FIN-VARIABLES O CONSTANTES DEL CUERPO DEL PROCEDIMIENTO*/
		END; /*FIN-DECLARACION VARIABLES Y CONSTANTES*/
		--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++          
        -----------------------------                                            
        --CUERPO PROCEDIMIENTO                                            
        -----------------------------
		BEGIN /*INICIO-CUERPO PROCEDIMIENTO*/
			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00000-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@P_USUARIO AS STR_USUARIO,
						@P_MODO_EJECUCION AS SIN_MODO_EJECUCION,
						@P_OPCION AS SIN_OPCION;

				SELECT ('00010-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_ERR_SENTENCIA AS SENTENCIA_EJECUCION;
			END;

			--------------------------------------------------------------------------------------------------------------------------------
            --BEGIN--INICIO-INICIAL REGISTRO DE BITACORAS DE EJECUCION

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('00020-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						@V_BIT_EJEC_ACTIVO_EJECUCION AS BIT_EJEC_ACTIVO_EJECUCION,
						@V_BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION AS BIN_EJEC_FK_UTL_TRA_BITACORA_EJECUCION;
			END;

			IF (@V_BIT_EJEC_ACTIVO_EJECUCION = 1)
			BEGIN
			/*BEGIN TRANSACTION*/

			--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++        
            --DETALLE DEL PROCEDIMIENTO 
				IF (@P_OPCION = 0)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75001;
					SELECT @V_ERR_MENSAJE_USUARIO = 'INSERCION O ACTUALIZACION DE UN DATO';

					IF EXISTS
					(
						SELECT TOP 1 *
						FROM PAWPLACE.TBL_PMK_PARAMETRO AS TGE WITH (NOLOCK)
						WHERE TGE.PK_TBL_PMK_PARAMETRO = @P_PK_TBL_PMK_PARAMETRO
					)
					BEGIN
						UPDATE PAWPLACE.TBL_PMK_PARAMETRO
						SET CEDULA_JURIDICA = @P_CEDULA_JURIDICA,
							EMPRESA = @P_EMPRESA,
							TELEFONO = @P_TELEFONO,
							CORREO = @P_CORREO,
							WEB = @P_WEB,
							DIRECCION = @P_DIRECCION,
							DESCRIPCION = @P_DESCRIPCION,
							TIPO_TIENDA = @P_TIPO_TIENDA,
							LOGO = @P_LOGO,
							FECHA_MODIFICACION = GETDATE(),
							USUARIO_MODIFICACION = @P_USUARIO
						WHERE PK_TBL_PMK_PARAMETRO = @P_PK_TBL_PMK_PARAMETRO;
					END;
					ELSE
					BEGIN
						INSERT INTO PAWPLACE.TBL_PMK_PARAMETRO
						(
							CEDULA_JURIDICA,
							EMPRESA,
							TELEFONO,
							CORREO,
							WEB,
							DIRECCION,
							DESCRIPCION,
							TIPO_TIENDA,
							LOGO,
							FECHA_CREACION,
							USUARIO_CREACION
						)
						VALUES
						(
							@P_CEDULA_JURIDICA,
							@P_EMPRESA,
							@P_TELEFONO,
							@P_CORREO,
							@P_WEB,
							@P_DIRECCION,
							@P_DESCRIPCION,
							@P_TIPO_TIENDA,
							@P_LOGO,
							GETDATE(),
							@P_USUARIO
						);
					END;
				END;

				IF (@P_OPCION = 1)
				BEGIN
					SELECT @V_ERR_NUMERO_USUARIO = 75002;
					SELECT @V_ERR_MENSAJE_USUARIO = 'ELIMINACION DE UN DATO';
					
					DELETE PAWPLACE.TBL_PMK_PARAMETRO
					WHERE PK_TBL_PMK_PARAMETRO = @P_PK_TBL_PMK_PARAMETRO;
				END;
				-- FIN DETALLE CUERPO
			END;

			COMMIT TRANSACTION;

		END; /*FIN-CUERPO PROCEDIMIENTO*/
--+++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++   
	END TRY
	BEGIN CATCH
		-----------------------------                                    
        --ADMINISTRACION DE ERRORES                                  
        -----------------------------
		BEGIN /*INICIO-ADMINISTRACION DE ERRORES*/

			IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
			BEGIN
				SELECT ('ERROR-99999-01-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
						GETDATE() AS FECHA,
						XACT_STATE() AS [XACT_STATE],
						@@TRANCOUNT AS TRANSCOUNT;
			END;

			/*VALIDA SI LA TRANSACCION NO SE PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = -1
			BEGIN
				IF (@@TRANCOUNT > 0)
				BEGIN
					ROLLBACK TRANSACTION;
				END;
			END;

			/*VALIDA SI LA TRANSACCION PUEDE HACER COMMIT*/

			IF (XACT_STATE()) = 1
			BEGIN
				IF(@@TRANCOUNT > 0)
				BEGIN
					COMMIT TRANSACTION;
				END;
			END;

			/*ERRORHANDLER*/

			SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
			SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
			SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
			SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
			SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

			/*DEFINICION DE MENSAJE DE ERROR*/

			SELECT @V_ERR_OBSERVACION = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + ', MENSAJE:'
										+ ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
										+ ', PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');
			BEGIN TRY
				
				SELECT @V_FEC_ERR_CREACION = GETDATE();

				DECLARE @STR_IDENTIFICADOR_UNICO VARCHAR(50);
				EXEC PAWPLACE.PA_MAN_TBL_EJE_TRA_EXCEPCION_GUARDAR @SIN_MODO_EJECUCION = 0,
																@SIN_FK_UTL_PAR_PAIS = '',
																@STR_USUARIO_CREACION = @P_USUARIO,
																@FEC_CREACION = @V_FEC_ERR_CREACION,
																@STR_USUARIO_MODIFICACION = '',
																@FEC_MODIFICACION = '19000101',
																@INT_ID_SPID = @V_ERR_ID_SPID,
																@FEC_SISTEMA = @V_FEC_ERR_SISTEMA,
																@INT_PRIORIDAD = @V_ERR_PRIORIDAD,
																@INT_SEVERIDAD = @V_ERR_SEVERIDAD,
																@INT_ERROR_ESTADO = @V_ERR_ESTADO,
																@STR_SERVIDOR = @V_ERR_SERVIDOR,
																@STR_ESTACION = '',
																@STR_BASE_DATOS = @V_ERR_BASE_DATOS,
																@STR_APLICATIVO = @V_ERR_APLICATIVO,
																@STR_CLASE = '',
																@STR_EVENTO = '',
																@STR_PROCESO = @V_ERR_PROCESO,
																@STR_PARAMETROS = @V_ERR_PARAMETROS,
																@INT_ID_ORIGEN = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_ORIGEN = @V_ERR_DESCRIPCION_ORIGEN,
																@INT_ID_TIPO = @V_ERR_ID_ORIGEN,
																@STR_DESCRIPCION_TIPO = @V_ERR_DESCRIPCION_TIPO,
																@STR_DETALLE = @V_ERR_DETALLE,
																@STR_MENSAJE = @V_ERR_MENSAJE_USUARIO,
																@STR_MENSAJE_SISTEMA = @V_ERR_MENSAJE_SISTEMA,
																@STR_OBSERVACION = @V_ERR_OBSERVACION,
																@STR_OTROS_DATOS = @V_ERR_OTROS_DATOS,
																@SIN_ID_TIPO_DATOS = @V_ERR_ID_TIPO_DATOS,
																@VBI_DATOS = @VBI_ERR_DATOS,
																@STR_DESCRIPCION_TIPO_DATOS = @V_ERR_DESCRIPCION_TIPO,
																@STR_SENTENCIA = @V_ERR_SENTENCIA,
																@INT_NUMERO_USUARIO = @V_ERR_NUMERO_USUARIO,
																@INT_NUMERO_SISTEMA = @V_ERR_NUMERO_SISTEMA,
																@INT_NIVEL_ANIDAMIENTO = @V_ERR_NUMERO_LINEA,
																@STR_IDENTIFICADOR_EXTERNO = 0,
																@STR_IDENTIFICADOR_UNICO = @V_IDENTIDICADOR_UNICO;
			END TRY
			BEGIN CATCH
					
				IF (@P_MODO_EJECUCION = @V_MODO_EJECUCION_DEPURACION)
				BEGIN
					SELECT ('ERROR-99999-02-' + @V_ERR_PROCESO) AS BANDERA_EJECUCION,
							GETDATE() AS FECHA;
				END;
				SELECT @V_ERR_SEVERIDAD = ISNULL(ERROR_SEVERITY(), 0);
                SELECT @V_ERR_ESTADO = ISNULL(ERROR_STATE(), 0);
                SELECT @V_ERR_NUMERO_LINEA = ISNULL(ERROR_LINE(), 0);
                SELECT @V_ERR_MENSAJE_SISTEMA = ISNULL(ERROR_MESSAGE(), '');
                SELECT @V_ERR_NUMERO_SISTEMA = ISNULL(ERROR_NUMBER(), 0);

				/*DEFINICION DE MENSAJE DE ERROR*/

				SELECT @V_ERR_NUMERO_USUARIO = 76001;
                --VERBOS A UTILIZAR DE ACUERDO A LA OPERACION=SELECT:SELECCIONAR, DELETE: ELIMINAR, UPDATE: ACTUALIZAR, INSERT: INSERTAR, EXEC: EJECUTAR
                SELECT @V_ERR_MENSAJE_USUARIO = 'ERROR AL EJECUTAR EL PROCEDIMIENTO <PA_MAN_UTL_TRA_EXCEPCION_GUARDAR>';

                SELECT @V_ERR_OBSERVACION
                    = '(' + CONVERT(VARCHAR, @V_ERR_NIVEL_ANIDAMIENTO) + ')' + +',MENSAJE:'
                      + ISNULL(@V_ERR_MENSAJE_USUARIO, 'N/D') + '|' + ISNULL(@V_ERR_MENSAJE_SISTEMA, 'N/D')
                      + ',PROCESO:' + ISNULL(@V_ERR_PROCESO, 'N/D');

                RAISERROR(@V_ERR_OBSERVACION, 16, 1);
            END CATCH;

			RAISERROR(@V_ERR_OBSERVACION, 16, 1);

			RETURN @V_ERR_NUMERO_USUARIO;
		END; /*FIN-ADMINISTRACION DE ERRORES*/
	END CATCH;
	--++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++		
    --COMMIT TRAN 	
	RETURN 0;

END;